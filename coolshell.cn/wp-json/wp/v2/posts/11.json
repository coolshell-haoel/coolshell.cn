{"id":11,"date":"2009-03-02T13:40:50","date_gmt":"2009-03-02T05:40:50","guid":{"rendered":"http:\/\/coolshell.cn\/?p=11"},"modified":"2009-11-05T11:31:45","modified_gmt":"2009-11-05T03:31:45","slug":"php-v53%e7%9a%84%e6%96%b0%e9%b2%9c%e7%8e%a9%e6%84%8f","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/11.html","title":{"rendered":"PHP v5.3\u7684\u65b0\u9c9c\u73a9\u610f"},"content":{"rendered":"<p>PHP v5.3\u9a6c\u4e0a\u5c31\u8981release\u4e86\uff0c\u8fd9\u91cc\u8ba9\u6211\u4eec\u770b\u770b\u4ed6\u6709\u4e00\u4e9b\u4ec0\u4e48\u6837\u7684\u65b0\u7279\u6027\u3002<\/p>\n<p><strong>1\uff09_callStatic() magic \u65b9\u6cd5<\/strong><\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">class Foo\r\n{\r\n    public static function __callStatic( $name, $args )\r\n    {\r\n        echo &quot;Called method $name statically&quot;;\r\n    } \r\n\r\n    public function __call( $name, $args )\r\n    {\r\n        echo &quot;Called method $name&quot;;\r\n    }\r\n}<\/pre>\n<p><!--more--><\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">Foo::dog();       \/\/ outputs &quot;Called method dog statically&quot;\r\n$foo = new Foo;\r\n$foo-&amp;gt;dog();      \/\/ outputs &quot;Called method dog&quot;<\/pre>\n<p><strong>2\uff09<span class=\"atitle\"><code>\u52a8\u6001\u8c03\u7528\u51fd\u6570<\/code><\/span><\/strong><\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">class Dog\r\n{\r\n    public function bark()\r\n    {\r\n        echo &quot;Woof!&quot;;\r\n    }\r\n&lt;span style=&quot;color: #333399;&quot;&gt;} \r\n\r\n$class = &quot;Dog&quot;\r\n$action = &quot;bark&quot;;\r\n$x = new $class(); \/\/ instantiates the class &quot;Dog&quot;\r\n$x-&amp;gt;$action();     \/\/ outputs &quot;Woof!&quot; &lt;\/span&gt;<\/pre>\n<p><strong><span class=\"atitle\">3) \u6807\u51c6<\/span><\/strong><strong><span class=\"atitle\">PHP<\/span><\/strong><strong><span class=\"atitle\">\u5e93\uff08SPL\uff09<\/span><\/strong><\/p>\n<p><span class=\"atitle\">\u52a0\u4e86\u4e86\u5c11\u6570\u51e0\u4e2a\u5bb9\u5668\u7c7b\uff0c<\/span><span class=\"atitle\">\u6bd4\u5982\uff0c\u6808\uff08<\/span>SplStack<span class=\"atitle\">\uff09\u548c\u56fa\u5b9a\u6570\u7ec4\uff08SplFixedArray\uff09<\/span><\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">$stack = new SplStack(); \r\n\r\n\/\/ push a few new items on the stack\r\n$stack-&amp;gt;push(&quot;a&quot;);\r\n$stack-&amp;gt;push(&quot;b&quot;);\r\n$stack-&amp;gt;push(&quot;c&quot;); \r\n\r\n\/\/ see how many items are on the stack\r\necho count($stack); \/\/ returns 3 \r\n\r\n\/\/ iterate over the items in the stack\r\nforeach ( $stack as $item )\r\n    echo &quot;[$item],&quot;;\r\n\/\/ the above outputs: [c][\/c]\r\n\r\n [\/c],[b],[a]  \/\/ pop an item off the stack echo $stack-&amp;gt;pop(); \/\/ returns &quot;c&quot;   \/\/ now see how many items are on the stack echo count($stack); \/\/ returns 2<\/pre>\n<p><strong><span class=\"atitle\">4) <\/span><span class=\"atitle\">Closures \u529f\u80fd<\/span><\/strong><\/p>\n<p><span class=\"atitle\">\u5173\u4e8e<\/span>Closures<span class=\"atitle\">\uff0c\u8fd9\u662f\u4e00\u4e2a\u628a\u51fd\u6570\u5b9a\u4e49\u6210\u53d8\u91cf\u7684\u73a9\u610f\u3002\u8ba9\u6211\u4eec\u770b\u51e0\u4e2a\u4f8b\u5b50\uff1a<\/span><\/p>\n<p><span class=\"atitle\">\u793a\u4f8b\u4e00\uff1a<\/span><\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">$string = &quot;Hello World!&quot;;\r\n$closure = function() use ($string) { echo $string; };\r\n\r\n$closure();<\/pre>\n<p><strong>Output:<\/strong><br \/>\nHello World!<br \/>\n\u793a\u4f8b\u4e8c \u4f7f\u7528\u5f15\u7528\u7684\u53d8\u91cf<\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">$x = 1\r\n$closure = function() use (&amp;amp;$x) { ++$x; }\r\n\r\necho $x . &quot;\\\\n&quot;;\r\n$closure();\r\necho $x . &quot;\\\\n&quot;;\r\n$closure();\r\necho $x . &quot;\\\\n&quot;;<\/pre>\n<p><strong>Output<\/strong>:<br \/>\n1<br \/>\n2<br \/>\n3<br \/>\n\u793a\u4f8b\u4e09\uff0c\u8fd4\u56de\u503c<\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">function getAppender($baseString)\r\n{\r\n      return function($appendString) use ($baseString)\r\n  { return $baseString .$appendString; };\r\n}<\/pre>\n<p>\u793a\u4f8b\u56db\uff0cReflection<\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">class Counter\r\n{\r\n      private $x;\r\n\r\n      public function __construct()\r\n      {\r\n           $this-&amp;gt;x = 0;\r\n      }\r\n\r\n      public function increment()\r\n      {\r\n           $this-&amp;gt;x++;\r\n      }\r\n\r\n      public function currentValue()\r\n      {\r\n           echo $this-&amp;gt;x . &quot;\\\\n&quot;;\r\n      }\r\n}\r\n$class = new ReflectionClass(&quot;Counter&quot;);\r\n$method = $class-&amp;gt;getMethod(&quot;currentValue&quot;);\r\n$closure = $method-&amp;gt;getClosure()\r\n$closure();\r\n$class-&amp;gt;increment();\r\n$closure();<\/pre>\n<p><strong>Output<\/strong>:<br \/>\n0<br \/>\n1<br \/>\n\u793a\u4f8b\u4e94\uff0cReflection API<\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">$closure = function ($x, $y = 1) {};\r\n$m = new ReflectionMethod($closure);\r\nReflection::export ($m);\r\n&lt;strong&gt;Output&lt;\/strong&gt;:\r\nMethod [  public method __invoke ] {\r\n  - Parameters [2] {\r\n    Parameter #0 [  $x ]\r\n    Parameter #1 [  $y ]\r\n  }\r\n}<\/pre>\n<p>\u793a\u4f8b\u516d\uff0cUses Case<\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">$logdb = function ($string) { Logger::log(&quot;debug&quot;,&quot;database&quot;,$string);};\r\n$db = mysqli_connect(&quot;server&quot;,&quot;user&quot;,&quot;pass&quot;);\r\n$logdb(&quot;Connected to database&quot;);\r\n$db-&amp;gt;query(&quot;insert into parts (part, description) values\r\n (&quot;Hammer&quot;,&quot;Pounds nails&quot;);\r\n$logdb(&quot;Insert Hammer into to parts table&quot;);\r\n$db-&amp;gt;query(&quot;insert into parts (part, description) values\r\n       (&quot;Drill&quot;,&quot;Puts holes in wood&quot;);\r\n$logdb(&quot;Insert Drill into to parts table&quot;);\r\n$db-&amp;gt;query(&quot;insert into parts (part, description) values\r\n (&quot;Saw&quot;,&quot;Cuts wood&quot;);\r\n$logdb(&quot;Insert Saw into to parts table&quot;);<\/pre>\n<p>\u66f4\u4e3a\u8be6\u7ec6\u7684\u6587\u7ae0\uff0c\u8bf7\u53c2\u8003\u8fd9\u91cc\uff0c<a href=\"http:\/\/www.ibm.com\/developerworks\/opensource\/library\/os-php-5.3new2\/index.html\" target=\"_blank\">\u94fe\u63a5<\/a>\u3002<\/p>\n<p><strong><span class=\"atitle\">5) <\/span><span class=\"atitle\">\u4f7f\u7528namespace<\/span><\/strong><\/p>\n<p><span class=\"atitle\">\u65b0\u7248\u7684PHP\u4f1a\u5f00\u59cb\u652f\u6301C++\u5f0f\u7684namespace\uff0c\u8bf7\u53c2\u770b\u793a\u4f8b\uff1a<\/span><\/p>\n<p><span class=\"atitle\">\u793a\u4f8b\u4e00<\/span><\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">\/* Foo.php *\/\r\n&amp;lt;?php\r\nnamespace Foo;\r\nfunction bar()\r\n{\r\n    echo &quot;calling bar....&quot;;\r\n}\r\n?&amp;gt; \r\n\r\n\/* File1.php *\/\r\n&amp;lt;?php\r\ninclude &quot;.\/Foo.php&quot;;\r\nFoo\/bar(); \/\/ outputs &quot;calling bar....&quot;;\r\n?&amp;gt; \r\n\r\n\/* File2.php *\/\r\n&amp;lt;?php\r\ninclude &quot;.\/Foo.php&quot;;\r\nuse Foo as ns;\r\nns\/bar(); \/\/ outputs &quot;calling bar....&quot;;\r\n?&amp;gt; \r\n\r\n\/* File3.php *\/\r\n&amp;lt;?php\r\ninclude &quot;.\/Foo.php&quot;;\r\nuse Foo;\r\nbar(); \/\/ outputs &quot;calling bar....&quot;;\r\n?&amp;gt;\r\n&lt;!--p include &quot;.\/Foo.php&quot;; use Foo; bar(); \/\/ outputs &quot;calling bar....&quot;;--&gt;<\/pre>\n<p>\u793a\u4f8b\u4e8c\uff0c\u591a\u91cdnamespace<\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">&lt;!--p namespace Foo; class Test {}  namespace Bar; class Test {}  $a = new Foo\\\\Test; $b = new Bar\\\\Test;  var_dump($a, $b);--&gt; &amp;lt;?php\r\nnamespace Foo;\r\nclass Test {} \r\n\r\nnamespace Bar;\r\nclass Test {} \r\n\r\n$a = new Foo\\\\Test;\r\n$b = new Bar\\\\Test; \r\n\r\nvar_dump($a, $b); \r\n\r\nOutput:\r\nobject(Foo\\\\Test)#1 (0) {\r\n}\r\nobject(Bar\\\\Test)#2 (0) {\r\n}\r\n&lt;strong&gt;Output:&lt;\/strong&gt;\r\nobject(Foo\\\\Test)#1 (0) { }\r\nobject(Bar\\\\Test)#2 (0) { }<\/pre>\n<p>\u793a\u4f8b\u4e09\uff0c\u4e0d\u540c\u6587\u4ef6\u4e2d\u7684namespace<\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">\/*\u5b9a\u4e49*\/\r\n\/* global.php *\/\r\n&amp;lt;?php\r\nfunction hello()\r\n{\r\n    echo &quot;hello from the global scope!&quot;;\r\n}\r\n?&amp;gt; \r\n\r\n\/* Foo.php *\/\r\n&amp;lt;?php\r\nnamespace Foo;\r\nfunction hello()\r\n{\r\n    echo &quot;hello from the Foo namespace!&quot;;\r\n}\r\n?&amp;gt; \r\n\r\n\/* Foo_Bar.php *\/\r\n&amp;lt;?php\r\nnamespace Foo\/Bar;\r\nfunction hello()\r\n{\r\n    echo &quot;hello from the Foo\/Bar namespace!&quot;;\r\n}\r\n?&amp;gt;\r\n&lt;!--p namespace Foo\/Bar; function hello() {     echo &quot;hello from the Foo\/Bar namespace!&quot;; }--&gt;\r\n\r\n\/*\u4f7f\u7528 *\/\r\n&lt;!--p include &quot;.\/global.php&quot;; include &quot;.\/Foo.php&quot;; include &quot;.\/Foo_Bar.php&quot;; use Foo;  hello();         \/\/ outputs &quot;hello from the Foo namespace!&quot; Bar\\\\hello();   \/\/ outputs &quot;hello from the Foo\/Bar namespace!&quot; \\\\hello();       \/\/ outputs &quot;hello from the global scope!&quot;--&gt;&amp;lt;?php\r\ninclude &quot;.\/global.php&quot;;\r\ninclude &quot;.\/Foo.php&quot;;\r\ninclude &quot;.\/Foo_Bar.php&quot;;\r\n\r\nuse Foo; \r\n\r\nhello();         \/\/ outputs &quot;hello from the Foo namespace!&quot;\r\nBar\\\\hello();   \/\/ outputs &quot;hello from the Foo\/Bar namespace!&quot;\r\n\\\\hello();       \/\/ outputs &quot;hello from the global scope!&quot;\r\n?&amp;gt;<\/pre>\n<p>\u66f4\u4e3a\u8be6\u7ec6\u7684\u6587\u7ae0\uff0c\u8bf7\u53c2\u8003\u8fd9\u91cc\uff0c<a href=\"http:\/\/www.ibm.com\/developerworks\/opensource\/library\/os-php-5.3new3\/index.html\" target=\"_blank\">\u94fe\u63a5<\/a>\u3002<\/p>\n<p><strong>6)\u5f00\u59cb\u652f\u6301Achieve\u5305<\/strong><\/p>\n<p>\u6b63\u50cfJAR\u4e00\u6837\uff0cPHP\u4e5f\u8981\u5f00\u59cb\u652f\u6301\u81ea\u5df1\u7684Achieve\u5305\u4e86\uff0c\u53eb\u4f5c\uff0cPhar\u3002PHP\u63d0\u4f9b\u4e86\u4e00\u6574\u5957\u51fd\u6570\u6765\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u521b\u5efa\u548c\u4f7f\u7528Phar\uff0c\u6b63\u5982\u4e0b\u9762\u7684\u793a\u4f8b\u6240\u793a\uff1a<\/p>\n<p style=\"padding-left: 30px;\"><strong>\u521b\u5efa<\/strong>\uff1a<\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">$p = new Phar(&quot;\/path\/to\/my.phar&quot;,\r\n CURRENT_AS_FILEINFO | KEY_AS_FILENAME, &quot;my.phar&quot;);\r\n$p-&amp;gt;startBuffering();<\/pre>\n<p style=\"padding-left: 30px;\"><strong>\u521b\u5efa\u6587\u4ef6\u5b58\u6839<\/strong>\uff08stub\uff09<\/p>\n<p><code data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">$p-&amp;gt;setStub(&quot;&lt;!--p Phar::mapPhar();  include &quot;phar:\/\/myphar.phar\/index.php&quot;; __HALT_COMPILER();--&gt;&quot;);<\/code><\/p>\n<p style=\"padding-left: 30px;\"><strong>\u52a0\u5165\u6587\u4ef6<\/strong>\uff1a<\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">$p[&quot;file.txt&quot;] = &quot;This is a text file&quot;;\r\n$p[&quot;index.php&quot;] = file_get_contents(&quot;index.php&quot;);\r\n$p[&quot;big.txt&quot;] = &quot;This is a big text file&quot;;\r\n$p[&quot;big.txt&quot;]-&amp;gt;setCompressedBZIP2();\r\n\/\/\u52a0\u5165\u67d0\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u6587\u4ef6\r\n$p-&amp;gt;buildFromDirectory(&quot;\/path\/to\/files&quot;,&quot;.\/\\\\.php$\/&quot;);<\/pre>\n<p style=\"padding-left: 30px;\"><strong>\u4f7f\u7528Phar<\/strong><\/p>\n<pre data-enlighter-language=\"php\" class=\"EnlighterJSRAW\">include &quot;myphar.phar&quot;;\r\ninclude &quot;phar:\/\/myphar.phar\/file.php&quot;;<\/pre>\n<p>\u66f4\u4e3a\u8be6\u7ec6\u7684\u6587\u7ae0\uff0c\u8bf7\u53c2\u8003\u8fd9\u91cc\uff0c<a href=\"http:\/\/www.ibm.com\/developerworks\/opensource\/library\/os-php-5.3new4\/index.html\" target=\"_blank\">\u94fe\u63a5<\/a>\u3002<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>PHP v5.3\u9a6c\u4e0a\u5c31\u8981release\u4e86\uff0c\u8fd9\u91cc\u8ba9\u6211\u4eec\u770b\u770b\u4ed6\u6709\u4e00\u4e9b\u4ec0\u4e48\u6837\u7684\u65b0\u7279\u6027\u3002 1\uff09_callStatic() magic \u65b9\u6cd5 class Foo { pu&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/11.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[11,7,3],"tags":[35],"series":[],"aioseo_notices":[],"views":7454,"post_thumbnail_image":"","content_first_image":"","post_medium_image_300":"","post_thumbnail_image_624":"","post_frist_image":"","post_medium_image":"","post_large_image":"","post_full_image":"","post_all_images":[],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":2,"category_name":"PHP\u811a\u672c","post_date":"2009-03-02","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[],"pageviews":7455,"pageviews_wl":7017,"ratings_average":1,"ratings_total":9,"ratings_users":5,"next_post_id":14,"next_post_title":"Java\u4e66\u7c4dTop 10","previous_post_id":9,"previous_post_title":"\u4f60\u5e94\u8be5\u77e5\u9053\u768420\u4e2aAjax\u6280\u672f(11-20)"}