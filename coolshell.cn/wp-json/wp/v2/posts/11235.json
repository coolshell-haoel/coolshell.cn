{"id":11235,"date":"2014-03-15T20:44:24","date_gmt":"2014-03-15T12:44:24","guid":{"rendered":"http:\/\/coolshell.cn\/?p=11235"},"modified":"2014-03-17T08:56:54","modified_gmt":"2014-03-17T00:56:54","slug":"%e4%b8%80%e4%b8%aa%e6%b5%ae%e7%82%b9%e6%95%b0%e8%b7%a8%e5%b9%b3%e5%8f%b0%e4%ba%a7%e7%94%9f%e7%9a%84%e9%97%ae%e9%a2%98","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/11235.html","title":{"rendered":"\u4e00\u4e2a\u6d6e\u70b9\u6570\u8de8\u5e73\u53f0\u4ea7\u751f\u7684\u95ee\u9898"},"content":{"rendered":"<p><strong>\u611f\u8c22\u7f51\u53cb<a href=\"http:\/\/www.tanglei.name\/\" target=\"_blank\">\u5510\u78ca<\/a>\uff08\u5fae\u535a@<a title=\"\u5510\u78ca_name\" href=\"http:\/\/weibo.com\/tangleithu?from=feed&amp;loc=nickname\">\u5510\u78ca_name<\/a>\uff09\u6295\u7a3f\uff0c\u672c\u6587\u539f\u6587\u5728\u5510\u78ca\u7684\u535a\u5ba2\u4e0a\uff08<a href=\"http:\/\/www.tanglei.name\/a-bug-relate-with-float-point-between-x86-and-x64-in-csharp\/\">\u539f\u6587\u5730\u5740<\/a>\uff09\uff0c\u539f\u6587\u5206\u6790\u8fd8\u4e0d\u591f\u597d\uff0c\u800c\u4e14\u53ef\u80fd\u5bf9\u4eba\u6709\u8bef\u5bfc\uff0c\u6240\u4ee5\uff0c\u6211\u5bf9\u539f\u6587\u505a\u4e86\u5f88\u591a\u4fee\u6539\uff0c\u5e76\u52a0\u4e86Linux\u4e0b\u7684\u5185\u5bb9\u3002\u6d6e\u70b9\u6570\u662f\u4e00\u4e2a\u5f88\u590d\u6742\u7684\u4e8b\u60c5\uff0c\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u6709\u52a9\u4e8e\u5927\u5bb6\u4e86\u89e3\u6d6e\u70b9\u6570\u4e0e\u5176\u76f8\u5173\u7684C\/C++\u7684\u7f16\u8bd1\u9009\u9879\u3002<\/strong>\uff08\u6ce8\uff1a\u6211\u6ca1\u6709Windows 32\u4f4d\u4ee5\u53caC#\u7684\u73af\u5883\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8eWindows 32\u4f4d\u7684\u7a0b\u5e8f\u548cC#\u7684\u7a0b\u5e8f\u6ca1\u6709\u9a8c\u8bc1\u8fc7\uff09<\/p>\n<p>\u80cc\u666f\u5c31\u7b80\u5355\u70b9\u513f\u8bf4\uff0c\u6700\u8fd1\u4e00\u4e2a\u9879\u76eeC#\u7f16\u5199\uff0c\u6d89\u53ca\u6d6e\u70b9\u8fd0\u7b97\uff0c\u6765\u9f99\u53bb\u8109\u7701\u53bb\uff0c\u76f4\u63a5\u770b\u5982\u4e0b\u4ee3\u7801\u3002<\/p>\n<pre data-enlighter-language=\"csharp\" class=\"EnlighterJSRAW\">float p3x = 80838.0f;\r\nfloat p2y = -2499.0f;\r\ndouble v321 = p3x * p2y;\r\nConsole.WriteLine(v321);<\/pre>\n<p>\u5f88\u7b80\u5355\u5427\uff0c\u9a6c\u4e0a\u7b14\u7b97\u4e0b\u7ed3\u679c\u4e3a-202014162\uff0c\u6ca1\u95ee\u9898\uff0c\u96be\u9053C#\u6ca1\u6709\u4ea7\u751f\u8fd9\u6837\u7684\u7ed3\u679c\uff1f\u4e0d\u53ef\u80fd\u5427\uff0c\u5f00\u542fVisual Studio\uff0ccopy\u4ee3\u7801\u8bd5\u8bd5\uff0c\u679c\u7136\u7ed3\u679c\u662f-202014162\u3002\u5c31\u8fd9\u6837\u5b8c\u4e86\u4e48\uff1f\u663e\u7136\u6ca1\u6709\uff01\u4f60\u628a\u7f16\u8bd1\u65f6\u7684\u9009\u9879\u4eceAnyCPU\u6539\u6210x64\u8bd5\u8bd5~(\u670d\u52a1\u5668\u73af\u5883\u6b63\u662f64\u4f4d\u6ef4\u54e6\uff01\uff01)\u7ed3\u679c\u5c45\u7136\u8fb9\u6210\u4e86-202014160\uff0c\u5bf9\u6ca1\u9519\uff0c\u5c31\u662f-202014160\u3002\u6709\u70b9\u4e0d\u76f8\u4fe1\uff0c\u518d\u8dd1\u4e24\u904d\uff0c\u4ecd\u7136\u662f-202014160\u3002\u5443\uff0c\u60f3\u901a\u4e86\uff0c\u56e0\u4e3a\u6d6e\u70b9\u8fd0\u7b97\u7684\u8bef\u5dee\uff0c-202014160\u8fd9\u4e2a\u7ed3\u679c\u662f\u5408\u7406\u7684\u3002<\/p>\n<p>\u4e3a\u4ec0\u4e48\u5408\u7406\u5462\uff1f\u5f88\u6b63\u5e38\uff0c\u56e0\u4e3a\u4e0a\u9762\u7684p3x\u548cp2y\u662f\u4e24\u4e2afloat\u7c7b\u578b\uff0c\u867d\u7136v321\u662fdouble\uff0c\u4f46\u4e5f\u662f\u4e24\u4e2afloat\u7c7b\u578b\u8ba1\u7b97\u5b8c\u540e\u518d\u8f6c\u6210double\u7684\uff0c<strong>float\u7684\u7cbe\u5ea6\u672c\u6765\u4e5f\u53ea\u67097\u4f4d\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u4e0a\u4ebf\u7684\u6570\uff0c\u81ea\u7136\u6ca1\u6709\u529e\u6cd5\u4fdd\u8bc1\u7cbe\u5ea6<\/strong>\u3002<\/p>\n<p><strong>\u4f46\u662f\u4e3a\u4ec0\u4e48\u4fee\u6539CPU\u7684type\u4f1a\u6709\u4e0d\u540c\u7684\u6548\u679c\uff1f<\/strong>\u55ef\uff0c\u6211\u4eec\u518d\u8bd5\u8bd5C\/C++\u3002<\/p>\n<p><!--more--><\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">#include\r\nusing namespace std;\r\n\r\nint main()\r\n{\r\n    float p3x = 80838.0f;\r\n    float p2y = -2499.0f;\r\n    double v321 = p3x * p2y;\r\n    std::cout.precision(15);\r\n    std::cout &lt;&lt; v321 &lt;&lt; std::endl;\r\n\r\n    return 0;\r\n}\r\n<\/pre>\n<p>\u4e0a\u9762\u8fd9\u6bb5C++\u4ee3\u7801\u5728\u4e0d\u540c\u7684\u5e73\u53f0\u4e0b\u7684\u7ed3\u679c\u5982\u4e0b\uff1a<\/p>\n<ul>\n<li>Windows 32\/64\u4f4d\u4e0b\uff1a-202014160<\/li>\n<li>Linux 64\u4f4d\u4e0b\uff08CentOS 6 gcc 4.4.7\uff09-202014160\uff0c<\/li>\n<li>Linux 32\u4f4d\u4e0b\uff08Ubuntu 12.04+ gcc 4.6.3\uff09\u662f\uff1a-202014162<\/li>\n<\/ul>\n<p><strong>\u5408\u7406\u7684\u7ed3\u679c\u5e94\u8be5\u662f-202014160\uff0c\u6b63\u786e\u7684\u8fd0\u7b97\u7ed3\u679c\u662f-202014162<\/strong>\uff0c\u5408\u7406\u6027\u662f\u6d6e\u70b9\u7cbe\u5ea6\u4e0d\u591f\u9020\u6210\u7684\uff08\u6587\u540e\u89e3\u91ca\u4e86\u5408\u7406\u6027\uff09\u3002\u82e5\u662f\u7528\u4e24\u4e2adouble\u76f8\u4e58\u53ef\u5f97\u6b63\u786e\u4e14\u5408\u7406\u7684\u8fd0\u7b97\u7ed3\u679c\uff08\u6ce8\uff1a\u628a\u4e0a\u9762C++\u7684\u7a0b\u5e8f\u4e2d\u7684p3x\u548cp2y\u7684\u7c7b\u578b\u58f0\u660e\u6210double\uff0c\u5c31\u80fd\u5f97\u5230\u6b63\u786e\u7684\u7ed3\u679c\uff0c\u56e0\u4e3adouble\u662f\u53cc\u7cbe\u5ea6\u7684\uff0cfloat\u662f\u5355\u7cbe\u5ea6\uff0c\u6240\u4ee5double\u6709\u8db3\u591f\u7684\u4f4d\u6570\u5b58\u653e\u66f4\u591a\u7684\u6570\u4f4d\uff09\u3002<strong>\u4f46\u662f\u6211\u4eec\u6709\u70b9\u4e0d\u660e\u767d\uff0c\u4e3a\u4ec0\u4e48Linux 32\u4f4d\u4e0b\uff0c\u5c45\u7136\u80fd\u7b97\u51fa\u201c\u6b63\u786e\u201d\u7684\u6570\uff0c\u800c\u4e0d\u662f\u201c\u5408\u7406\u201d\u7684\u6570<\/strong>\u3002<\/p>\n<p>\u4e0eC++\u4e00\u6837\uff0cC#\u572832\u4f4d\u548c64\u4f4d\uff08DEBUG\u4e0b\uff0c\u8fd9\u4e2a\u540e\u9762\u4f1a\u8bf4\uff09\u4e0b\u6ca1\u6709\u5f97\u5230\u4e00\u81f4\u7684\u7ed3\u679c\uff0c\u90a3\u6211\u4eec\u6765\u770b\u4e00\u4e0bC++\/C#\u7684\u6c47\u7f16\u4ee3\u7801\uff08\u4f7f\u7528gdb\u7684disassemble \/m main \u547d\u4ee4\uff0c\u53e6\u5916\u4e0b\u9762\u53ea\u663e\u793a float * float \u7136\u540e\u8f6c\u6210double\u7684\u90a3\u4e00\u884c\u4ee3\u7801\u7684\u6c47\u7f16\uff09<\/p>\n<p><strong>Linux\u5e73\u53f0\u4e0b\u7528G++\u7f16\u8bd1<\/strong><\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\/\/C++ 32\u4f4d\u7cfb\u7edf\u4e0b Ubuntu 12.04\r\n8\t    double v321 = p3x * p2y;\r\n   0x0804860f &lt;+27&gt;:\tflds   0x18(%esp)\r\n   0x08048613 &lt;+31&gt;:\tfmuls  0x1c(%esp)\r\n   0x08048617 &lt;+35&gt;:\tfstpl  0x10(%esp)\r\n\r\n.......<\/pre>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\/\/C++ 64\u4f4d\u7cfb\u7edf\u4e0b CentOS 6\r\n9           double v321 = p3x * p2y;\r\n   0x000000000040083c &lt;+24&gt;:    movss  -0x20(%rbp),%xmm0\r\n   0x0000000000400841 &lt;+29&gt;:    mulss  -0x1c(%rbp),%xmm0\r\n   0x0000000000400846 &lt;+34&gt;:    unpcklps %xmm0,%xmm0\r\n   0x0000000000400849 &lt;+37&gt;:    cvtps2pd %xmm0,%xmm0\r\n   0x000000000040084c &lt;+40&gt;:    movsd  %xmm0,-0x18(%rbp)<\/pre>\n<p><strong>Windows\u5e73\u53f0\u4e0b\u7528Visual Studio\u7f16\u8bd1<\/strong><\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\/\/C# AnyCPU\u7f16\u8bd1\uff0cWindows VS2012\r\ndouble v321 = p3x * p2y;\r\n00000049  fld         dword ptr [ebp-40h]\r\n0000004c  fmul        dword ptr [ebp-44h]\r\n0000004f  fstp        qword ptr [ebp-4Ch]<\/pre>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\/\/C# X64\u4f4d\u7f16\u8bd1 Windows7 VS2012\r\ndouble v321 = p3x * p2y;&lt;\/pre&gt;\r\n009B43B8 movss xmm0,dword ptr [p3x]\r\n009B43BD mulss xmm0,dword ptr [p2y]\r\n009B43C2 cvtss2sd xmm0,xmm0\r\n009B43C6 movsd mmword ptr [v321],xmm0<\/pre>\n<p>\u4ece\u4e0a\u9762\u7684\u6c47\u7f16\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff0c\u65e0\u8bba\u662fLinux\u548cWindows\uff0cC++\u6216C# 32\u4f4d\u548c64\u5bf9\u6d6e\u70b9\u6570\u7684\u6c47\u7f16\u6307\u4ee4\u5e76\u4e0d\u4e00\u6837\u3002 32\u4f4d\u751f\u6210\u4ee3\u7801\u7528\u7684\u6307\u4ee4\u662ffld\/fmul\/fstp\u7b49\uff0c\u800c64\u4f4d\u4e0b\u7684\u4f7f\u7528\u4e86movss\/mulss\/movsd\/\u7684\u6307\u4ee4\u3002\u770b\u4e0b\u6765\uff0c\u4f3c\u4e4e\u8fd9\u4e2a\u4e8b\u60c5\u548c\u5e73\u53f0\u6709\u5173\u7cfb\u3002<\/p>\n<p>\u6211\u4eec\u7ee7\u7eed\u8c03\u67e5\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u5176\u4e2dfld\/fmul\/fstp\u7b49\u6307\u4ee4\u662f\u7531<strong>FPU<\/strong>(float point unit)\u6d6e\u70b9\u8fd0\u7b97\u5904\u7406\u5668\u505a\u7684\uff0c\u51c6\u786e\u7684\u8bf4\uff0c\u662fFPU x87\u6307\u4ee4\uff0cFPU\u5728\u8fdb\u884c\u6d6e\u70b9\u8fd0\u7b97\u65f6\uff0c\u7528\u4e86<strong>80\u4f4d<\/strong>\u7684\u5bc4\u5b58\u5668\u505a\u76f8\u5173\u6d6e\u70b9\u8fd0\u7b97\uff0c\u7136\u540e\u518d\u6839\u636e\u662ffloat\/double\u622a\u53d6\u621032\u4f4d\u621664\u4f4d\uff0cFPU\u9ed8\u8ba4\u4e0a\u4f1a\u5c3d\u91cf\u51cf\u5c11\u7531\u4e8e\u9700\u8981\u56db\u820d\u4e94\u5165\u5e26\u6765\u7684\u7cbe\u5ea6\u95ee\u9898\u3002\u53ef\u53c2\u770b\u6d6e\u70b9\u8fd0\u7b97\u6807\u51c6<a href=\"http:\/\/en.wikipedia.org\/wiki\/IEEE_floating_point\" target=\"_blank\">IEEE-754<\/a>\u00a0\u63a8\u8350\u6807\u51c6\u5b9e\u73b0\u8005\u63d0\u4f9b\u6d6e\u70b9\u53ef\u6269\u5c55\u7cbe\u5ea6\u683c\u5f0f(<a href=\"http:\/\/en.wikipedia.org\/wiki\/Extended_precision\" target=\"_blank\">Extended precision<\/a>)\uff0cIntel x86\u5904\u7406\u5668\u6709FPU(float point unit)\u6d6e\u70b9\u8fd0\u7b97\u5904\u7406\u5668\u652f\u6301\u8fd9\u79cd\u6269\u5c55\u3002<\/p>\n<p>\u975eFPU\u7684\u60c5\u51b5\u662f\u7528\u4e86SSE\u4e2d128\u4f4d\u5bc4\u5b58\u5668(float\u5b9e\u9645\u53ea\u7528\u4e86\u5176\u4e2d\u768432\u4f4d\uff0c\u8ba1\u7b97\u65f6\u4e5f\u662f\u4ee532\u4f4d\u8ba1\u7b97\u7684)\uff0c\u8fd9\u5c31\u662f\u5bfc\u81f4\u4e0a\u8ff0\u95ee\u9898\u4ea7\u751f\u7684\u6700\u7ec8\u539f\u56e0\u3002\u8be6\u7ec6\u5206\u6790\u89c1\u6587\u672b\u8bf4\u660e\u3002<\/p>\n<p>\u77e5\u9053\u4e86\u8fd9\u4e00\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5man g++ \u770b\u4e00\u4e0b\u6587\u6863\uff0c\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u7f16\u8bd1\u9009\u9879\u53eb\uff1a<strong>-mfpmath\uff0c\u572832\u4f4d\u4e0b\uff0c\u8fd9\u4e2a\u7f16\u8bd1\u9009\u9879\u7684\u9ed8\u8ba4\u503c\u662f\uff1a387\uff0c\u4e5f\u5c31\u662fx87 FPU\u6307\u4ee4\uff0c\u572864\u4f4d\u4e0b\uff0c\u8fd9\u4e2a\u7f16\u8bd1\u9009\u9879\u7684\u503c\u662fsse\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528SSE\u7684\u6307\u4ee4<\/strong>\u3002\u6240\u4ee5\uff0c\u5c31\u8fd9\u7bc7\u6587\u7ae0\u4e2d\u7684\u8fd9\u4e2a\u4f8b\u5b50\u800c\u8a00\uff0c\u5982\u679c\u4f60\u572864bits\u4e0b\u52a0\u4e0a\u5982\u00a0-mfpmath=387\uff0c\u4f60\u4f1a\u5f97\u5230\u201c\u6b63\u786e\u7684\u201d\u7ed3\u679c\uff0c\u800c\u4e0d\u662f\u201c\u5408\u7406\u7684\u201d\u7ed3\u679c\u3002<\/p>\n<p>\u800c\u5728VS2012\u4e2dC++\uff0c<a href=\"http:\/\/msdn.microsoft.com\/zh-cn\/library\/vstudio\/e7s85ffb(v=vs.110).aspx\" target=\"_blank\">\u7f16\u8bd1\u9009\u9879\u53ef\u4ee5\u8bbe\u7f6e(\u4ee3\u7801\u751f\u6210\u4e2d)<\/a>\u53ef\u9009\uff0c\/fp:[precise | fast | strict]\uff0c\u672c\u4f8b\u4e2dRelease 32\u4f4d\u4e0b\u7528precise \u6216\u8005 strict\u5c06\u5f97\u5230\u5408\u7406\u7684\u7ed3\u679c(-202014160)\uff0cfast\u5c06\u4ea7\u751f\u6b63\u786e\u7684\u7ed3\u679c(-202014162), fast debug\/release\u4e0b\u7ed3\u679c\u4e5f\u4e0d\u4e00\u6837\u54e6(release\u4e0b\u624d\u4f18\u5316\u4e86)\u300264\u7cfb\u7edf\u4e0b\u5404\u4e2a\u7ed3\u679c\u53ef\u4ee5\u5927\u5bb6\u81ea\u5df1\u53bb\u6d4b\u8bd5\u4e0b(Debug\/Release)\uff0c\u5206\u522b\u770b\u770bVS\u7f16\u8bd1\u540e\u4ea7\u751f\u7684\u4e2d\u95f4\u4ee3\u7801\u957f\u4ec0\u4e48\u6837\u3002\uff08\u9648\u7693\u6ce8\uff1a\u6211\u7684VS2012\u5728debug\u7f16\u8bd1\u4e0b\uff0c\u65e0\u8bba\u4f60\u600e\u4e48\u8bbe\u7f6e\/fp\u7684\u53c2\u6570\u503c\uff0c\u6c47\u7f16\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4f7f\u7528SSE\u6307\u4ee4\uff0c\u800cRelease\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u4f46\u662f\u6211\u7684release\u4e0b\u770b\u4ee3\u7801\u7684\u6c47\u7f16\u975e\u5e38\u602a\u5f02\u548c\u6e90\u4ee3\u7801\u5bf9\u4e0a\u53f7\uff0c\u591a\u5e74\u4e0d\u7528Windows\u5f00\u53d1\u4e86\uff0c\u5bf9VS\u7684\u4f7f\u7528\u4ec5\u505c\u7559\u5728VC6++\/VC2005\u4e0a\uff09<\/p>\n<p>\u6240\u4ee5\uff0c\u6211\u4eec\u5728\u4ecex87 FPU\u6307\u4ee4\u5411SSE\u6307\u4ee4\u505a\u4ee3\u7801\u79fb\u690d\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u9047\u5230\u5411\u8fd9\u6837\u7684\u6d6e\u70b9\u6570\u7684\u7cbe\u5ea6\u95ee\u9898\uff0c\u8fd9\u4e2a\u7cbe\u5ea6\u95ee\u9898\u4f1a\u591a\u6b21\u79d1\u5b66\u8ba1\u7b97\u4e2d\u4f1a\u66f4\u7cdf\u7cd5\u3002<strong>\u8fd9\u4e2a\u95ee\u9898\u5e76\u4e0d\u7b80\u5355\u7684\u53ea\u662f\u572832\u4f4d\u548c64\u4f4d\u4e2d\u7684\u7cfb\u7edf\u51fa\u7b97\uff0c\u8fd9\u4e2a\u95ee\u9898\u4e3b\u8981\u8fd8\u662f\u770b\u8bed\u8a00\u7f16\u8bd1\u5668\u7684\u5b9e\u73b0<\/strong>\u3002\u5728\u66f4\u4e3a\u9ad8\u7ea7\u7684\u8bed\u8a00\u4e2d\uff0c\u5982\uff1aC99\u6216Fortran 2003\u4e2d\uff0c\u5f15\u5165\u4e86\u201clong double\u201d\u6765\u505a\u53ef\u6269\u5c55\u53cc\u7cbe\u5ea6\uff08Extension Double\uff09\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6d88\u9664\u66f4\u591a\u7684\u7cbe\u5ea6\u95ee\u9898\u3002<\/p>\n<p>\u4e0b\u9762\u6211\u4eec\u628a\u7a0b\u5e8f\u6539\u6210long double\uff0c\uff08\u6ce8\uff1a\u5176\u4e2d\u7684\u7c7b\u578b\u53d8\u6210long double\uff09<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">#include\r\nusing namespace std;\r\n\r\nint main()\r\n{\r\n    long double p3x = 80838.0;\r\n    long double p2y = -2499.0;\r\n    long double v321 = p3x * p2y;\r\n    std::cout.precision(15);\r\n    std::cout &lt;&lt; v321 &lt;&lt; std::endl;\r\n\r\n    return 0;\r\n}<\/pre>\n<p>\u7528gdb\u7684disassemble \/m main\u4f60\u4f1a\u770b\u5230\u5176\u4e2d\u7684\u8fd0\u7b97\u7684\u6c47\u7f16\u5982\u4e0b\uff08\u4f7f\u7528\u4e86fmlp\u6307\u4ee4\uff09\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\/\/linux 32\u4f4d\u7cfb\u7edf\r\n8\t    long double v321 = p3x * p2y;\r\n   0x08048633 &lt;+63&gt;:\tfldt   0x10(%esp)\r\n   0x08048637 &lt;+67&gt;:\tfldt   0x20(%esp)\r\n   0x0804863b &lt;+71&gt;:\tfmulp  %st,%st(1)\r\n   0x0804863d &lt;+73&gt;:\tfstpt  0x30(%esp)\r\n<\/pre>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\/\/linux 64\u4f4d\u7cfb\u7edf\r\n8           long double v321 = p3x * p2y;\r\n   0x0000000000400818 &lt;+52&gt;:    fldt   -0x30(%rbp)\r\n   0x000000000040081b &lt;+55&gt;:    fldt   -0x20(%rbp)\r\n   0x000000000040081e &lt;+58&gt;:    fmulp  %st,%st(1)\r\n   0x0000000000400820 &lt;+60&gt;:    fstpt  -0x10(%rbp)\r\n<\/pre>\n<p><span style=\"line-height: 1.5em;\">\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c32\u4f4d\u7cfb\u7edf\u548c64\u4f4d\u7cfb\u7edf\u4f7f\u7528\u4e86\u540c\u6837\u7684\u6c47\u7f16\u6307\u4ee4\uff08\u5f53\u7136\uff0c\u6211\u6ca1\u6709\u90a3\u4e48\u591a\u7269\u7406\u673a\uff0c\u6211\u53ea\u662f\u5728VMWare Play\u7684\u865a\u62df\u673a\u4e0a\u6d4b\u8bd5\u7684\uff0c\u6240\u4ee5\u4e0a\u9762\u7684\u793a\u4f8b\u5e76\u4e0d\u4e00\u5b9a\u9002\u7528\u4e8e\u6240\u6709\u7684\u5730\u65b9\uff0c\u53e6\u5916\uff0cC\/C++\u8bed\u8a00\u548c\u7f16\u8bd1\u5668\u548c\u5e73\u53f0\u6709\u975e\u5e38\u5927\u7684\u5173\u7cfb\uff09 \uff0c\u539f\u56e0\u81ea\u7136\u662f\u6211\u4eec\u7528\u5230\u4e86long double\u8fd9\u4e2a\u6269\u5c55\u53cc\u7cbe\u5ea6\u7684\u6570\u636e\u7c7b\u578b\u3002\uff08\u6ce8\uff1a\u5982\u679c\u4f60\u7528double\u6216float\uff0c\u5728Linux\u4e0a\uff0c32\u4f4d\u7528x87 FPU \u6307\u4ee4\u7f16\u8bd1\uff0c\u800c64\u4f4d\u7528SSE\u6307\u4ee4\u7f16\u8bd1\uff09<\/span><\/p>\n<p>\u597d\u4e86\uff0c\u6211\u4eec\u518d\u56de\u5230C#\u4e0a\u6765\uff0c<span style=\"line-height: 1.5em;\">C#\u7684\u6d6e\u70b9\u662f\u652f\u6301\u8be5\u6807\u51c6\u7684\uff0c\u5176\u4e2d<\/span><a style=\"line-height: 1.5em;\" href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/aa691146(v=vs.71).aspx\">\u5176\u5b98\u65b9\u6587\u6863<\/a><span style=\"line-height: 1.5em;\">\u4e5f\u63d0\u5230\u4e86\u6d6e\u70b9\u8fd0\u7b97\u53ef\u80fd\u4f1a\u4ea7\u751f\u6bd4\u8fd4\u56de\u7c7b\u578b\u66f4\u9ad8\u7cbe\u5ea6\u7684\u503c\uff08\u6b63\u5982\u4e0a\u9762\u7684\u8fd4\u56de\u503c\u7cbe\u5ea6\u5c31\u8d85\u8fc7\u4e86float\u7684\u7cbe\u5ea6\uff09\uff0c\u5e76\u8bf4\u660e\u5982\u679c\u786c\u4ef6\u652f\u6301\u53ef\u6269\u5c55\u6d6e\u70b9\u7cbe\u5ea6\u7684\u8bdd\uff0c\u90a3\u4e48<\/span><strong style=\"line-height: 1.5em;\">\u6240\u6709\u7684<\/strong><span style=\"line-height: 1.5em;\">\u6d6e\u70b9\u8fd0\u7b97\u90fd\u5c06\u7528\u6b64\u7cbe\u5ea6\u8fdb\u884c\u4ee5\u63d0\u9ad8\u6548\u7387\uff0c\u4e3e\u4e2a\u4f8b\u5b50x*y\/z, x*y\u7684\u503c\u53ef\u80fd\u90fd\u5728double\u7684\u80fd\u529b\u8303\u56f4\u4e4b\u5916\u4e86\uff0c\u4f46\u771f\u5b9e\u60c5\u51b5\u53ef\u80fd\u9664\u4ee5z\u540e\u53c8\u80fd\u628a\u7ed3\u679c\u62c9\u56de\u5230double\u8303\u56f4\u5185\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u7528\u4e86FPU\u7684\u7ed3\u679c\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a\u51c6\u786e\u7684double\u503c\uff0c\u800c\u975eFPU\u7684\u5c31\u662f\u65e0\u7a77\u5927\u4e4b\u7c7b\u7684\u4e86\u3002<\/span><\/p>\n<p><span style=\"line-height: 1.5em;\">\u6240\u4ee5\uff0c\u5bf9\u4e8e<\/span>C#\u6765\u8bf4\uff0c\u4f60\u663e\u7136\u65e0\u6cd5\u627e\u5230\u4e00\u4e2a\u50cfC\/C++\u4e00\u6837\u7684\u5229\u7528\u7f16\u8bd1\u5668\u9009\u9879\u7684\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u201c\u89e3\u51b3\u65b9\u6848\u201d\uff08\u5176\u5b9e\uff0c\u7528\u7f16\u8bd1\u5668\u53c2\u6570\u662f\u4e00\u4e2a\u4f2a\u89e3\u51b3\u65b9\u6848\uff09<span style=\"line-height: 1.5em;\">\u3002<\/span><\/p>\n<p><span style=\"line-height: 1.5em;\"><strong>\u800c\u4e14\uff0c\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e5f\u4e0d\u662f\u8981\u4fee\u6539\u7f16\u8bd1\u5668\u9009\u9879\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u95ee\u9898\u660e\u663e\u4e0d\u662fFPU\u6216\u662fSSE\u7684\u95ee\u9898\uff0cFPU\u662f\u4e2a\u8fc7\u65f6\u7684\u6280\u672f\uff0cSSE\u624d\u662f\u5408\u7406\u7684\u6280\u672f\uff0c\u6240\u4ee5\uff0c<span style=\"color: #cc0000;\">\u5982\u679c\u4f60\u4e0d\u60f3\u4f60\u7684\u6d6e\u70b9\u6570\u5728\u8ba1\u7b97\u4e0a\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u800c\u4e14\u4f60\u9700\u8981\u7cbe\u5ea6\u51c6\u786e\uff0c\u6b63\u786e\u7684\u89e3\u51b3\u65b9\u6848\u4e0d\u662f\u641e\u7f16\u8bd1\u53c2\u6570\uff0c\u800c\u662f\u2014\u2014\u4f60\u4e00\u5b9a\u8981\u4f7f\u7528\u7cbe\u5ea6\u66f4\u9ad8\u5b57\u8282\u6570\u66f4\u591a\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6bd4\u5982\uff1adouble \u6216\u662flong double<\/span>\u3002<\/strong><\/span><\/p>\n<p>\u53e6\u5916\uff0c\u5927\u5bb6\u5728\u5199\u4ee3\u7801\u7684\u65f6\u5019\u5f97\u4fdd\u8bc1\u5b9e\u9645\u8fd0\u884c\u73af\u5883\/\u6d4b\u8bd5\u73af\u5883\/\u5f00\u53d1\u73af\u5883\u7684<strong>\u4e00\u81f4\u6027(\u5305\u62ecOS\u67b6\u6784\u554a\u3001\u7f16\u8bd1\u9009\u9879\u7b49)<\/strong>\u554a\uff08<strong>\u5c24\u5176\u662fC\/C++ \u800c\u4e14\uff0c\u7f16\u8bd1\u5668\u4e0a\u7684\u53c2\u6570\u53ef\u80fd\u4f1a\u6709\u5f88\u591a\u5751\uff0c\u800c\u4e14\u6709\u4e9b\u5751\u53ef\u80fd\u4f1a\u63a9\u76d6\u4f60\u7a0b\u5e8f\u4e2d\u7684\u95ee\u9898<\/strong>\uff09\uff0c\u4e0d\u7136\u83ab\u540d\u5176\u5999\u7684\u95ee\u9898\u4f1a\u4ea7\u751f\uff08\u672c\u6587\u5c31\u662f\u5f00\u53d1\u73af\u5883\u4e0e\u8fd0\u884c\u73af\u5883\u4e0d\u4e00\u81f4\u5bfc\u81f4\u7684\u95ee\u9898\uff0c\u7ea0\u7ed3\u4e86\u597d\u4e45\u624d\u53d1\u73b0\u662f\u8fd9\u4e2a\u539f\u56e0\uff09\uff1b\u9047\u5230\u6d89\u53ca\u6d6e\u70b9\u8fd0\u7b97\u7684\u65f6\u5019\u522b\u5fd8\u4e86\u6709\u53ef\u80fd\u662f\u8fd9\u4e2a\u539f\u56e0\u4ea7\u751f\u7684\uff1b<strong>float\/double\u6df7\u7528\u7684\u60c5\u51b5\u5f97\u7279\u522b\u6ce8\u610f<\/strong>\u3002<\/p>\n<p><strong>Reference\uff1a<\/strong><\/p>\n<p>[1] <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/aa691146(v=vs.71).aspx\">C# Language Specification Floating point types<\/a><br \/>\n[2] <a href=\"http:\/\/stackoverflow.com\/questions\/6683059\/are-floating-point-numbers-consistent-in-c-can-they-be\">Are floating-point numbers consistent in C#? Can they be? <\/a><br \/>\n[3] <a href=\"http:\/\/www.plantation-productions.com\/Webster\/www.artofasm.com\/Linux\/HTML\/RealArithmetica2.html\">The FPU Instruction Set<\/a><\/p>\n<h4><strong>\u9644\u5f55<\/strong><\/h4>\n<h5><strong>80838.0f * -2499.0f = -202014160.0\u6d6e\u70b9\u8fd0\u7b97\u8fc7\u7a0b\u7684\u8bf4\u660e<\/strong><\/h5>\n<p>32\u4f4d\u6d6e\u70b9\u6570\u5728\u8ba1\u7b97\u673a\u4e2d\u7684\u8868\u793a\u65b9\u5f0f\u4e3a\uff1a1\u4f4d\u7b26\u53f7\u4f4d(s)-8\u4f4d\u6307\u6570\u4f4d(E)-23\u4f4d\u6709\u6548\u6570\u5b57(M)\u3002<br \/>\n32\u4f4dFloat = (-1)^s * (1+m) * 2^(e-127), \u5176\u4e2de\u662f\u5b9e\u9645\u8f6c\u6362\u62101.xxxxx*2^e\u7684\u6307\u6570,m\u662f\u524d\u9762\u7684xxxxx(\u8282\u7ea61\u4f4d)<\/p>\n<p>80838.0f = 1 0011 1011 1100 0110.0= 1.00111011110001100*2^16<br \/>\n\u6709\u6548\u4f4dM = 0011 1011 1100 0110 0000 000<br \/>\n\u6307\u6570\u4f4dE = 16 + 127 = 143 =\u00a0 10001111<br \/>\n\u5185\u90e8\u8868\u793a 80838.0 =\u00a0 0 [1000 1111] [0011 1011 1100 0110 0000 000]<br \/>\n= 0100 0111 1001 1101 1110 0011 0000 0000<br \/>\n= 47 9d e3 00 \/\/\u5b9e\u9645\u8c03\u8bd5\u65f6\u770b\u5230\u7684\u5185\u5b58\u503c \u53ef\u80fd\u662f00 e3 9d 47\u662f\u56e0\u4e3a\u8c03\u8bd5\u73af\u5883\u7528\u4e86\u5c0f\u7aef\u8868\u793a\u6cd5\u6cd5\uff1a\u4f4e\u4f4d\u5b57\u8282\u6392\u5185\u5b58\u4f4e\u5730\u5740\u7aef\uff0c\u9ad8\u4f4d\u6392\u5185\u5b58\u9ad8\u5730\u5740<\/p>\n<p>-2499.0 = -100111000011.0 = -1.001110000110 * 2^11<br \/>\n\u6709\u6548\u4f4dM = 0011 1000 0110 0000 0000 000<br \/>\n\u6307\u6570\u4f4dE = 11+127=138= 10001010<br \/>\n\u7b26\u53f7\u4f4ds = 1<br \/>\n\u5185\u90e8\u8868\u793a-2499.0 = 1 [10001010] [0011 1000 0110 0000 0000 000]<br \/>\n=1100 0101 0001 1100 0011 0000 0000 0000<br \/>\n=c5 1c 30 00<\/p>\n<p>80838.0 * -2499.0 = ?<\/p>\n<p>\u9996\u5148\u662f\u6307\u6570 e = 11+16 = 27<br \/>\n\u6307\u6570\u4f4dE = e + 127 = 154 = 10011010<br \/>\n\u6709\u6548\u4f4d\u76f8\u4e58\u7ed3\u679c\u4e3a 1.1000 0001 0100 1111 1011 1010 01 \/\/\u53ef\u4ee5\u81ea\u5df1\u52a8\u624b\u5b9e\u9645\u7b97\u4e0b<br \/>\n\u5b9e\u9645\u4e2d\u53ea\u80fd\u670923\u4f4d\uff0c\u540e\u9762\u7684\u88ab\u622a\u65ad\u53731000 0001 0100 1111 1011 101<span style=\"text-decoration: line-through;\">0 01 <\/span><br \/>\n\u76f8\u4e58\u7ed3\u679c\u5185\u90e8\u8868\u793a=1[10011010][1000 0001 0100 1111 1011 101]<br \/>\n= 1100 1101 0100 0000 1010 0111 1101 1101<br \/>\n= cd 40 a7 dd<\/p>\n<p>\u7ed3\u679c =\u00a0 -1.1000 0001 0100 1111 1011 101 *2^27<br \/>\n=\u00a0 -11000 0001 0100 1111 1011 1010000<br \/>\n=\u00a0 -202014160<br \/>\n\u518d\u8f6c\u6210double\u540e\u8fd8\u662f-202014160.<\/p>\n<p>\u5982\u679c\u662fFPU\u7684\u8bdd\uff0c\u4e0a\u9762\u7684\u6709\u6548\u4f4d\u7ed3\u679c\u4e0d\u4f1a\u88ab\u622a\u65ad\uff0c\u5373<br \/>\nFPU\u7ed3\u679c = -1.1000 0001 0100 1111 1011 101<strong>001<\/strong> *2^27<br \/>\n= -11000 0001 0100 1111 1011 101<strong>001<\/strong>0<br \/>\n= -202014162<\/p>\n<p>\u5168\u6587\u5b8c\uff0c\u82e5\u672c\u6587\u6709\u7eb0\u6f0f\u4e4b\u5904\u6b22\u8fce\u6307\u6b63\u3002<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>\u611f\u8c22\u7f51\u53cb\u5510\u78ca\uff08\u5fae\u535a@\u5510\u78ca_name\uff09\u6295\u7a3f\uff0c\u672c\u6587\u539f\u6587\u5728\u5510\u78ca\u7684\u535a\u5ba2\u4e0a\uff08\u539f\u6587\u5730\u5740\uff09\uff0c\u539f\u6587\u5206\u6790\u8fd8\u4e0d\u591f\u597d\uff0c\u800c\u4e14\u53ef\u80fd\u5bf9\u4eba\u6709\u8bef\u5bfc\uff0c\u6240\u4ee5\uff0c\u6211\u5bf9\u539f\u6587\u505a\u4e86\u5f88\u591a\u4fee\u6539\uff0c\u5e76\u52a0\u4e86Linux&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/11235.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":22671,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[189,5],"tags":[361,59,721,720,719],"series":[],"aioseo_notices":[],"views":34785,"post_thumbnail_image":"","content_first_image":"","post_medium_image_300":"","post_thumbnail_image_624":"","post_frist_image":"","post_medium_image":"","post_large_image":"","post_full_image":"","post_all_images":[],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":25,"category_name":".NET\u7f16\u7a0b","post_date":"2014-03-15","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[],"pageviews":34786,"pageviews_wl":10770,"ratings_average":3,"ratings_total":69,"ratings_users":19,"next_post_id":11377,"next_post_title":"C\u8bed\u8a00\u7ed3\u6784\u4f53\u91cc\u7684\u6210\u5458\u6570\u7ec4\u548c\u6307\u9488","previous_post_id":11112,"previous_post_title":"\u7531\u82f9\u679c\u7684\u4f4e\u7ea7Bug\u60f3\u5230\u7684"}