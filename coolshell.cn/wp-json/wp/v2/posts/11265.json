{"id":11265,"date":"2014-03-20T09:50:34","date_gmt":"2014-03-20T01:50:34","guid":{"rendered":"http:\/\/coolshell.cn\/?p=11265"},"modified":"2020-07-08T17:38:17","modified_gmt":"2020-07-08T09:38:17","slug":"python%e4%bf%ae%e9%a5%b0%e5%99%a8%e7%9a%84%e5%87%bd%e6%95%b0%e5%bc%8f%e7%bc%96%e7%a8%8b","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/11265.html","title":{"rendered":"Python\u4fee\u9970\u5668\u7684\u51fd\u6570\u5f0f\u7f16\u7a0b"},"content":{"rendered":"<p><img decoding=\"async\" loading=\"lazy\" class=\"alignright wp-image-11300\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg\" alt=\"\" width=\"280\" height=\"233\" srcset=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg 350w, https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960-300x249.jpg 300w, https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960-325x270.jpg 325w\" sizes=\"(max-width: 280px) 100vw, 280px\" \/>Python\u7684\u4fee\u9970\u5668\u7684\u82f1\u6587\u540d\u53ebDecorator\uff0c\u5f53\u4f60\u770b\u5230\u8fd9\u4e2a\u82f1\u6587\u540d\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u4f1a\u628a\u5176\u8ddfDesign Pattern\u91cc\u7684Decorator\u641e\u6df7\u4e86\uff0c\u5176\u5b9e\u8fd9\u662f\u5b8c\u5168\u4e0d\u540c\u7684\u4e24\u4e2a\u4e1c\u897f\u3002\u867d\u7136\u597d\u50cf\uff0c\u4ed6\u4eec\u8981\u5e72\u7684\u4e8b\u90fd\u5f88\u76f8\u4f3c\u2014\u2014\u90fd\u662f\u60f3\u8981\u5bf9\u4e00\u4e2a\u5df2\u6709\u7684\u6a21\u5757\u505a\u4e00\u4e9b\u201c\u4fee\u9970\u5de5\u4f5c\u201d\uff0c\u6240\u8c13\u4fee\u9970\u5de5\u4f5c\u5c31\u662f\u60f3\u7ed9\u73b0\u6709\u7684\u6a21\u5757\u52a0\u4e0a\u4e00\u4e9b\u5c0f\u88c5\u9970\uff08\u4e00\u4e9b\u5c0f\u529f\u80fd\uff0c\u8fd9\u4e9b\u5c0f\u529f\u80fd\u53ef\u80fd\u597d\u591a\u6a21\u5757\u90fd\u4f1a\u7528\u5230\uff09\uff0c\u4f46\u53c8\u4e0d\u8ba9\u8fd9\u4e2a\u5c0f\u88c5\u9970\uff08\u5c0f\u529f\u80fd\uff09\u4fb5\u5165\u5230\u539f\u6709\u7684\u6a21\u5757\u4e2d\u7684\u4ee3\u7801\u91cc\u53bb\u3002\u4f46\u662fOO\u7684Decorator\u7b80\u76f4\u5c31\u662f\u4e00\u573a\u6076\u68a6\uff0c\u4e0d\u4fe1\u4f60\u5c31\u53bb\u770b\u770bwikipedia\u4e0a\u7684\u8bcd\u6761\uff08<a href=\"http:\/\/en.wikipedia.org\/wiki\/Decorator_pattern\" target=\"_blank\" rel=\"noopener noreferrer\">Decorator Pattern<\/a>\uff09\u91cc\u7684UML\u56fe\u548c\u90a3\u4e9b\u4ee3\u7801\uff0c\u8fd9\u5c31\u662f\u6211\u5728\u300a\u00a0<a title=\"\u94fe\u63a5\uff1a\u4ece\u9762\u5411\u5bf9\u8c61\u7684\u8bbe\u8ba1\u6a21\u5f0f\u770b\u8f6f\u4ef6\u8bbe\u8ba1\" href=\"https:\/\/coolshell.cn\/articles\/8961.html\" rel=\"bookmark\">\u4ece\u9762\u5411\u5bf9\u8c61\u7684\u8bbe\u8ba1\u6a21\u5f0f\u770b\u8f6f\u4ef6\u8bbe\u8ba1<\/a>\u300b\u201c\u9910\u540e\u751c\u70b9\u201d\u4e00\u8282\u4e2d\u8bf4\u7684\uff0cOO\u9f13\u52b1\u4e86\u2014\u2014\u201c\u539a\u91cd\u5730\u80f6\u5408\u548c\u590d\u6742\u5c42\u6b21\u201d\uff0c\u4e5f\u662f\u300a\u00a0<a title=\"\u94fe\u63a5\uff1a\u5982\u6b64\u7406\u89e3\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\" href=\"https:\/\/coolshell.cn\/articles\/8745.html\" rel=\"bookmark\">\u5982\u6b64\u7406\u89e3\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b<\/a>\u300b\u4e2d\u6240\u8bf4\u7684\u201cOO\u7684\u72c2\u70ed\u8005\u4eec\u975e\u5e38\u5bb3\u6015\u5904\u7406\u6570\u636e\u201d\uff0cDecorator Pattern\u641e\u51fa\u6765\u7684\u4ee3\u7801\u7b80\u76f4\u5c31\u662fOO\u7684\u53cd\u9762\u6559\u7a0b\u3002<\/p>\n<p>Python \u7684 Decorator\u5728\u4f7f\u7528\u4e0a\u548cJava\/C#\u7684Annotation\u5f88\u76f8\u4f3c\uff0c\u5c31\u662f\u5728\u65b9\u6cd5\u540d\u524d\u9762\u52a0\u4e00\u4e2a@XXX\u6ce8\u89e3\u6765\u4e3a\u8fd9\u4e2a\u65b9\u6cd5\u88c5\u9970\u4e00\u4e9b\u4e1c\u897f\u3002\u4f46\u662f\uff0cJava\/C#\u7684Annotation\u4e5f\u5f88\u8ba9\u4eba\u671b\u800c\u5374\u6b65\uff0c\u592aTMD\u7684\u590d\u6742\u4e86\uff0c\u4f60\u8981\u73a9\u5b83\uff0c\u4f60\u9700\u8981\u4e86\u89e3\u4e00\u5806Annotation\u7684\u7c7b\u5e93\u6587\u6863\uff0c\u8ba9\u4eba\u611f\u89c9\u5c31\u662f\u5728\u5b66\u53e6\u5916\u4e00\u95e8\u8bed\u8a00\u3002<\/p>\n<p>\u800cPython\u4f7f\u7528\u4e86\u4e00\u79cd\u76f8\u5bf9\u4e8eDecorator Pattern\u548cAnnotation\u6765\u8bf4\u975e\u5e38\u4f18\u96c5\u7684\u65b9\u6cd5\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u9700\u8981\u4f60\u53bb\u638c\u63e1\u4ec0\u4e48\u590d\u6742\u7684OO\u6a21\u578b\u6216\u662fAnnotation\u7684\u5404\u79cd\u7c7b\u5e93\u89c4\u5b9a\uff0c\u5b8c\u5168\u5c31\u662f\u8bed\u8a00\u5c42\u9762\u7684\u73a9\u6cd5\uff1a\u4e00\u79cd\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u6280\u5de7\u3002\u5982\u679c\u4f60\u770b\u8fc7\u672c\u7ad9\u7684\u300a<a href=\"https:\/\/coolshell.cn\/articles\/10822.html\">\u51fd\u6570\u5f0f\u7f16\u7a0b<\/a>\u300b\uff0c\u4f60\u4e00\u5b9a\u4f1a\u4e3a\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u90a3\u79cd\u201c\u63cf\u8ff0\u4f60\u60f3\u5e72\u4ec0\u4e48\uff0c\u800c\u4e0d\u662f\u63cf\u8ff0\u4f60\u8981\u600e\u4e48\u53bb\u5b9e\u73b0\u201d\u7684\u7f16\u7a0b\u65b9\u5f0f\u611f\u5230\u7545\u5feb\u3002\uff08\u5982\u679c\u4f60\u4e0d\u4e86\u89e3\u51fd\u6570\u5f0f\u7f16\u7a0b\uff0c\u90a3\u5728\u8bfb\u672c\u6587\u4e4b\u524d\uff0c\u8fd8\u8bf7\u4f60\u79fb\u6b65\u53bb\u770b\u770b\u300a<a href=\"https:\/\/coolshell.cn\/articles\/10822.html\">\u51fd\u6570\u5f0f\u7f16\u7a0b<\/a>\u300b\uff09 \u597d\u4e86\uff0c\u6211\u4eec\u5148\u6765\u70b9\u611f\u6027\u8ba4\u8bc6\uff0c\u770b\u4e00\u4e2aPython\u4fee\u9970\u5668\u7684Hello World\u7684\u4ee3\u7801\u3002<\/p>\n<p><!--more--><\/p>\n<div id=\"ez-toc-container\" class=\"ez-toc-v2_0_48 counter-hierarchy ez-toc-counter ez-toc-grey ez-toc-container-direction\">\n<div class=\"ez-toc-title-container\">\n<p class=\"ez-toc-title\">\u76ee\u5f55<\/p>\n<span class=\"ez-toc-title-toggle\"><\/span><\/div>\n<nav><ul class='ez-toc-list ez-toc-list-level-1 ' ><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-1\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#Hello_World\" title=\"Hello World\">Hello World<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-2\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#Decorator_%E7%9A%84%E6%9C%AC%E8%B4%A8\" title=\"Decorator \u7684\u672c\u8d28\">Decorator \u7684\u672c\u8d28<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-3\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#%E5%B8%A6%E5%8F%82%E6%95%B0%E5%8F%8A%E5%A4%9A%E4%B8%AADecrorator\" title=\"\u5e26\u53c2\u6570\u53ca\u591a\u4e2aDecrorator\">\u5e26\u53c2\u6570\u53ca\u591a\u4e2aDecrorator<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-4\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#class%E5%BC%8F%E7%9A%84_Decorator\" title=\"class\u5f0f\u7684 Decorator\">class\u5f0f\u7684 Decorator<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-5\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#%E7%94%A8Decorator%E8%AE%BE%E7%BD%AE%E5%87%BD%E6%95%B0%E7%9A%84%E8%B0%83%E7%94%A8%E5%8F%82%E6%95%B0\" title=\"\u7528Decorator\u8bbe\u7f6e\u51fd\u6570\u7684\u8c03\u7528\u53c2\u6570\">\u7528Decorator\u8bbe\u7f6e\u51fd\u6570\u7684\u8c03\u7528\u53c2\u6570<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-6\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#Decorator%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8\" title=\"Decorator\u7684\u526f\u4f5c\u7528\">Decorator\u7684\u526f\u4f5c\u7528<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-7\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#%E4%B8%80%E4%BA%9Bdecorator%E7%9A%84%E7%A4%BA%E4%BE%8B\" title=\"\u4e00\u4e9bdecorator\u7684\u793a\u4f8b\">\u4e00\u4e9bdecorator\u7684\u793a\u4f8b<\/a><ul class='ez-toc-list-level-5'><li class='ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-8\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#%E7%BB%99%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%81%9A%E7%BC%93%E5%AD%98\" title=\"\u7ed9\u51fd\u6570\u8c03\u7528\u505a\u7f13\u5b58\">\u7ed9\u51fd\u6570\u8c03\u7528\u505a\u7f13\u5b58<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-9\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#Profiler%E7%9A%84%E4%BE%8B%E5%AD%90\" title=\"Profiler\u7684\u4f8b\u5b50\">Profiler\u7684\u4f8b\u5b50<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-10\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#%E6%B3%A8%E5%86%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0\" title=\"\u6ce8\u518c\u56de\u8c03\u51fd\u6570\">\u6ce8\u518c\u56de\u8c03\u51fd\u6570<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-11\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#%E7%BB%99%E5%87%BD%E6%95%B0%E6%89%93%E6%97%A5%E5%BF%97\" title=\"\u7ed9\u51fd\u6570\u6253\u65e5\u5fd7\">\u7ed9\u51fd\u6570\u6253\u65e5\u5fd7<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-12\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#%E4%B8%80%E4%B8%AAMySQL%E7%9A%84Decorator\" title=\"\u4e00\u4e2aMySQL\u7684Decorator\">\u4e00\u4e2aMySQL\u7684Decorator<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-13\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#%E7%BA%BF%E7%A8%8B%E5%BC%82%E6%AD%A5\" title=\"\u7ebf\u7a0b\u5f02\u6b65\">\u7ebf\u7a0b\u5f02\u6b65<\/a><\/li><\/ul><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-14\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\/#%E5%85%B6%E5%AE%83\" title=\"\u5176\u5b83\">\u5176\u5b83<\/a><\/li><\/ul><\/nav><\/div>\n<h4><span class=\"ez-toc-section\" id=\"Hello_World\"><\/span>Hello World<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u4e0b\u9762\u662f\u4ee3\u7801\uff08\u6587\u4ef6\u540d\uff1ahello.py\uff09\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\" data-enlighter-highlight=\"1-6,8\">def hello(fn):\n    def wrapper():\n        print \"hello, %s\" % fn.__name__\n        fn()\n        print \"goodby, %s\" % fn.__name__\n    return wrapper\n\n@hello\ndef foo():\n    print \"i am foo\"\n\nfoo()\n<\/pre>\n<p>\u5f53\u4f60\u8fd0\u884c\u4ee3\u7801\uff0c\u4f60\u4f1a\u770b\u5230\u5982\u4e0b\u8f93\u51fa\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"shell\">[chenaho@chenhao-air]$ python hello.py\nhello, foo\ni am foo\ngoodby, foo<\/pre>\n<p>\u4f60\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7684\u4e1c\u897f\uff1a<\/p>\n<p style=\"padding-left: 30px;\">1\uff09\u51fd\u6570foo\u524d\u9762\u6709\u4e2a@hello\u7684\u201c\u6ce8\u89e3\u201d\uff0chello\u5c31\u662f\u6211\u4eec\u524d\u9762\u5b9a\u4e49\u7684\u51fd\u6570hello<\/p>\n<p style=\"padding-left: 30px;\">2\uff09\u5728hello\u51fd\u6570\u4e2d\uff0c\u5176\u9700\u8981\u4e00\u4e2afn\u7684\u53c2\u6570\uff08\u8fd9\u5c31\u7528\u6765\u505a\u56de\u8c03\u7684\u51fd\u6570\uff09<\/p>\n<p style=\"padding-left: 30px;\">3\uff09hello\u51fd\u6570\u4e2d\u8fd4\u56de\u4e86\u4e00\u4e2ainner\u51fd\u6570wrapper\uff0c\u8fd9\u4e2awrapper\u51fd\u6570\u56de\u8c03\u4e86\u4f20\u8fdb\u6765\u7684fn\uff0c\u5e76\u5728\u56de\u8c03\u524d\u540e\u52a0\u4e86\u4e24\u6761\u8bed\u53e5\u3002<\/p>\n<h4><span class=\"ez-toc-section\" id=\"Decorator_%E7%9A%84%E6%9C%AC%E8%B4%A8\"><\/span>Decorator \u7684\u672c\u8d28<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u5bf9\u4e8ePython\u7684\u8fd9\u4e2a@\u6ce8\u89e3\u8bed\u6cd5\u7cd6- Syntactic Sugar \u6765\u8bf4\uff0c\u5f53\u4f60\u5728\u7528\u67d0\u4e2a@decorator\u6765\u4fee\u9970\u67d0\u4e2a\u51fd\u6570func\u65f6\uff0c\u5982\u4e0b\u6240\u793a:<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">@decorator\ndef func():\n    pass\n<\/pre>\n<p>\u5176\u89e3\u91ca\u5668\u4f1a\u89e3\u91ca\u6210\u4e0b\u9762\u8fd9\u6837\u7684\u8bed\u53e5\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">func = decorator(func)<\/pre>\n<p>\u5c3c\u739b\uff0c\u8fd9\u4e0d\u5c31\u662f\u628a\u4e00\u4e2a\u51fd\u6570\u5f53\u53c2\u6570\u4f20\u5230\u53e6\u4e00\u4e2a\u51fd\u6570\u4e2d\uff0c\u7136\u540e\u518d\u56de\u8c03\u5417\uff1f\u662f\u7684\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u610f\uff0c\u90a3\u91cc\u8fd8\u6709\u4e00\u4e2a\u8d4b\u503c\u8bed\u53e5\uff0c\u628adecorator\u8fd9\u4e2a\u51fd\u6570\u7684\u8fd4\u56de\u503c\u8d4b\u503c\u56de\u4e86\u539f\u6765\u7684func\u3002 \u6839\u636e\u300a<a href=\"https:\/\/coolshell.cn\/articles\/10822.html\" target=\"_blank\" rel=\"noopener noreferrer\">\u51fd\u6570\u5f0f\u7f16\u7a0b<\/a>\u300b\u4e2d\u7684<strong>first class functions<\/strong>\u4e2d\u7684\u5b9a\u4e49\u7684\uff0c\u4f60\u53ef\u4ee5\u628a\u51fd\u6570\u5f53\u6210\u53d8\u91cf\u6765\u4f7f\u7528\uff0c\u6240\u4ee5\uff0cdecorator\u5fc5\u9700\u5f97\u8fd4\u56de\u4e86\u4e00\u4e2a\u51fd\u6570\u51fa\u6765\u7ed9func\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684<strong>higher order function <\/strong>\u9ad8\u9636\u51fd\u6570\uff0c\u4e0d\u7136\uff0c\u540e\u9762\u5f53func()\u8c03\u7528\u7684\u65f6\u5019\u5c31\u4f1a\u51fa\u9519\u3002 \u5c31\u6211\u4eec\u4e0a\u9762\u90a3\u4e2ahello.py\u91cc\u7684\u4f8b\u5b50\u6765\u8bf4\uff0c<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">@hello\ndef foo():\n    print \"i am foo\"\n<\/pre>\n<p>\u88ab\u89e3\u91ca\u6210\u4e86\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\"> foo = hello(foo)<\/pre>\n<p><strong>\u662f\u7684\uff0c\u8fd9\u662f\u4e00\u6761\u8bed\u53e5\uff0c\u800c\u4e14\u8fd8\u88ab\u6267\u884c\u4e86\u3002<\/strong>\u4f60\u5982\u679c\u4e0d\u4fe1\u7684\u8bdd\uff0c\u4f60\u53ef\u4ee5\u5199\u8fd9\u6837\u7684\u7a0b\u5e8f\u6765\u8bd5\u8bd5\u770b\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">def fuck(fn):\n    print \"fuck %s!\" % fn.__name__[::-1].upper()\n\n@fuck\ndef wfg():\n    pass\n<\/pre>\n<p>\u6ca1\u4e86\uff0c\u5c31\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\uff0c\u6ca1\u6709\u8c03\u7528wfg()\u7684\u8bed\u53e5\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c fuck\u51fd\u6570\u88ab\u8c03\u7528\u4e86\uff0c\u800c\u4e14\u8fd8\u5f88NB\u5730\u8f93\u51fa\u4e86\u6211\u4eec\u6bcf\u4e2a\u4eba\u7684\u5fc3\u58f0\uff01<\/p>\n<p>\u518d\u56de\u5230\u6211\u4eechello.py\u7684\u90a3\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c<strong>hello(foo)\u8fd4\u56de\u4e86wrapper()\u51fd\u6570\uff0c\u6240\u4ee5\uff0cfoo\u5176\u5b9e\u53d8\u6210\u4e86wrapper\u7684\u4e00\u4e2a\u53d8\u91cf\uff0c\u800c\u540e\u9762\u7684foo()\u6267\u884c\u5176\u5b9e\u53d8\u6210\u4e86wrapper()<\/strong>\u3002<\/p>\n<p>\u77e5\u9053\u8fd9\u70b9\u672c\u8d28\uff0c\u5f53\u4f60\u770b\u5230\u6709\u591a\u4e2adecorator\u6216\u662f\u5e26\u53c2\u6570\u7684decorator\uff0c\u4f60\u4e5f\u5c31\u4e0d\u4f1a\u5bb3\u6015\u4e86\u3002<\/p>\n<p>\u6bd4\u5982\uff1a\u591a\u4e2adecorator<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">@decorator_one\n@decorator_two\ndef func():\n    pass<\/pre>\n<p>\u76f8\u5f53\u4e8e\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">func = decorator_one(decorator_two(func))<\/pre>\n<p>\u6bd4\u5982\uff1a\u5e26\u53c2\u6570\u7684decorator\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">@decorator(arg1, arg2)\ndef func():\n    pass<\/pre>\n<p>\u76f8\u5f53\u4e8e\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">func = decorator(arg1,arg2)(func)<\/pre>\n<p>\u8fd9\u610f\u5473\u7740decorator(arg1, arg2)\u8fd9\u4e2a\u51fd\u6570\u9700\u8981\u8fd4\u56de\u4e00\u4e2a\u201c\u771f\u6b63\u7684decorator\u201d\u3002<\/p>\n<h4><span class=\"ez-toc-section\" id=\"%E5%B8%A6%E5%8F%82%E6%95%B0%E5%8F%8A%E5%A4%9A%E4%B8%AADecrorator\"><\/span>\u5e26\u53c2\u6570\u53ca\u591a\u4e2aDecrorator<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u6709\u70b9\u610f\u4e49\u7684\u4f8b\u5b50\uff08\u6587\u4ef6\u540d\uff1ahtml.py\uff09\uff1a<\/p>\n<p>\u5728\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff1amakeHtmlTag\u6709\u4e24\u4e2a\u53c2\u6570\u3002\u6240\u4ee5\uff0c<strong>\u4e3a\u4e86\u8ba9 <span style=\"color: #000080;\">hello = makeHtmlTag(arg1, arg2)(hello)<\/span> \u6210\u529f\uff0cmakeHtmlTag \u5fc5\u9700\u8fd4\u56de\u4e00\u4e2adecorator<\/strong>\uff08\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6211\u4eec\u5728makeHtmlTag\u4e2d\u52a0\u5165\u4e86real_decorator()\u7684\u539f\u56e0\uff09<strong>\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u5165\u5230 decorator \u7684\u903b\u8f91\u4e2d\u53bb\u4e86<\/strong>\u2014\u2014 decorator\u5f97\u8fd4\u56de\u4e00\u4e2awrapper\uff0cwrapper\u91cc\u56de\u8c03hello\u3002<strong>\u770b\u4f3c\u90a3\u4e2amakeHtmlTag() \u5199\u5f97\u5c42\u5c42\u53e0\u53e0\uff0c\u4f46\u662f\uff0c\u5df2\u7ecf\u4e86\u89e3\u4e86\u672c\u8d28\u7684\u6211\u4eec\u89c9\u5f97\u5199\u5f97\u5f88\u81ea\u7136<\/strong>\u3002 \u4f60\u770b\uff0cPython\u7684Decorator\u5c31\u662f\u8fd9\u4e48\u7b80\u5355\uff0c\u6ca1\u6709\u4ec0\u4e48\u590d\u6742\u7684\u4e1c\u897f\uff0c\u4f60\u4e5f\u4e0d\u9700\u8981\u4e86\u89e3\u8fc7\u591a\u7684\u4e1c\u897f\uff0c\u4f7f\u7528\u8d77\u6765\u5c31\u662f\u90a3\u4e48\u81ea\u7136\u3001\u4f53\u8d34\u3001\u5e72\u723d\u3001\u900f\u6c14\uff0c\u72ec\u6709\u7684\u901f\u6548\u51f9\u9053\u548c\u5b8c\u7f8e\u7684\u5438\u6536\u8f68\u8ff9\uff0c\u8ba9\u4f60\u518d\u4e5f\u4e0d\u7528\u4e3a\u6bcf\u4e2a\u6708\u7684\u90a3\u51e0\u5929\u611f\u5230\u7126\u8651\u548c\u4e0d\u5b89\uff0c\u518d\u52a0\u4e0a\u8d34\u5fc3\u7684\u62a4\u7ffc\u8bbe\u8ba1\uff0c\u91cf\u591a\u4e5f\u4e0d\u7528\u5f53\u5fc3\u3002\u5bf9\u4e0d\u8d77\uff0c\u6211\u8c03\u76ae\u4e86\u3002 \u4ec0\u4e48\uff0c\u4f60\u89c9\u5f97\u4e0a\u9762\u90a3\u4e2a\u5e26\u53c2\u6570\u7684Decorator\u7684\u51fd\u6570\u5d4c\u5957\u592a\u591a\u4e86\uff0c\u4f60\u53d7\u4e0d\u4e86\u3002\u597d\u5427\uff0c\u6ca1\u4e8b\uff0c\u6211\u4eec\u770b\u770b\u4e0b\u9762\u7684\u65b9\u6cd5\u3002<\/p>\n<h4><span class=\"ez-toc-section\" id=\"class%E5%BC%8F%E7%9A%84_Decorator\"><\/span>class\u5f0f\u7684 Decorator<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u9996\u5148\uff0c\u5148\u5f97\u8bf4\u4e00\u4e0b\uff0cdecorator\u7684class\u65b9\u5f0f\uff0c\u8fd8\u662f\u770b\u4e2a\u793a\u4f8b\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-highlight=\"3,7\">class myDecorator(object):\n\n    def __init__(self, fn):\n        print \"inside myDecorator.__init__()\"\n        self.fn = fn\n\n    def __call__(self):\n        self.fn()\n        print \"inside myDecorator.__call__()\"\n\n@myDecorator\ndef aFunction():\n    print \"inside aFunction()\"\n\nprint \"Finished decorating aFunction()\"\n\naFunction()\n\n# \u8f93\u51fa\uff1a\n# inside myDecorator.__init__()\n# Finished decorating aFunction()\n# inside aFunction()\n# inside myDecorator.__call__()<\/pre>\n<p>\u4e0a\u9762\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u4e86\uff0c\u7528\u7c7b\u7684\u65b9\u5f0f\u58f0\u660e\u4e00\u4e2adecorator\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u7c7b\u4e2d\u6709\u4e24\u4e2a\u6210\u5458\uff1a<br \/>\n1\uff09\u4e00\u4e2a\u662f<strong>init<\/strong>()\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u5728\u6211\u4eec\u7ed9\u67d0\u4e2a\u51fd\u6570decorator\u65f6\u88ab\u8c03\u7528\uff0c\u6240\u4ee5\uff0c\u9700\u8981\u6709\u4e00\u4e2afn\u7684\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u88abdecorator\u7684\u51fd\u6570\u3002<br \/>\n2\uff09\u4e00\u4e2a\u662f<strong>call<\/strong>()\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u5728\u6211\u4eec\u8c03\u7528\u88abdecorator\u51fd\u6570\u65f6\u88ab\u8c03\u7528\u7684\u3002<br \/>\n\u4e0a\u9762\u8f93\u51fa\u53ef\u4ee5\u770b\u5230\u6574\u4e2a\u7a0b\u5e8f\u7684\u6267\u884c\u987a\u5e8f\u3002<\/p>\n<p>\u8fd9\u770b\u4e0a\u53bb\u8981\u6bd4\u201c\u51fd\u6570\u5f0f\u201d\u7684\u65b9\u5f0f\u66f4\u6613\u8bfb\u4e00\u4e9b\u3002<\/p>\n<p>\u4e0b\u9762\uff0c\u6211\u4eec\u6765\u770b\u770b\u7528\u7c7b\u7684\u65b9\u5f0f\u6765\u91cd\u5199\u4e0a\u9762\u7684html.py\u7684\u4ee3\u7801\uff08\u6587\u4ef6\u540d\uff1ahtml.py\uff09\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">class makeHtmlTagClass(object):\n\n    def __init__(self, tag, css_class=\"\"):\n        self._tag = tag\n        self._css_class = \" class='{0}'\".format(css_class) \\\n                                       if css_class !=\"\" else \"\"\n\n    def __call__(self, fn):\n        def wrapped(*args, **kwargs):\n            return \"&lt;\" + self._tag + self._css_class+\"&gt;\"  \\\n                       + fn(*args, **kwargs) + \"&lt;\/\" + self._tag + \"&gt;\"\n        return wrapped\n\n@makeHtmlTagClass(tag=\"b\", css_class=\"bold_css\")\n@makeHtmlTagClass(tag=\"i\", css_class=\"italic_css\")\ndef hello(name):\n    return \"Hello, {}\".format(name)\n\nprint hello(\"Hao Chen\")\n<\/pre>\n<p>\u4e0a\u9762\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u610f\u8fd9\u51e0\u70b9\uff1a<br \/>\n1\uff09\u5982\u679cdecorator\u6709\u53c2\u6570\u7684\u8bdd\uff0c<strong>init<\/strong>() \u6210\u5458\u5c31\u4e0d\u80fd\u4f20\u5165fn\u4e86\uff0c\u800cfn\u662f\u5728<strong>call<\/strong>\u7684\u65f6\u5019\u4f20\u5165\u7684\u3002<br \/>\n2\uff09\u8fd9\u6bb5\u4ee3\u7801\u8fd8\u5c55\u793a\u4e86 wrapped(*args, **kwargs) \u8fd9\u79cd\u65b9\u5f0f\u6765\u4f20\u9012\u88abdecorator\u51fd\u6570\u7684\u53c2\u6570\u3002\uff08\u5176\u4e2d\uff1aargs\u662f\u4e00\u4e2a\u53c2\u6570\u5217\u8868\uff0ckwargs\u662f\u53c2\u6570dict\uff0c\u5177\u4f53\u7684\u7ec6\u8282\uff0c\u8bf7\u53c2\u8003Python\u7684\u6587\u6863\u6216\u662f<a href=\"http:\/\/stackoverflow.com\/questions\/3394835\/args-and-kwargs\" target=\"_blank\" rel=\"noopener noreferrer\">StackOverflow\u7684\u8fd9\u4e2a\u95ee\u9898<\/a>\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5c55\u5f00\u4e86\uff09<\/p>\n<h4><span class=\"ez-toc-section\" id=\"%E7%94%A8Decorator%E8%AE%BE%E7%BD%AE%E5%87%BD%E6%95%B0%E7%9A%84%E8%B0%83%E7%94%A8%E5%8F%82%E6%95%B0\"><\/span>\u7528Decorator\u8bbe\u7f6e\u51fd\u6570\u7684\u8c03\u7528\u53c2\u6570<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u4f60\u6709\u4e09\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5e72\u8fd9\u4e2a\u4e8b\uff1a<\/p>\n<p>\u7b2c\u4e00\u79cd\uff0c\u901a\u8fc7 **kwargs\uff0c\u8fd9\u79cd\u65b9\u6cd5decorator\u4f1a\u5728kwargs\u4e2d\u6ce8\u5165\u53c2\u6570\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">def decorate_A(function):\n    def wrap_function(*args, **kwargs):\n        kwargs['str'] = 'Hello!'\n        return function(*args, **kwargs)\n    return wrap_function\n\n@decorate_A\ndef print_message_A(*args, **kwargs):\n    print(kwargs['str'])\n\nprint_message_A()<\/pre>\n<p>\u7b2c\u4e8c\u79cd\uff0c\u7ea6\u5b9a\u597d\u53c2\u6570\uff0c\u76f4\u63a5\u4fee\u6539\u53c2\u6570<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">def decorate_B(function):\n    def wrap_function(*args, **kwargs):\n        str = 'Hello!'\n        return function(str, *args, **kwargs)\n    return wrap_function\n\n@decorate_B\ndef print_message_B(str, *args, **kwargs):\n    print(str)\n\nprint_message_B()<\/pre>\n<p>\u7b2c\u4e09\u79cd\uff0c\u901a\u8fc7 *args \u6ce8\u5165<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">def decorate_C(function):\n    def wrap_function(*args, **kwargs):\n        str = 'Hello!'\n        #args.insert(1, str)\n        args = args +(str,)\n        return function(*args, **kwargs)\n    return wrap_function\n\nclass Printer:\n    @decorate_C\n    def print_message(self, str, *args, **kwargs):\n        print(str)\n\np = Printer()\np.print_message()<\/pre>\n<h4><span class=\"ez-toc-section\" id=\"Decorator%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8\"><\/span>Decorator\u7684\u526f\u4f5c\u7528<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u5230\u8fd9\u91cc\uff0c\u6211\u76f8\u4fe1\u4f60\u5e94\u8be5\u4e86\u89e3\u4e86\u6574\u4e2aPython\u7684decorator\u7684\u539f\u7406\u4e86\u3002<\/p>\n<p>\u76f8\u4fe1\u4f60\u4e5f\u4f1a\u53d1\u73b0\uff0c\u88abdecorator\u7684\u51fd\u6570\u5176\u5b9e\u5df2\u7ecf\u662f\u53e6\u5916\u4e00\u4e2a\u51fd\u6570\u4e86\uff0c\u5bf9\u4e8e\u6700\u524d\u9762\u90a3\u4e2ahello.py\u7684\u4f8b\u5b50\u6765\u8bf4\uff0c\u5982\u679c\u4f60\u67e5\u8be2\u4e00\u4e0bfoo.<strong>name<\/strong>\u7684\u8bdd\uff0c\u4f60\u4f1a\u53d1\u73b0\u5176\u8f93\u51fa\u7684\u662f\u201cwrapper\u201d\uff0c\u800c\u4e0d\u662f\u6211\u4eec\u671f\u671b\u7684\u201cfoo\u201d\uff0c\u8fd9\u4f1a\u7ed9\u6211\u4eec\u7684\u7a0b\u5e8f\u57cb\u4e00\u4e9b\u5751\u3002\u6240\u4ee5\uff0cPython\u7684functool\u5305\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ebwrap\u7684decorator\u6765\u6d88\u9664\u8fd9\u6837\u7684\u526f\u4f5c\u7528\u3002\u4e0b\u9762\u662f\u6211\u4eec\u65b0\u7248\u672c\u7684 hello.py\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\" data-enlighter-highlight=\"1,3\">from functools import wraps\ndef hello(fn):\n    @wraps(fn)\n    def wrapper():\n        print \"hello, %s\" % fn.__name__\n        fn()\n        print \"goodby, %s\" % fn.__name__\n    return wrapper\n\n@hello\ndef foo():\n    '''foo help doc'''\n    print \"i am foo\"\n    pass\n\nfoo()\nprint foo.__name__ #\u8f93\u51fa foo\nprint foo.__doc__  #\u8f93\u51fa foo help doc\n<\/pre>\n<p>\u5f53\u7136\uff0c\u5373\u4f7f\u662f\u4f60\u7528\u4e86functools\u7684wraps\uff0c\u4e5f\u4e0d\u80fd\u5b8c\u5168\u6d88\u9664\u8fd9\u6837\u7684\u526f\u4f5c\u7528\u3002<\/p>\n<p>\u6765\u770b\u4e0b\u9762\u8fd9\u4e2a\u793a\u4f8b\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">from inspect import getmembers, getargspec\nfrom functools import wraps\n\ndef wraps_decorator(f):\n    @wraps(f)\n    def wraps_wrapper(*args, **kwargs):\n        return f(*args, **kwargs)\n    return wraps_wrapper\n\nclass SomeClass(object):\n    @wraps_decorator\n    def method(self, x, y):\n        pass\n\nobj = SomeClass()\nfor name, func in getmembers(obj, predicate=inspect.ismethod):\n    print \"Member Name: %s\" % name\n    print \"Func Name: %s\" % func.func_name\n    print \"Args: %s\" % getargspec(func)[0]\n\n# \u8f93\u51fa\uff1a\n# Member Name: method\n# Func Name: method\n# Args: []<\/pre>\n<p>\u4f60\u4f1a\u53d1\u73b0\uff0c\u5373\u4f7f\u662f\u4f60\u4f60\u7528\u4e86functools\u7684wraps\uff0c\u4f60\u5728\u7528getargspec\u65f6\uff0c\u53c2\u6570\u4e5f\u4e0d\u89c1\u4e86\u3002<\/p>\n<p>\u8981\u4fee\u6b63\u8fd9\u4e00\u95ee\uff0c\u6211\u4eec\u8fd8\u5f97\u7528Python\u7684\u53cd\u5c04\u6765\u89e3\u51b3\uff0c\u4e0b\u9762\u662f\u76f8\u5173\u7684\u4ee3\u7801\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">def get_true_argspec(method):\n    argspec = inspect.getargspec(method)\n    args = argspec[0]\n    if args and args[0] == 'self':\n        return argspec\n    if hasattr(method, '__func__'):\n        method = method.__func__\n    if not hasattr(method, 'func_closure') or method.func_closure is None:\n        raise Exception(\"No closure for method.\")\n\n    method = method.func_closure[0].cell_contents\n    return get_true_argspec(method)<\/pre>\n<p>\u5f53\u7136\uff0c\u6211\u76f8\u4fe1\u5927\u591a\u6570\u4eba\u7684\u7a0b\u5e8f\u90fd\u4e0d\u4f1a\u53bbgetargspec\u3002\u6240\u4ee5\uff0c\u7528functools\u7684wraps\u5e94\u8be5\u591f\u7528\u4e86\u3002<\/p>\n<h4><span class=\"ez-toc-section\" id=\"%E4%B8%80%E4%BA%9Bdecorator%E7%9A%84%E7%A4%BA%E4%BE%8B\"><\/span>\u4e00\u4e9bdecorator\u7684\u793a\u4f8b<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u597d\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5404\u79cddecorator\u7684\u4f8b\u5b50\uff1a<\/p>\n<h5><span class=\"ez-toc-section\" id=\"%E7%BB%99%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%81%9A%E7%BC%93%E5%AD%98\"><\/span>\u7ed9\u51fd\u6570\u8c03\u7528\u505a\u7f13\u5b58<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u8fd9\u4e2a\u4f8b\u5b9e\u5728\u662f\u592a\u7ecf\u5178\u4e86\uff0c\u6574\u4e2a\u7f51\u4e0a\u90fd\u7528\u8fd9\u4e2a\u4f8b\u5b50\u505adecorator\u7684\u7ecf\u5178\u8303\u4f8b\uff0c\u56e0\u4e3a\u592a\u7ecf\u5178\u4e86\uff0c\u6240\u4ee5\uff0c\u6211\u8fd9\u7bc7\u6587\u7ae0\u4e5f\u4e0d\u80fd\u514d\u4fd7\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">from functools import wraps\ndef memo(fn):\n    cache = {}\n    miss = object()\n\n    @wraps(fn)\n    def wrapper(*args):\n        result = cache.get(args, miss)\n        if result is miss:\n            result = fn(*args)\n            cache[args] = result\n        return result\n\n    return wrapper\n\n@memo\ndef fib(n):\n    if n &lt; 2:\n        return n\n    return fib(n - 1) + fib(n - 2)\n<\/pre>\n<p>\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u662f\u4e00\u4e2a\u6590\u6ce2\u62c9\u5951\u6570\u4f8b\u7684\u9012\u5f52\u7b97\u6cd5\u3002\u6211\u4eec\u77e5\u9053\uff0c\u8fd9\u4e2a\u9012\u5f52\u662f\u76f8\u5f53\u6ca1\u6709\u6548\u7387\u7684\uff0c\u56e0\u4e3a\u4f1a\u91cd\u590d\u8c03\u7528\u3002\u6bd4\u5982\uff1a\u6211\u4eec\u8981\u8ba1\u7b97fib(5)\uff0c\u4e8e\u662f\u5176\u5206\u89e3\u6210fib(4) + fib(3)\uff0c\u800cfib(4)\u5206\u89e3\u6210fib(3)+fib(2)\uff0cfib(3)\u53c8\u5206\u89e3\u6210fib(2)+fib(1)\u2026\u2026 \u4f60\u53ef\u770b\u5230\uff0c\u57fa\u672c\u4e0a\u6765\u8bf4\uff0cfib(3), fib(2), fib(1)\u5728\u6574\u4e2a\u9012\u5f52\u8fc7\u7a0b\u4e2d\u88ab\u8c03\u7528\u4e86\u4e24\u6b21\u3002<\/p>\n<p>\u800c\u6211\u4eec\u7528decorator\uff0c\u5728\u8c03\u7528\u51fd\u6570\u524d\u67e5\u8be2\u4e00\u4e0b\u7f13\u5b58\uff0c\u5982\u679c\u6ca1\u6709\u624d\u8c03\u7528\u4e86\uff0c\u6709\u4e86\u5c31\u4ece\u7f13\u5b58\u4e2d\u8fd4\u56de\u503c\u3002\u4e00\u4e0b\u5b50\uff0c\u8fd9\u4e2a\u9012\u5f52\u4ece\u4e8c\u53c9\u6811\u5f0f\u7684\u9012\u5f52\u6210\u4e86\u7ebf\u6027\u7684\u9012\u5f52\u3002<\/p>\n<h5><span class=\"ez-toc-section\" id=\"Profiler%E7%9A%84%E4%BE%8B%E5%AD%90\"><\/span>Profiler\u7684\u4f8b\u5b50<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u8fd9\u4e2a\u4f8b\u5b50\u6ca1\u4ec0\u4e48\u9ad8\u6df1\u7684\uff0c\u5c31\u662f\u5b9e\u7528\u4e00\u4e9b\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">import cProfile, pstats, StringIO\n\ndef profiler(func):\n    def wrapper(*args, **kwargs):\n        datafn = func.__name__ + \".profile\" # Name the data file\n        prof = cProfile.Profile()\n        retval = prof.runcall(func, *args, **kwargs)\n        #prof.dump_stats(datafn)\n        s = StringIO.StringIO()\n        sortby = 'cumulative'\n        ps = pstats.Stats(prof, stream=s).sort_stats(sortby)\n        ps.print_stats()\n        print s.getvalue()\n        return retval\n\n    return wrapper\n\n<\/pre>\n<h5><span class=\"ez-toc-section\" id=\"%E6%B3%A8%E5%86%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0\"><\/span>\u6ce8\u518c\u56de\u8c03\u51fd\u6570<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u4e0b\u9762\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u4e86\u901a\u8fc7URL\u7684\u8def\u7531\u6765\u8c03\u7528\u76f8\u5173\u6ce8\u518c\u7684\u51fd\u6570\u793a\u4f8b\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">class MyApp():\n    def __init__(self):\n        self.func_map = {}\n\n    def register(self, name):\n        def func_wrapper(func):\n            self.func_map[name] = func\n            return func\n        return func_wrapper\n\n    def call_method(self, name=None):\n        func = self.func_map.get(name, None)\n        if func is None:\n            raise Exception(\"No function registered against - \" + str(name))\n        return func()\n\napp = MyApp()\n\n@app.register('\/')\ndef main_page_func():\n    return \"This is the main page.\"\n\n@app.register('\/next_page')\ndef next_page_func():\n    return \"This is the next page.\"\n\nprint app.call_method('\/')\nprint app.call_method('\/next_page')\n<\/pre>\n<p>\u6ce8\u610f\uff1a<br \/>\n1\uff09\u4e0a\u9762\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u7528\u7c7b\u7684\u5b9e\u4f8b\u6765\u505adecorator\u3002<br \/>\n2\uff09decorator\u7c7b\u4e2d\u6ca1\u6709<strong>call<\/strong>()\uff0c\u4f46\u662fwrapper\u8fd4\u56de\u4e86\u539f\u51fd\u6570\u3002\u6240\u4ee5\uff0c\u539f\u51fd\u6570\u6ca1\u6709\u53d1\u751f\u4efb\u4f55\u53d8\u5316\u3002<\/p>\n<h5><span class=\"ez-toc-section\" id=\"%E7%BB%99%E5%87%BD%E6%95%B0%E6%89%93%E6%97%A5%E5%BF%97\"><\/span>\u7ed9\u51fd\u6570\u6253\u65e5\u5fd7<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u4e0b\u9762\u8fd9\u4e2a\u793a\u4f8b\u6f14\u793a\u4e86\u4e00\u4e2alogger\u7684decorator\uff0c\u8fd9\u4e2adecorator\u8f93\u51fa\u4e86\u51fd\u6570\u540d\uff0c\u53c2\u6570\uff0c\u8fd4\u56de\u503c\uff0c\u548c\u8fd0\u884c\u65f6\u95f4\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">from functools import wraps\ndef logger(fn):\n    @wraps(fn)\n    def wrapper(*args, **kwargs):\n        ts = time.time()\n        result = fn(*args, **kwargs)\n        te = time.time()\n        print \"function      = {0}\".format(fn.__name__)\n        print \"    arguments = {0} {1}\".format(args, kwargs)\n        print \"    return    = {0}\".format(result)\n        print \"    time      = %.6f sec\" % (te-ts)\n        return result\n    return wrapper\n\n@logger\ndef multipy(x, y):\n    return x * y\n\n@logger\ndef sum_num(n):\n    s = 0\n    for i in xrange(n+1):\n        s += i\n    return s\n\nprint multipy(2, 10)\nprint sum_num(100)\nprint sum_num(10000000)<\/pre>\n<p>\u4e0a\u9762\u90a3\u4e2a\u6253\u65e5\u5fd7\u8fd8\u662f\u6709\u70b9\u7c97\u7cd9\uff0c\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u66f4\u597d\u4e00\u70b9\u7684\uff08\u5e26log level\u53c2\u6570\u7684\uff09\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">import inspect\ndef get_line_number():\n    return inspect.currentframe().f_back.f_back.f_lineno\n\ndef logger(loglevel):\n    def log_decorator(fn):\n        @wraps(fn)\n        def wrapper(*args, **kwargs):\n            ts = time.time()\n            result = fn(*args, **kwargs)\n            te = time.time()\n            print \"function   = \" + fn.__name__,\n            print \"    arguments = {0} {1}\".format(args, kwargs)\n            print \"    return    = {0}\".format(result)\n            print \"    time      = %.6f sec\" % (te-ts)\n            if (loglevel == 'debug'):\n                print \"    called_from_line : \" + str(get_line_number())\n            return result\n        return wrapper\n    return log_decorator<\/pre>\n<p>\u4f46\u662f\uff0c\u4e0a\u9762\u8fd9\u4e2a\u5e26log level\u53c2\u6570\u7684\u6709\u4e24\u5177\u4e0d\u597d\u7684\u5730\u65b9\uff0c<br \/>\n1\uff09 loglevel\u4e0d\u662fdebug\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u8981\u8ba1\u7b97\u51fd\u6570\u8c03\u7528\u7684\u65f6\u95f4\u3002<br \/>\n2\uff09 \u4e0d\u540clevel\u7684\u8981\u5199\u5728\u4e00\u8d77\uff0c\u4e0d\u6613\u8bfb\u3002<\/p>\n<p>\u6211\u4eec\u518d\u63a5\u7740\u6539\u8fdb\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">import inspect\n\ndef advance_logger(loglevel):\n\n    def get_line_number():\n        return inspect.currentframe().f_back.f_back.f_lineno\n\n    def _basic_log(fn, result, *args, **kwargs):\n        print \"function   = \" + fn.__name__,\n        print \"    arguments = {0} {1}\".format(args, kwargs)\n        print \"    return    = {0}\".format(result)\n\n    def info_log_decorator(fn):\n        @wraps(fn)\n        def wrapper(*args, **kwargs):\n            result = fn(*args, **kwargs)\n            _basic_log(fn, result, args, kwargs)\n        return wrapper\n\n    def debug_log_decorator(fn):\n        @wraps(fn)\n        def wrapper(*args, **kwargs):\n            ts = time.time()\n            result = fn(*args, **kwargs)\n            te = time.time()\n            _basic_log(fn, result, args, kwargs)\n            print \"    time      = %.6f sec\" % (te-ts)\n            print \"    called_from_line : \" + str(get_line_number())\n        return wrapper\n\n    if loglevel is \"debug\":\n        return debug_log_decorator\n    else:\n        return info_log_decorator\n<\/pre>\n<p>\u4f60\u53ef\u4ee5\u770b\u5230\u4e24\u70b9\uff0c<br \/>\n1\uff09\u6211\u4eec\u5206\u4e86\u4e24\u4e2alog level\uff0c\u4e00\u4e2a\u662finfo\u7684\uff0c\u4e00\u4e2a\u662fdebug\u7684\uff0c\u7136\u540e\u6211\u4eec\u5728\u5916\u5c3e\u6839\u636e\u4e0d\u540c\u7684\u53c2\u6570\u8fd4\u56de\u4e0d\u540c\u7684decorator\u3002<br \/>\n2\uff09\u6211\u4eec\u628ainfo\u548cdebug\u4e2d\u7684\u76f8\u540c\u7684\u4ee3\u7801\u62bd\u5230\u4e86\u4e00\u4e2a\u53eb_basic_log\u7684\u51fd\u6570\u91cc\uff0cDRY\u539f\u5219\u3002<\/p>\n<h5><span class=\"ez-toc-section\" id=\"%E4%B8%80%E4%B8%AAMySQL%E7%9A%84Decorator\"><\/span>\u4e00\u4e2aMySQL\u7684Decorator<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u4e0b\u9762\u8fd9\u4e2adecorator\u662f\u6211\u5728\u5de5\u4f5c\u4e2d\u7528\u5230\u7684\u4ee3\u7801\uff0c\u6211\u7b80\u5316\u4e86\u4e00\u4e0b\uff0c\u628aDB\u8fde\u63a5\u6c60\u7684\u4ee3\u7801\u53bb\u6389\u4e86\uff0c\u8fd9\u6837\u80fd\u7b80\u5355\u70b9\uff0c\u65b9\u4fbf\u9605\u8bfb\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">import umysql\nfrom functools import wraps\n\nclass Configuraion:\n    def __init__(self, env):\n        if env == \"Prod\":\n            self.host    = \"coolshell.cn\"\n            self.port    = 3306\n            self.db      = \"coolshell\"\n            self.user    = \"coolshell\"\n            self.passwd  = \"fuckgfw\"\n        elif env == \"Test\":\n            self.host   = 'localhost'\n            self.port   = 3300\n            self.user   = 'coolshell'\n            self.db     = 'coolshell'\n            self.passwd = 'fuckgfw'\n\ndef mysql(sql):\n\n    _conf = Configuraion(env=\"Prod\")\n\n    def on_sql_error(err):\n        print err\n        sys.exit(-1)\n\n    def handle_sql_result(rs):\n        if rs.rows &gt; 0:\n            fieldnames = [f[0] for f in rs.fields]\n            return [dict(zip(fieldnames, r)) for r in rs.rows]\n        else:\n            return []\n\n    def decorator(fn):\n        @wraps(fn)\n        def wrapper(*args, **kwargs):\n            mysqlconn = umysql.Connection()\n            mysqlconn.settimeout(5)\n            mysqlconn.connect(_conf.host, _conf.port, _conf.user, \\\n                              _conf.passwd, _conf.db, True, 'utf8')\n            try:\n                rs = mysqlconn.query(sql, {})\n            except umysql.Error as e:\n                on_sql_error(e)\n\n            data = handle_sql_result(rs)\n            kwargs[\"data\"] = data\n            result = fn(*args, **kwargs)\n            mysqlconn.close()\n            return result\n        return wrapper\n\n    return decorator\n\n@mysql(sql = \"select * from coolshell\" )\ndef get_coolshell(data):\n    ... ...\n    ... ..\n<\/pre>\n<h5><span class=\"ez-toc-section\" id=\"%E7%BA%BF%E7%A8%8B%E5%BC%82%E6%AD%A5\"><\/span>\u7ebf\u7a0b\u5f02\u6b65<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u4e0b\u9762\u91cf\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u5f02\u6b65\u6267\u884c\u7684decorator\uff0c\u6ce8\u610f\uff0c\u5f02\u6b65\u5904\u7406\u5e76\u4e0d\u7b80\u5355\uff0c\u4e0b\u9762\u53ea\u662f\u4e00\u4e2a\u793a\u4f8b\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">from threading import Thread\nfrom functools import wraps\n\ndef async(func):\n    @wraps(func)\n    def async_func(*args, **kwargs):\n        func_hl = Thread(target = func, args = args, kwargs = kwargs)\n        func_hl.start()\n        return func_hl\n\n    return async_func\n\nif __name__ == '__main__':\n    from time import sleep\n\n    @async\n    def print_somedata():\n        print 'starting print_somedata'\n        sleep(2)\n        print 'print_somedata: 2 sec passed'\n        sleep(2)\n        print 'print_somedata: 2 sec passed'\n        sleep(2)\n        print 'finished print_somedata'\n\n    def main():\n        print_somedata()\n        print 'back in main'\n        print_somedata()\n        print 'back in main'\n\n    main()\n<\/pre>\n<h4><span class=\"ez-toc-section\" id=\"%E5%85%B6%E5%AE%83\"><\/span>\u5176\u5b83<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u5173\u4e8e\u66f4\u591a\u7684\u793a\u4f8b\uff0c\u4f60\u53ef\u4ee5\u53c2\u770b\uff1a <a href=\"https:\/\/wiki.python.org\/moin\/PythonDecoratorLibrary\" target=\"_blank\" rel=\"noopener noreferrer\">Python Decorator Library<\/a><\/p>\n<p>\u5173\u4e8ePython Decroator\u7684\u5404\u79cd\u63d0\u6848\uff0c\u53ef\u4ee5\u53c2\u770b\uff1a<a href=\"https:\/\/wiki.python.org\/moin\/PythonDecoratorProposals\" target=\"_blank\" rel=\"noopener noreferrer\">Python Decorator Proposals<\/a><\/p>\n<p>\uff08\u5168\u6587\u5b8c\uff09<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>Python\u7684\u4fee\u9970\u5668\u7684\u82f1\u6587\u540d\u53ebDecorator\uff0c\u5f53\u4f60\u770b\u5230\u8fd9\u4e2a\u82f1\u6587\u540d\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u4f1a\u628a\u5176\u8ddfDesign Pattern\u91cc\u7684Decorator\u641e\u6df7\u4e86\uff0c\u5176\u5b9e\u8fd9\u662f\u5b8c\u5168&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/11265.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[33,23,3],"tags":[722,696,499,791,697],"series":[],"aioseo_notices":[],"views":124812,"post_thumbnail_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg","content_first_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg","post_medium_image_300":"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg","post_thumbnail_image_624":"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg","post_frist_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg","post_medium_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg","post_large_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg","post_full_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg","post_all_images":[{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2014\/03\/snake-hat-new-year-schedule-800x960.jpg","id":"image0"}],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":84,"category_name":"Python","post_date":"2014-03-20","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[],"pageviews":124813,"pageviews_wl":114158,"ratings_average":4,"ratings_total":167,"ratings_users":39,"next_post_id":11377,"next_post_title":"C\u8bed\u8a00\u7ed3\u6784\u4f53\u91cc\u7684\u6210\u5458\u6570\u7ec4\u548c\u6307\u9488","previous_post_id":10975,"previous_post_title":"\u4e00\u4e2a\u201c\u8747\u91cf\u7ea7\u201d C \u8bed\u8a00\u534f\u7a0b\u5e93"}