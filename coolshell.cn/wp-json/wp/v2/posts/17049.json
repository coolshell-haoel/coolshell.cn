{"id":17049,"date":"2015-04-17T09:03:57","date_gmt":"2015-04-17T01:03:57","guid":{"rendered":"http:\/\/coolshell.cn\/?p=17049"},"modified":"2015-04-17T11:51:03","modified_gmt":"2015-04-17T03:51:03","slug":"docker%e5%9f%ba%e7%a1%80%e6%8a%80%e6%9c%af%ef%bc%9alinux-cgroup","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/17049.html","title":{"rendered":"Docker\u57fa\u7840\u6280\u672f\uff1aLinux CGroup"},"content":{"rendered":"<p><img decoding=\"async\" loading=\"lazy\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png\" alt=\"filter\" width=\"224\" height=\"225\" class=\"alignright size-full wp-image-17097\" srcset=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png 224w, https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter-150x150.png 150w, https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter-200x200.png 200w\" sizes=\"(max-width: 224px) 100vw, 224px\" \/>\u524d\u9762\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86<a title=\"Docker\u57fa\u7840\u6280\u672f\uff1aLinux Namespace\" href=\"https:\/\/coolshell.cn\/articles\/17010.html\" target=\"_blank\">Linux Namespace<\/a>\uff0c\u4f46\u662fNamespace\u89e3\u51b3\u7684\u95ee\u9898\u4e3b\u8981\u662f\u73af\u5883\u9694\u79bb\u7684\u95ee\u9898\uff0c\u8fd9\u53ea\u662f\u865a\u62df\u5316\u4e2d\u6700\u6700\u57fa\u7840\u7684\u4e00\u6b65\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u89e3\u51b3\u5bf9\u8ba1\u7b97\u673a\u8d44\u6e90\u4f7f\u7528\u4e0a\u7684\u9694\u79bb\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u867d\u7136\u4f60\u901a\u8fc7Namespace\u628a\u6211Jail\u5230\u4e00\u4e2a\u7279\u5b9a\u7684\u73af\u5883\u4e2d\u53bb\u4e86\uff0c\u4f46\u662f\u6211\u5728\u5176\u4e2d\u7684\u8fdb\u7a0b\u4f7f\u7528\u7528CPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u7b49\u8fd9\u4e9b\u8ba1\u7b97\u8d44\u6e90\u5176\u5b9e\u8fd8\u662f\u53ef\u4ee5\u968f\u5fc3\u6240\u6b32\u7684\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5e0c\u671b\u5bf9\u8fdb\u7a0b\u8fdb\u884c\u8d44\u6e90\u5229\u7528\u4e0a\u7684\u9650\u5236\u6216\u63a7\u5236\u3002\u8fd9\u5c31\u662fLinux CGroup\u51fa\u6765\u4e86\u7684\u539f\u56e0\u3002<\/p>\n<p>Linux CGroup\u5168\u79f0Linux Control Group\uff0c \u662fLinux\u5185\u6838\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u7528\u6765\u9650\u5236\uff0c\u63a7\u5236\u4e0e\u5206\u79bb\u4e00\u4e2a\u8fdb\u7a0b\u7ec4\u7fa4\u7684\u8d44\u6e90\uff08\u5982CPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u8f93\u5165\u8f93\u51fa\u7b49\uff09\u3002\u8fd9\u4e2a\u9879\u76ee\u6700\u65e9\u662f\u7531Google\u7684\u5de5\u7a0b\u5e08\u57282006\u5e74\u53d1\u8d77\uff08\u4e3b\u8981\u662fPaul Menage\u548cRohit Seth\uff09\uff0c\u6700\u65e9\u7684\u540d\u79f0\u4e3a\u8fdb\u7a0b\u5bb9\u5668\uff08process containers\uff09\u3002\u57282007\u5e74\u65f6\uff0c\u56e0\u4e3a\u5728Linux\u5185\u6838\u4e2d\uff0c\u5bb9\u5668\uff08container\uff09\u8fd9\u4e2a\u540d\u8bcd\u592a\u8fc7\u5e7f\u6cdb\uff0c\u4e3a\u907f\u514d\u6df7\u4e71\uff0c\u88ab\u91cd\u547d\u540d\u4e3acgroup\uff0c\u5e76\u4e14\u88ab\u5408\u5e76\u52302.6.24\u7248\u7684\u5185\u6838\u4e2d\u53bb\u3002\u7136\u540e\uff0c\u5176\u5b83\u5f00\u59cb\u4e86\u4ed6\u7684\u53d1\u5c55\u3002<\/p>\n<p>Linux CGroupCgroup \u53ef\u200b\u200b\u200b\u8ba9\u200b\u200b\u200b\u60a8\u200b\u200b\u200b\u4e3a\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u4e2d\u200b\u200b\u200b\u6240\u200b\u200b\u200b\u8fd0\u200b\u200b\u200b\u884c\u200b\u200b\u200b\u4efb\u200b\u200b\u200b\u52a1\u200b\u200b\u200b\uff08\u8fdb\u200b\u200b\u200b\u7a0b\u200b\u200b\u200b\uff09\u7684\u200b\u200b\u200b\u7528\u200b\u200b\u200b\u6237\u200b\u200b\u200b\u5b9a\u200b\u200b\u200b\u4e49\u200b\u200b\u200b\u7ec4\u200b\u200b\u200b\u7fa4\u200b\u200b\u200b\u5206\u200b\u200b\u200b\u914d\u200b\u200b\u200b\u8d44\u200b\u200b\u200b\u6e90\u200b\u200b\u200b &#8212; \u6bd4\u200b\u200b\u200b\u5982\u200b\u200b\u200b CPU \u65f6\u200b\u200b\u200b\u95f4\u200b\u200b\u200b\u3001\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u5185\u200b\u200b\u200b\u5b58\u200b\u200b\u200b\u3001\u200b\u200b\u200b\u7f51\u200b\u200b\u200b\u7edc\u200b\u200b\u200b\u5e26\u200b\u200b\u200b\u5bbd\u200b\u200b\u200b\u6216\u200b\u200b\u200b\u8005\u200b\u200b\u200b\u8fd9\u200b\u200b\u200b\u4e9b\u200b\u200b\u200b\u8d44\u200b\u200b\u200b\u6e90\u200b\u200b\u200b\u7684\u200b\u200b\u200b\u7ec4\u200b\u200b\u200b\u5408\u200b\u200b\u200b\u3002\u200b\u200b\u200b\u60a8\u200b\u200b\u200b\u53ef\u200b\u200b\u200b\u4ee5\u200b\u200b\u200b\u76d1\u200b\u200b\u200b\u63a7\u200b\u200b\u200b\u60a8\u200b\u200b\u200b\u914d\u200b\u200b\u200b\u7f6e\u200b\u200b\u200b\u7684\u200b\u200b\u200b cgroup\uff0c\u62d2\u200b\u200b\u200b\u7edd\u200b\u200b\u200b cgroup \u8bbf\u200b\u200b\u200b\u95ee\u200b\u200b\u200b\u67d0\u200b\u200b\u200b\u4e9b\u200b\u200b\u200b\u8d44\u200b\u200b\u200b\u6e90\u200b\u200b\u200b\uff0c\u751a\u200b\u200b\u200b\u81f3\u200b\u200b\u200b\u5728\u200b\u200b\u200b\u8fd0\u200b\u200b\u200b\u884c\u200b\u200b\u200b\u7684\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u4e2d\u200b\u200b\u200b\u52a8\u200b\u200b\u200b\u6001\u200b\u200b\u200b\u914d\u200b\u200b\u200b\u7f6e\u200b\u200b\u200b\u60a8\u200b\u200b\u200b\u7684\u200b\u200b\u200b cgroup\u3002<\/p>\n<p>\u4e3b\u8981\u63d0\u4f9b\u4e86\u5982\u4e0b\u529f\u80fd\uff1a<\/p>\n<p><!--more--><\/p>\n<ul>\n<li><strong>Resource limitation<\/strong>: \u9650\u5236\u8d44\u6e90\u4f7f\u7528\uff0c\u6bd4\u5982\u5185\u5b58\u4f7f\u7528\u4e0a\u9650\u4ee5\u53ca\u6587\u4ef6\u7cfb\u7edf\u7684\u7f13\u5b58\u9650\u5236\u3002<\/li>\n<li><strong>Prioritization<\/strong>: \u4f18\u5148\u7ea7\u63a7\u5236\uff0c\u6bd4\u5982\uff1aCPU\u5229\u7528\u548c\u78c1\u76d8IO\u541e\u5410\u3002<\/li>\n<li><strong>Accounting<\/strong>: \u4e00\u4e9b\u5ba1\u8ba1\u6216\u4e00\u4e9b\u7edf\u8ba1\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u8ba1\u8d39\u3002<\/li>\n<li><strong>Control<\/strong>: \u6302\u8d77\u8fdb\u7a0b\uff0c\u6062\u590d\u6267\u884c\u8fdb\u7a0b\u3002<\/li>\n<\/ul>\n<p>\u4f7f\u200b\u200b\u200b\u7528\u200b\u200b\u200b cgroup\uff0c\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u7ba1\u200b\u200b\u200b\u7406\u200b\u200b\u200b\u5458\u200b\u200b\u200b\u53ef\u200b\u200b\u200b\u66f4\u200b\u200b\u200b\u5177\u200b\u200b\u200b\u4f53\u200b\u200b\u200b\u5730\u200b\u200b\u200b\u63a7\u200b\u200b\u200b\u5236\u200b\u200b\u200b\u5bf9\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u8d44\u200b\u200b\u200b\u6e90\u200b\u200b\u200b\u7684\u200b\u200b\u200b\u5206\u200b\u200b\u200b\u914d\u200b\u200b\u200b\u3001\u200b\u200b\u200b\u4f18\u200b\u200b\u200b\u5148\u200b\u200b\u200b\u987a\u200b\u200b\u200b\u5e8f\u200b\u200b\u200b\u3001\u200b\u200b\u200b\u62d2\u200b\u200b\u200b\u7edd\u200b\u200b\u200b\u3001\u200b\u200b\u200b\u7ba1\u200b\u200b\u200b\u7406\u200b\u200b\u200b\u548c\u200b\u200b\u200b\u76d1\u200b\u200b\u200b\u63a7\u200b\u200b\u200b\u3002\u200b\u200b\u200b\u53ef\u200b\u200b\u200b\u66f4\u200b\u200b\u200b\u597d\u200b\u200b\u200b\u5730\u200b\u200b\u200b\u6839\u200b\u200b\u200b\u636e\u200b\u200b\u200b\u4efb\u200b\u200b\u200b\u52a1\u200b\u200b\u200b\u548c\u200b\u200b\u200b\u7528\u200b\u200b\u200b\u6237\u200b\u200b\u200b\u5206\u200b\u200b\u200b\u914d\u200b\u200b\u200b\u786c\u200b\u200b\u200b\u4ef6\u200b\u200b\u200b\u8d44\u200b\u200b\u200b\u6e90\u200b\u200b\u200b\uff0c\u63d0\u200b\u200b\u200b\u9ad8\u200b\u200b\u200b\u603b\u200b\u200b\u200b\u4f53\u200b\u200b\u200b\u6548\u200b\u200b\u200b\u7387\u200b\u200b\u200b\u3002<\/p>\n<p>\u5728\u5b9e\u8df5\u4e2d\uff0c\u7cfb\u7edf\u7ba1\u7406\u5458\u4e00\u822c\u4f1a\u5229\u7528CGroup\u505a\u4e0b\u9762\u8fd9\u4e9b\u4e8b\uff08\u6709\u70b9\u50cf\u4e3a\u67d0\u4e2a\u865a\u62df\u673a\u5206\u914d\u8d44\u6e90\u4f3c\u7684\uff09\uff1a<\/p>\n<ul>\n<li>\u9694\u79bb\u4e00\u4e2a\u8fdb\u7a0b\u96c6\u5408\uff08\u6bd4\u5982\uff1anginx\u7684\u6240\u6709\u8fdb\u7a0b\uff09\uff0c\u5e76\u9650\u5236\u4ed6\u4eec\u6240\u6d88\u8d39\u7684\u8d44\u6e90\uff0c\u6bd4\u5982\u7ed1\u5b9aCPU\u7684\u6838\u3002<\/li>\n<li>\u4e3a\u8fd9\u7ec4\u8fdb\u7a0b \u5206\u914d\u5176\u8db3\u591f\u4f7f\u7528\u7684\u5185\u5b58<\/li>\n<li>\u4e3a\u8fd9\u7ec4\u8fdb\u7a0b\u5206\u914d\u76f8\u5e94\u7684\u7f51\u7edc\u5e26\u5bbd\u548c\u78c1\u76d8\u5b58\u50a8\u9650\u5236<\/li>\n<li>\u9650\u5236\u8bbf\u95ee\u67d0\u4e9b\u8bbe\u5907\uff08\u901a\u8fc7\u8bbe\u7f6e\u8bbe\u5907\u7684\u767d\u540d\u5355\uff09<\/li>\n<\/ul>\n<p>\u90a3\u4e48CGroup\u662f\u600e\u4e48\u5e72\u7684\u5462\uff1f\u6211\u4eec\u5148\u6765\u70b9\u611f\u6027\u8ba4\u8bc6\u5427\u3002<\/p>\n<p>\u9996\u5148\uff0cLinux\u628aCGroup\u8fd9\u4e2a\u4e8b\u5b9e\u73b0\u6210\u4e86\u4e00\u4e2afile system\uff0c\u4f60\u53ef\u4ee5mount\u3002\u5728\u6211\u7684Ubuntu 14.04\u4e0b\uff0c\u4f60\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u4f60\u5c31\u53ef\u4ee5\u770b\u5230cgroup\u5df2\u4e3a\u4f60mount\u597d\u4e86\u3002<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">hchen@ubuntu:~$ mount -t cgroup\r\ncgroup on \/sys\/fs\/cgroup\/cpuset type cgroup (rw,relatime,cpuset)\r\ncgroup on \/sys\/fs\/cgroup\/cpu type cgroup (rw,relatime,cpu)\r\ncgroup on \/sys\/fs\/cgroup\/cpuacct type cgroup (rw,relatime,cpuacct)\r\ncgroup on \/sys\/fs\/cgroup\/memory type cgroup (rw,relatime,memory)\r\ncgroup on \/sys\/fs\/cgroup\/devices type cgroup (rw,relatime,devices)\r\ncgroup on \/sys\/fs\/cgroup\/freezer type cgroup (rw,relatime,freezer)\r\ncgroup on \/sys\/fs\/cgroup\/blkio type cgroup (rw,relatime,blkio)\r\ncgroup on \/sys\/fs\/cgroup\/net_prio type cgroup (rw,net_prio)\r\ncgroup on \/sys\/fs\/cgroup\/net_cls type cgroup (rw,net_cls)\r\ncgroup on \/sys\/fs\/cgroup\/perf_event type cgroup (rw,relatime,perf_event)\r\ncgroup on \/sys\/fs\/cgroup\/hugetlb type cgroup (rw,relatime,hugetlb)<\/pre>\n<p>\u6216\u8005\u4f7f\u7528lssubsys\u547d\u4ee4\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">$ lssubsys  -m\r\ncpuset \/sys\/fs\/cgroup\/cpuset\r\ncpu \/sys\/fs\/cgroup\/cpu\r\ncpuacct \/sys\/fs\/cgroup\/cpuacct\r\nmemory \/sys\/fs\/cgroup\/memory\r\ndevices \/sys\/fs\/cgroup\/devices\r\nfreezer \/sys\/fs\/cgroup\/freezer\r\nblkio \/sys\/fs\/cgroup\/blkio\r\nnet_cls \/sys\/fs\/cgroup\/net_cls\r\nnet_prio \/sys\/fs\/cgroup\/net_prio\r\nperf_event \/sys\/fs\/cgroup\/perf_event\r\nhugetlb \/sys\/fs\/cgroup\/hugetlb<\/pre>\n<p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5728\/sys\/fs\u4e0b\u6709\u4e00\u4e2acgroup\u7684\u76ee\u5f55\uff0c\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u8fd8\u6709\u5f88\u591a\u5b50\u76ee\u5f55\uff0c\u6bd4\u5982\uff1a cpu\uff0ccpuset\uff0cmemory\uff0cblkio\u2026\u2026\u8fd9\u4e9b\uff0c\u8fd9\u4e9b\u90fd\u662fcgroup\u7684\u5b50\u7cfb\u7edf\u3002\u5206\u522b\u7528\u4e8e\u5e72\u4e0d\u540c\u7684\u4e8b\u7684\u3002<\/p>\n<p>\u5982\u679c\u4f60\u6ca1\u6709\u770b\u5230\u4e0a\u8ff0\u7684\u76ee\u5f55\uff0c\u4f60\u53ef\u4ee5\u81ea\u5df1mount\uff0c\u4e0b\u9762\u7ed9\u4e86\u4e00\u4e2a\u793a\u4f8b\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">mkdir cgroup\r\nmount -t tmpfs cgroup_root .\/cgroup\r\nmkdir cgroup\/cpuset\r\nmount -t cgroup -ocpuset cpuset .\/cgroup\/cpuset\/\r\nmkdir cgroup\/cpu\r\nmount -t cgroup -ocpu cpu .\/cgroup\/cpu\/\r\nmkdir cgroup\/memory\r\nmount -t cgroup -omemory memory .\/cgroup\/memory\/<\/pre>\n<p>\u4e00\u65e6mount\u6210\u529f\uff0c\u4f60\u5c31\u4f1a\u770b\u5230\u8fd9\u4e9b\u76ee\u5f55\u4e0b\u5c31\u6709\u597d\u6587\u4ef6\u4e86\uff0c\u6bd4\u5982\uff0c\u5982\u4e0b\u6240\u793a\u7684cpu\u548ccpuset\u7684\u5b50\u7cfb\u7edf\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">hchen@ubuntu:~$ ls \/sys\/fs\/cgroup\/cpu \/sys\/fs\/cgroup\/cpuset\/ \r\n\/sys\/fs\/cgroup\/cpu:\r\ncgroup.clone_children  cgroup.sane_behavior  cpu.shares         release_agent\r\ncgroup.event_control   cpu.cfs_period_us     cpu.stat           tasks\r\ncgroup.procs           cpu.cfs_quota_us      notify_on_release  user\r\n\r\n\/sys\/fs\/cgroup\/cpuset\/:\r\ncgroup.clone_children  cpuset.mem_hardwall             cpuset.sched_load_balance\r\ncgroup.event_control   cpuset.memory_migrate           cpuset.sched_relax_domain_level\r\ncgroup.procs           cpuset.memory_pressure          notify_on_release\r\ncgroup.sane_behavior   cpuset.memory_pressure_enabled  release_agent\r\ncpuset.cpu_exclusive   cpuset.memory_spread_page       tasks\r\ncpuset.cpus            cpuset.memory_spread_slab       user\r\ncpuset.mem_exclusive   cpuset.mems<\/pre>\n<p>\u4f60\u53ef\u4ee5\u5230\/sys\/fs\/cgroup\u7684\u5404\u4e2a\u5b50\u76ee\u5f55\u4e0b\u53bbmake\u4e2adir\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u4e00\u65e6\u4f60\u521b\u5efa\u4e86\u4e00\u4e2a\u5b50\u76ee\u5f55\uff0c\u8fd9\u4e2a\u5b50\u76ee\u5f55\u91cc\u53c8\u6709\u5f88\u591a\u6587\u4ef6\u4e86\u3002<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">hchen@ubuntu:\/sys\/fs\/cgroup\/cpu$ sudo mkdir haoel\r\n[sudo] password for hchen: \r\nhchen@ubuntu:\/sys\/fs\/cgroup\/cpu$ ls .\/haoel\r\ncgroup.clone_children  cgroup.procs       cpu.cfs_quota_us  cpu.stat           tasks\r\ncgroup.event_control   cpu.cfs_period_us  cpu.shares        notify_on_release<\/pre>\n<p>\u597d\u4e86\uff0c\u6211\u4eec\u6765\u770b\u51e0\u4e2a\u793a\u4f8b\u3002<\/p>\n<div id=\"ez-toc-container\" class=\"ez-toc-v2_0_48 counter-hierarchy ez-toc-counter ez-toc-grey ez-toc-container-direction\">\n<div class=\"ez-toc-title-container\">\n<p class=\"ez-toc-title\">\u76ee\u5f55<\/p>\n<span class=\"ez-toc-title-toggle\"><\/span><\/div>\n<nav><ul class='ez-toc-list ez-toc-list-level-1 ' ><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-1\" href=\"https:\/\/coolshell.cn\/articles\/17049.html\/#CPU_%E9%99%90%E5%88%B6\" title=\"CPU \u9650\u5236\">CPU \u9650\u5236<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-2\" href=\"https:\/\/coolshell.cn\/articles\/17049.html\/#%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6\" title=\"\u5185\u5b58\u4f7f\u7528\u9650\u5236\">\u5185\u5b58\u4f7f\u7528\u9650\u5236<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-3\" href=\"https:\/\/coolshell.cn\/articles\/17049.html\/#%E7%A3%81%E7%9B%98IO%E9%99%90%E5%88%B6\" title=\"\u78c1\u76d8I\/O\u9650\u5236\">\u78c1\u76d8I\/O\u9650\u5236<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-4\" href=\"https:\/\/coolshell.cn\/articles\/17049.html\/#CGroup%E7%9A%84%E5%AD%90%E7%B3%BB%E7%BB%9F\" title=\"CGroup\u7684\u5b50\u7cfb\u7edf\">CGroup\u7684\u5b50\u7cfb\u7edf<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-5\" href=\"https:\/\/coolshell.cn\/articles\/17049.html\/#CGroup%E7%9A%84%E6%9C%AF%E8%AF%AD\" title=\"CGroup\u7684\u672f\u8bed\">CGroup\u7684\u672f\u8bed<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-6\" href=\"https:\/\/coolshell.cn\/articles\/17049.html\/#%E4%B8%8B%E4%B8%80%E4%BB%A3%E7%9A%84CGroup\" title=\"\u4e0b\u4e00\u4ee3\u7684CGroup\">\u4e0b\u4e00\u4ee3\u7684CGroup<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-7\" href=\"https:\/\/coolshell.cn\/articles\/17049.html\/#%E5%8F%82%E8%80%83\" title=\"\u53c2\u8003\">\u53c2\u8003<\/a><\/li><\/ul><\/nav><\/div>\n<h4><span class=\"ez-toc-section\" id=\"CPU_%E9%99%90%E5%88%B6\"><\/span>CPU \u9650\u5236<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u5047\u8bbe\uff0c\u6211\u4eec\u6709\u4e00\u4e2a\u975e\u5e38\u5403CPU\u7684\u7a0b\u5e8f\uff0c\u53ebdeadloop\uff0c\u5176\u6e90\u7801\u5982\u4e0b\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">int main(void)\r\n{\r\n    int i = 0;\r\n    for(;;) i++;\r\n    return 0;\r\n}<\/pre>\n<p>\u7528sudo\u6267\u884c\u8d77\u6765\u540e\uff0c\u6beb\u65e0\u7591\u95ee\uff0cCPU\u88ab\u5e72\u5230\u4e86100%\uff08\u4e0b\u9762\u662ftop\u547d\u4ee4\u7684\u8f93\u51fa\uff09<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND     \r\n 3529 root      20   0    4196    736    656 R 99.6  0.1   0:23.13 deadloop   <\/pre>\n<p>\u7136\u540e\uff0c\u6211\u4eec\u8fd9\u524d\u4e0d\u662f\u5728\/sys\/fs\/cgroup\/cpu\u4e0b\u521b\u5efa\u4e86\u4e00\u4e2ahaoel\u7684group\u3002\u6211\u4eec\u5148\u8bbe\u7f6e\u4e00\u4e0b\u8fd9\u4e2agroup\u7684cpu\u5229\u7528\u7684\u9650\u5236\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">hchen@ubuntu:~# cat \/sys\/fs\/cgroup\/cpu\/haoel\/cpu.cfs_quota_us \r\n-1\r\nroot@ubuntu:~# echo 20000 &gt; \/sys\/fs\/cgroup\/cpu\/haoel\/cpu.cfs_quota_us<\/pre>\n<p>\u6211\u4eec\u770b\u5230\uff0c\u8fd9\u4e2a\u8fdb\u7a0b\u7684PID\u662f3529\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u8fdb\u7a0b\u52a0\u5230\u8fd9\u4e2acgroup\u4e2d\uff1a<\/p>\n<p><code data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\"># echo 3529 &gt;&gt; \/sys\/fs\/cgroup\/cpu\/haoel\/tasks<\/code><\/p>\n<p>\u7136\u540e\uff0c\u5c31\u4f1a\u5728top\u4e2d\u770b\u5230CPU\u7684\u5229\u7528\u7acb\u9a6c\u4e0b\u964d\u621020%\u4e86\u3002\uff08\u524d\u9762\u6211\u4eec\u8bbe\u7f6e\u768420000\u5c31\u662f20%\u7684\u610f\u601d\uff09<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND     \r\n 3529 root      20   0    4196    736    656 R 19.9  0.1   8:06.11 deadloop    <\/pre>\n<p>\u4e0b\u9762\u7684\u4ee3\u7801\u662f\u4e00\u4e2a\u7ebf\u7a0b\u7684\u793a\u4f8b\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">#define _GNU_SOURCE         \/* See feature_test_macros(7) *\/\r\n\r\n#include &lt;pthread.h&gt;\r\n#include &lt;stdio.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;sys\/stat.h&gt;\r\n#include &lt;sys\/types.h&gt;\r\n#include &lt;unistd.h&gt;\r\n#include &lt;sys\/syscall.h&gt;\r\n\r\n\r\nconst int NUM_THREADS = 5;\r\n\r\nvoid *thread_main(void *threadid)\r\n{\r\n    \/* \u628a\u81ea\u5df1\u52a0\u5165cgroup\u4e2d\uff08syscall(SYS_gettid)\u4e3a\u5f97\u5230\u7ebf\u7a0b\u7684\u7cfb\u7edftid\uff09 *\/\r\n    char cmd[128];\r\n    sprintf(cmd, &quot;echo %ld &gt;&gt; \/sys\/fs\/cgroup\/cpu\/haoel\/tasks&quot;, syscall(SYS_gettid));\r\n    system(cmd); \r\n    sprintf(cmd, &quot;echo %ld &gt;&gt; \/sys\/fs\/cgroup\/cpuset\/haoel\/tasks&quot;, syscall(SYS_gettid));\r\n    system(cmd);\r\n\r\n    long tid;\r\n    tid = (long)threadid;\r\n    printf(&quot;Hello World! It&#039;s me, thread #%ld, pid #%ld!\\n&quot;, tid, syscall(SYS_gettid));\r\n    \r\n    int a=0; \r\n    while(1) {\r\n        a++;\r\n    }\r\n    pthread_exit(NULL);\r\n}\r\nint main (int argc, char *argv[])\r\n{\r\n    int num_threads;\r\n    if (argc &gt; 1){\r\n        num_threads = atoi(argv[1]);\r\n    }\r\n    if (num_threads&lt;=0 || num_threads&gt;=100){\r\n        num_threads = NUM_THREADS;\r\n    }\r\n\r\n    \/* \u8bbe\u7f6eCPU\u5229\u7528\u7387\u4e3a50% *\/\r\n    mkdir(&quot;\/sys\/fs\/cgroup\/cpu\/haoel&quot;, 755);\r\n    system(&quot;echo 50000 &gt; \/sys\/fs\/cgroup\/cpu\/haoel\/cpu.cfs_quota_us&quot;);\r\n\r\n    mkdir(&quot;\/sys\/fs\/cgroup\/cpuset\/haoel&quot;, 755);\r\n    \/* \u9650\u5236CPU\u53ea\u80fd\u4f7f\u7528#2\u6838\u548c#3\u6838 *\/\r\n    system(&quot;echo \\&quot;2,3\\&quot; &gt; \/sys\/fs\/cgroup\/cpuset\/haoel\/cpuset.cpus&quot;);\r\n\r\n    pthread_t* threads = (pthread_t*) malloc (sizeof(pthread_t)*num_threads);\r\n    int rc;\r\n    long t;\r\n    for(t=0; t&lt;num_threads; t++){\r\n        printf(&quot;In main: creating thread %ld\\n&quot;, t);\r\n        rc = pthread_create(&amp;threads[t], NULL, thread_main, (void *)t);\r\n        if (rc){\r\n            printf(&quot;ERROR; return code from pthread_create() is %d\\n&quot;, rc);\r\n            exit(-1);\r\n        }\r\n    }\r\n\r\n    \/* Last thing that main() should do *\/\r\n    pthread_exit(NULL);\r\n    free(threads);\r\n}\r\n<\/pre>\n<h4><span class=\"ez-toc-section\" id=\"%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6\"><\/span>\u5185\u5b58\u4f7f\u7528\u9650\u5236<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u6211\u4eec\u518d\u6765\u770b\u4e00\u4e2a\u9650\u5236\u5185\u5b58\u7684\u4f8b\u5b50\uff08\u4e0b\u9762\u7684\u4ee3\u7801\u662f\u4e2a\u6b7b\u5faa\u73af\uff0c\u5176\u5b83\u4e0d\u65ad\u7684\u5206\u914d\u5185\u5b58\uff0c\u6bcf\u6b21512\u4e2a\u5b57\u8282\uff0c\u6bcf\u6b21\u4f11\u606f\u4e00\u79d2\uff09\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">#include &lt;stdio.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;string.h&gt;\r\n#include &lt;sys\/types.h&gt;\r\n#include &lt;unistd.h&gt;\r\n\r\nint main(void)\r\n{\r\n    int size = 0;\r\n    int chunk_size = 512;\r\n    void *p = NULL;\r\n\r\n    while(1) {\r\n\r\n        if ((p = malloc(p, chunk_size)) == NULL) {\r\n            printf(&quot;out of memory!!\\n&quot;);\r\n            break;\r\n        }\r\n        memset(p, 1, chunk_size);\r\n        size += chunk_size;\r\n        printf(&quot;[%d] - memory is allocated [%8d] bytes \\n&quot;, getpid(), size);\r\n        sleep(1);\r\n    }\r\n    return 0;\r\n}<\/pre>\n<p>\u7136\u540e\uff0c\u5728\u6211\u4eec\u53e6\u5916\u4e00\u8fb9\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\"># \u521b\u5efamemory cgroup\r\n$ mkdir \/sys\/fs\/cgroup\/memory\/haoel\r\n$ echo 64k &gt; \/sys\/fs\/cgroup\/memory\/haoel\/memory.limit_in_bytes\r\n\r\n# \u628a\u4e0a\u9762\u7684\u8fdb\u7a0b\u7684pid\u52a0\u5165\u8fd9\u4e2acgroup\r\n$ echo [pid] &gt; \/sys\/fs\/cgroup\/memory\/haoel\/tasks <\/pre>\n<p>\u4f60\u4f1a\u770b\u5230\uff0c\u4e00\u4f1a\u4e0a\u9762\u7684\u8fdb\u7a0b\u5c31\u4f1a\u56e0\u4e3a\u5185\u5b58\u95ee\u9898\u88abkill\u6389\u4e86\u3002<\/p>\n<h4><span class=\"ez-toc-section\" id=\"%E7%A3%81%E7%9B%98IO%E9%99%90%E5%88%B6\"><\/span>\u78c1\u76d8I\/O\u9650\u5236<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u6211\u4eec\u5148\u770b\u4e00\u4e0b\u6211\u4eec\u7684\u786c\u76d8IO\uff0c\u6211\u4eec\u7684\u6a21\u62df\u547d\u4ee4\u5982\u4e0b\uff1a\uff08\u4ece\/dev\/sda1\u4e0a\u8bfb\u5165\u6570\u636e\uff0c\u8f93\u51fa\u5230\/dev\/null\u4e0a\uff09<\/p>\n<p><code data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">sudo dd if=\/dev\/sda1 of=\/dev\/null<\/code><\/p>\n<p>\u6211\u4eec\u901a\u8fc7iotop\u547d\u4ee4\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u76f8\u5173\u7684IO\u901f\u5ea6\u662f55MB\/s\uff08\u865a\u62df\u673a\u5185\uff09\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND          \r\n 8128 be\/4 root       55.74 M\/s    0.00 B\/s  0.00 % 85.65 % dd if=\/de~=\/dev\/null...<\/pre>\n<p>\u7136\u540e\uff0c\u6211\u4eec\u5148\u521b\u5efa\u4e00\u4e2ablkio\uff08\u5757\u8bbe\u5907IO\uff09\u7684cgroup<\/p>\n<p><code data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">mkdir \/sys\/fs\/cgroup\/blkio\/haoel<\/code><\/p>\n<p>\u5e76\u628a\u8bfbIO\u9650\u5236\u52301MB\/s\uff0c\u5e76\u628a\u524d\u9762\u90a3\u4e2add\u547d\u4ee4\u7684pid\u653e\u8fdb\u53bb\uff08\u6ce8\uff1a8:0 \u662f\u8bbe\u5907\u53f7\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7ls -l \/dev\/sda1\u83b7\u5f97\uff09\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">root@ubuntu:~# echo &#039;8:0 1048576&#039;  &gt; \/sys\/fs\/cgroup\/blkio\/haoel\/blkio.throttle.read_bps_device \r\nroot@ubuntu:~# echo 8128 &gt; \/sys\/fs\/cgroup\/blkio\/haoel\/tasks<\/pre>\n<p>\u518d\u7528iotop\u547d\u4ee4\uff0c\u4f60\u9a6c\u4e0a\u5c31\u80fd\u770b\u5230\u8bfb\u901f\u5ea6\u88ab\u9650\u5236\u5230\u4e861MB\/s\u5de6\u53f3\u3002<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND          \r\n 8128 be\/4 root      973.20 K\/s    0.00 B\/s  0.00 % 94.41 % dd if=\/de~=\/dev\/null...<\/pre>\n<h4><span class=\"ez-toc-section\" id=\"CGroup%E7%9A%84%E5%AD%90%E7%B3%BB%E7%BB%9F\"><\/span>CGroup\u7684\u5b50\u7cfb\u7edf<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u597d\u4e86\uff0c\u6709\u4e86\u4ee5\u4e0a\u7684\u611f\u6027\u8ba4\u8bc6\u6211\u4eec\u6765\uff0c\u6211\u4eec\u6765\u770b\u770bcontrol group\u6709\u54ea\u4e9b\u5b50\u7cfb\u7edf\uff1a<\/p>\n<ul>\n<li>blkio &#8212; \u8fd9\u200b\u200b\u200b\u4e2a\u200b\u200b\u200b\u5b50\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u4e3a\u200b\u200b\u200b\u5757\u200b\u200b\u200b\u8bbe\u200b\u200b\u200b\u5907\u200b\u200b\u200b\u8bbe\u200b\u200b\u200b\u5b9a\u200b\u200b\u200b\u8f93\u200b\u200b\u200b\u5165\u200b\u200b\u200b\/\u8f93\u200b\u200b\u200b\u51fa\u200b\u200b\u200b\u9650\u200b\u200b\u200b\u5236\u200b\u200b\u200b\uff0c\u6bd4\u200b\u200b\u200b\u5982\u200b\u200b\u200b\u7269\u200b\u200b\u200b\u7406\u200b\u200b\u200b\u8bbe\u200b\u200b\u200b\u5907\u200b\u200b\u200b\uff08\u78c1\u200b\u200b\u200b\u76d8\u200b\u200b\u200b\uff0c\u56fa\u200b\u200b\u200b\u6001\u200b\u200b\u200b\u786c\u200b\u200b\u200b\u76d8\u200b\u200b\u200b\uff0cUSB \u7b49\u200b\u200b\u200b\u7b49\u200b\u200b\u200b\uff09\u3002<\/li>\n<li>cpu &#8212; \u8fd9\u200b\u200b\u200b\u4e2a\u200b\u200b\u200b\u5b50\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u4f7f\u200b\u200b\u200b\u7528\u200b\u200b\u200b\u8c03\u200b\u200b\u200b\u5ea6\u200b\u200b\u200b\u7a0b\u200b\u200b\u200b\u5e8f\u200b\u200b\u200b\u63d0\u200b\u200b\u200b\u4f9b\u200b\u200b\u200b\u5bf9\u200b\u200b\u200b CPU \u7684\u200b\u200b\u200b cgroup \u4efb\u200b\u200b\u200b\u52a1\u200b\u200b\u200b\u8bbf\u200b\u200b\u200b\u95ee\u200b\u200b\u200b\u3002\u200b\u200b\u200b<\/li>\n<li>cpuacct &#8212; \u8fd9\u200b\u200b\u200b\u4e2a\u200b\u200b\u200b\u5b50\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u81ea\u200b\u200b\u200b\u52a8\u200b\u200b\u200b\u751f\u200b\u200b\u200b\u6210\u200b\u200b\u200b cgroup \u4e2d\u200b\u200b\u200b\u4efb\u200b\u200b\u200b\u52a1\u200b\u200b\u200b\u6240\u200b\u200b\u200b\u4f7f\u200b\u200b\u200b\u7528\u200b\u200b\u200b\u7684\u200b\u200b\u200b CPU \u62a5\u200b\u200b\u200b\u544a\u200b\u200b\u200b\u3002\u200b\u200b\u200b<\/li>\n<li>cpuset &#8212; \u8fd9\u200b\u200b\u200b\u4e2a\u200b\u200b\u200b\u5b50\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u4e3a\u200b\u200b\u200b cgroup \u4e2d\u200b\u200b\u200b\u7684\u200b\u200b\u200b\u4efb\u200b\u200b\u200b\u52a1\u200b\u200b\u200b\u5206\u200b\u200b\u200b\u914d\u200b\u200b\u200b\u72ec\u200b\u200b\u200b\u7acb\u200b\u200b\u200b CPU\uff08\u5728\u200b\u200b\u200b\u591a\u200b\u200b\u200b\u6838\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\uff09\u548c\u200b\u200b\u200b\u5185\u200b\u200b\u200b\u5b58\u200b\u200b\u200b\u8282\u200b\u200b\u200b\u70b9\u200b\u200b\u200b\u3002\u200b\u200b\u200b<\/li>\n<li>devices &#8212; \u8fd9\u200b\u200b\u200b\u4e2a\u200b\u200b\u200b\u5b50\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u53ef\u200b\u200b\u200b\u5141\u200b\u200b\u200b\u8bb8\u200b\u200b\u200b\u6216\u200b\u200b\u200b\u8005\u200b\u200b\u200b\u62d2\u200b\u200b\u200b\u7edd\u200b\u200b\u200b cgroup \u4e2d\u200b\u200b\u200b\u7684\u200b\u200b\u200b\u4efb\u200b\u200b\u200b\u52a1\u200b\u200b\u200b\u8bbf\u200b\u200b\u200b\u95ee\u200b\u200b\u200b\u8bbe\u200b\u200b\u200b\u5907\u200b\u200b\u200b\u3002\u200b\u200b\u200b<\/li>\n<li>freezer &#8212; \u8fd9\u200b\u200b\u200b\u4e2a\u200b\u200b\u200b\u5b50\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u6302\u200b\u200b\u200b\u8d77\u200b\u200b\u200b\u6216\u200b\u200b\u200b\u8005\u200b\u200b\u200b\u6062\u200b\u200b\u200b\u590d\u200b\u200b\u200b cgroup \u4e2d\u200b\u200b\u200b\u7684\u200b\u200b\u200b\u4efb\u200b\u200b\u200b\u52a1\u200b\u200b\u200b\u3002\u200b\u200b\u200b<\/li>\n<li>memory &#8212; \u8fd9\u200b\u200b\u200b\u4e2a\u200b\u200b\u200b\u5b50\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u8bbe\u200b\u200b\u200b\u5b9a\u200b\u200b\u200b cgroup \u4e2d\u200b\u200b\u200b\u4efb\u200b\u200b\u200b\u52a1\u200b\u200b\u200b\u4f7f\u200b\u200b\u200b\u7528\u200b\u200b\u200b\u7684\u200b\u200b\u200b\u5185\u200b\u200b\u200b\u5b58\u200b\u200b\u200b\u9650\u200b\u200b\u200b\u5236\u200b\u200b\u200b\uff0c\u5e76\u200b\u200b\u200b\u81ea\u200b\u200b\u200b\u52a8\u200b\u200b\u200b\u751f\u200b\u200b\u200b\u6210\u200b\u200b\u200b\u200b\u200b\u5185\u200b\u200b\u200b\u5b58\u200b\u200b\u200b\u8d44\u200b\u200b\u200b\u6e90\u4f7f\u7528\u200b\u200b\u200b\u62a5\u200b\u200b\u200b\u544a\u200b\u200b\u200b\u3002\u200b\u200b\u200b<\/li>\n<li>net_cls &#8212; \u8fd9\u200b\u200b\u200b\u4e2a\u200b\u200b\u200b\u5b50\u200b\u200b\u200b\u7cfb\u200b\u200b\u200b\u7edf\u200b\u200b\u200b\u4f7f\u200b\u200b\u200b\u7528\u200b\u200b\u200b\u7b49\u200b\u200b\u200b\u7ea7\u200b\u200b\u200b\u8bc6\u200b\u200b\u200b\u522b\u200b\u200b\u200b\u7b26\u200b\u200b\u200b\uff08classid\uff09\u6807\u200b\u200b\u200b\u8bb0\u200b\u200b\u200b\u7f51\u200b\u200b\u200b\u7edc\u200b\u200b\u200b\u6570\u200b\u200b\u200b\u636e\u200b\u200b\u200b\u5305\u200b\u200b\u200b\uff0c\u53ef\u200b\u200b\u200b\u5141\u200b\u200b\u200b\u8bb8\u200b\u200b\u200b Linux \u6d41\u200b\u200b\u200b\u91cf\u200b\u200b\u200b\u63a7\u200b\u200b\u200b\u5236\u200b\u200b\u200b\u7a0b\u200b\u200b\u200b\u5e8f\u200b\u200b\u200b\uff08tc\uff09\u8bc6\u200b\u200b\u200b\u522b\u200b\u200b\u200b\u4ece\u200b\u200b\u200b\u5177\u200b\u200b\u200b\u4f53\u200b\u200b\u200b cgroup \u4e2d\u200b\u200b\u200b\u751f\u200b\u200b\u200b\u6210\u200b\u200b\u200b\u7684\u200b\u200b\u200b\u6570\u200b\u200b\u200b\u636e\u200b\u200b\u200b\u5305\u200b\u200b\u200b\u3002\u200b\u200b\u200b<\/li>\n<li>net_prio &#8212; \u8fd9\u4e2a\u5b50\u7cfb\u7edf\u7528\u6765\u8bbe\u8ba1\u7f51\u7edc\u6d41\u91cf\u7684\u4f18\u5148\u7ea7<\/li>\n<li>hugetlb &#8212; \u8fd9\u4e2a\u5b50\u7cfb\u7edf\u4e3b\u8981\u9488\u5bf9\u4e8eHugeTLB\u7cfb\u7edf\u8fdb\u884c\u9650\u5236\uff0c\u8fd9\u662f\u4e00\u4e2a\u5927\u9875\u6587\u4ef6\u7cfb\u7edf\u3002<\/li>\n<p>\u200b\u200b\u200b<\/ul>\n<p>\u6ce8\u610f\uff0c\u4f60\u53ef\u80fd\u5728Ubuntu 14.04\u4e0b\u770b\u4e0d\u5230net_cls\u548cnet_prio\u8fd9\u4e24\u4e2acgroup\uff0c\u4f60\u9700\u8981\u624b\u52a8mount\u4e00\u4e0b\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">$ sudo modprobe cls_cgroup\r\n$ sudo mkdir \/sys\/fs\/cgroup\/net_cls\r\n$ sudo mount -t cgroup -o net_cls none \/sys\/fs\/cgroup\/net_cls\r\n\r\n$ sudo modprobe netprio_cgroup\r\n$ sudo mkdir \/sys\/fs\/cgroup\/net_prio\r\n$ sudo mount -t cgroup -o net_prio none \/sys\/fs\/cgroup\/net_prio<\/pre>\n<p>\u5173\u4e8e\u5404\u4e2a\u5b50\u7cfb\u7edf\u7684\u53c2\u6570\u7ec6\u8282\uff0c\u4ee5\u53ca\u66f4\u591a\u7684Linux CGroup\u7684\u6587\u6863\uff0c\u4f60\u53ef\u4ee5\u770b\u770b\u4e0b\u9762\u7684\u6587\u6863\uff1a<\/p>\n<ul>\n<li><a href=\"https:\/\/www.kernel.org\/doc\/Documentation\/cgroups\/\" target=\"_blank\">Linux Kernel\u7684\u5b98\u65b9\u6587\u6863<\/a><\/li>\n<li><a href=\"https:\/\/access.redhat.com\/documentation\/zh-CN\/Red_Hat_Enterprise_Linux\/6\/html-single\/Resource_Management_Guide\/index.html#ch-Subsystems_and_Tunable_Parameters\" target=\"_blank\">Redhat\u7684\u5b98\u65b9\u6587\u6863<\/a><\/li>\n<\/ul>\n<h4><span class=\"ez-toc-section\" id=\"CGroup%E7%9A%84%E6%9C%AF%E8%AF%AD\"><\/span>CGroup\u7684\u672f\u8bed<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>CGroup\u6709\u4e0b\u8ff0\u672f\u8bed\uff1a<\/p>\n<ul>\n<li><strong>\u4efb\u52a1\uff08Tasks\uff09<\/strong>\uff1a\u5c31\u662f\u7cfb\u7edf\u7684\u4e00\u4e2a\u8fdb\u7a0b\u3002<\/li>\n<li><strong>\u63a7\u5236\u7ec4\uff08Control Group\uff09<\/strong>\uff1a\u4e00\u7ec4\u6309\u7167\u67d0\u79cd\u6807\u51c6\u5212\u5206\u7684\u8fdb\u7a0b\uff0c\u6bd4\u5982\u5b98\u65b9\u6587\u6863\u4e2d\u7684Professor\u548cStudent\uff0c\u6216\u662fWWW\u548cSystem\u4e4b\u7c7b\u7684\uff0c\u5176\u8868\u793a\u4e86\u67d0\u8fdb\u7a0b\u7ec4\u3002Cgroups\u4e2d\u7684\u8d44\u6e90\u63a7\u5236\u90fd\u662f\u4ee5\u63a7\u5236\u7ec4\u4e3a\u5355\u4f4d\u5b9e\u73b0\u3002\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u52a0\u5165\u5230\u67d0\u4e2a\u63a7\u5236\u7ec4\u3002\u800c\u8d44\u6e90\u7684\u9650\u5236\u662f\u5b9a\u4e49\u5728\u8fd9\u4e2a\u7ec4\u4e0a\uff0c\u5c31\u50cf\u4e0a\u9762\u793a\u4f8b\u4e2d\u6211\u7528\u7684haoel\u4e00\u6837\u3002\u7b80\u5355\u70b9\u8bf4\uff0ccgroup\u7684\u5448\u73b0\u5c31\u662f\u4e00\u4e2a\u76ee\u5f55\u5e26\u4e00\u7cfb\u5217\u7684\u53ef\u914d\u7f6e\u6587\u4ef6\u3002<\/li>\n<li><strong>\u5c42\u7ea7\uff08Hierarchy\uff09<\/strong>\uff1a\u63a7\u5236\u7ec4\u53ef\u4ee5\u7ec4\u7ec7\u6210hierarchical\u7684\u5f62\u5f0f\uff0c\u65e2\u4e00\u9897\u63a7\u5236\u7ec4\u7684\u6811\uff08\u76ee\u5f55\u7ed3\u6784\uff09\u3002\u63a7\u5236\u7ec4\u6811\u4e0a\u7684\u5b50\u8282\u70b9\u7ee7\u627f\u7236\u7ed3\u70b9\u7684\u5c5e\u6027\u3002\u7b80\u5355\u70b9\u8bf4\uff0chierarchy\u5c31\u662f\u5728\u4e00\u4e2a\u6216\u591a\u4e2a\u5b50\u7cfb\u7edf\u4e0a\u7684cgroups\u76ee\u5f55\u6811\u3002<\/li>\n<li><strong>\u5b50\u7cfb\u7edf\uff08Subsystem\uff09<\/strong>\uff1a\u4e00\u4e2a\u5b50\u7cfb\u7edf\u5c31\u662f\u4e00\u4e2a\u8d44\u6e90\u63a7\u5236\u5668\uff0c\u6bd4\u5982CPU\u5b50\u7cfb\u7edf\u5c31\u662f\u63a7\u5236CPU\u65f6\u95f4\u5206\u914d\u7684\u4e00\u4e2a\u63a7\u5236\u5668\u3002\u5b50\u7cfb\u7edf\u5fc5\u987b\u9644\u52a0\u5230\u4e00\u4e2a\u5c42\u7ea7\u4e0a\u624d\u80fd\u8d77\u4f5c\u7528\uff0c\u4e00\u4e2a\u5b50\u7cfb\u7edf\u9644\u52a0\u5230\u67d0\u4e2a\u5c42\u7ea7\u4ee5\u540e\uff0c\u8fd9\u4e2a\u5c42\u7ea7\u4e0a\u7684\u6240\u6709\u63a7\u5236\u65cf\u7fa4\u90fd\u53d7\u5230\u8fd9\u4e2a\u5b50\u7cfb\u7edf\u7684\u63a7\u5236\u3002Cgroup\u7684\u5b50\u7cfb\u7edf\u53ef\u4ee5\u6709\u5f88\u591a\uff0c\u4e5f\u5728\u4e0d\u65ad\u589e\u52a0\u4e2d\u3002<\/li>\n<\/ul>\n<h4><span class=\"ez-toc-section\" id=\"%E4%B8%8B%E4%B8%80%E4%BB%A3%E7%9A%84CGroup\"><\/span>\u4e0b\u4e00\u4ee3\u7684CGroup<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u4e0a\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0cCGroup\u7684\u4e00\u4e9b\u5e38\u7528\u65b9\u6cd5\u548c\u76f8\u5173\u7684\u672f\u8bed\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u8fd9\u6837\u7684\u8bbe\u8ba1\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\u8fd8\u662f\u6ca1\u4ec0\u4e48\u95ee\u9898\u7684\uff0c\u9664\u4e86\u64cd\u4f5c\u4e0a\u7684\u7528\u6237\u4f53\u9a8c\u4e0d\u662f\u5f88\u597d\uff0c\u4f46\u57fa\u672c\u6ee1\u8db3\u6211\u4eec\u7684\u4e00\u822c\u9700\u6c42\u4e86\u3002<\/p>\n<p>\u4e0d\u8fc7\uff0c\u5bf9\u6b64\uff0c\u6709\u4e2a\u53ebTejun Heo\u7684\u540c\u5b66\u975e\u5e38\u4e0d\u723d\uff0c\u4ed6\u5728Linux\u793e\u533a\u91cc<a href=\"https:\/\/lwn.net\/Articles\/484254\/\" target=\"_blank\">\u5bf9cgroup\u5410\u4e86\u4e00\u628a\u69fd<\/a>\uff0c\u8fd8\u5f15\u53d1\u4e86\u5185\u6838\u7ec4\u7684\u5404\u79cd\u8ba8\u8bba\u3002<\/p>\n<p>\u5bf9\u4e8eTejun Heo\u540c\u5b66\u6765\u8bf4\uff0ccgroup\u8bbe\u8ba1\u7684\u76f8\u5f53\u7cdf\u7cd5\u3002\u4ed6\u7ed9\u51fa\u4e86\u4e9b\u4f8b\u5b50\uff0c\u5927\u610f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6709\u591a\u79cd\u5c42\u7ea7\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u8bf4\u6709\u591a\u79cd\u5bf9\u8fdb\u7a0b\u7684\u5206\u7c7b\u65b9\u5f0f\uff0c\u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u6309\u7528\u6237\u6765\u5206\uff0c\u5206\u6210Professor\u548cStudent\uff0c\u540c\u65f6\uff0c\u4e5f\u6709\u6309\u5e94\u7528\u7c7b\u4f3c\u6765\u5206\u7684\uff0c\u6bd4\u5982WWW\u548cNFS\u7b49\u3002\u90a3\u4e48\uff0c\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u5373\u662fProfessor\u7684\uff0c\u4e5f\u662fWWW\u7684\uff0c\u90a3\u4e48\u5c31\u4f1a\u51fa\u73b0\u591a\u5c42\u7ea7\u6b63\u4ea4\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u51fa\u73b0\u5bf9\u8fdb\u7a0b\u4e0a\u7ba1\u7406\u7684\u6df7\u4e71\u3002\u53e6\u5916\uff0c\u4e00\u4e2acase\u662f\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u5c42\u7ea7A\u7ed1\u5b9acpu\uff0c\u800c\u5c42\u7ea7B\u7ed1\u5b9amemory\uff0c\u8fd8\u6709\u4e00\u4e2a\u5c42\u7ea7C\u7ed1\u5b9acputset\uff0c\u800c\u6709\u4e00\u4e9b\u8fdb\u7a0b\u6709\u7684\u9700\u8981AB\uff0c\u6709\u7684\u9700\u8981AC\uff0c\u6709\u7684\u9700\u8981ABC\uff0c\u7ba1\u7406\u8d77\u6765\u5c31\u76f8\u5f53\u4e0d\u6613\u3002 <\/p>\n<p>\u5c42\u7ea7\u64cd\u4f5c\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\uff0c\u800c\u4e14\u5982\u679c\u5c42\u7ea7\u53d8\u591a\uff0c\u66f4\u4e0d\u6613\u4e8e\u64cd\u4f5c\u548c\u7ba1\u7406\uff0c\u867d\u7136\u90a3\u79cd\u65b9\u5f0f\u5f88\u597d\u5b9e\u73b0\uff0c\u4f46\u662f\u5728\u4f7f\u7528\u4e0a\u6709\u5f88\u591a\u7684\u590d\u6742\u5ea6\u3002\u4f60\u53ef\u4ee5\u60f3\u50cf\u4e00\u4e2a\u56fe\u4e66\u9986\u7684\u56fe\u4e66\u5206\u7c7b\u95ee\u9898\uff0c\u4f60\u53ef\u4ee5\u6709\u5404\u79cd\u4e0d\u540c\u7684\u5206\u7c7b\uff0c\u5206\u7c7b\u548c\u56fe\u4e66\u5c31\u662f\u4e00\u79cd\u591a\u5bf9\u591a\u7684\u5173\u7cfb\u3002<\/p>\n<p>\u6240\u4ee5\uff0c\u5728Kernel 3.16\u540e\uff0c\u5f15\u5165\u4e86<a href=\"http:\/\/lwn.net\/Articles\/601840\/\" target=\"_blank\">unified hierarchy<\/a>\u7684\u65b0\u7684\u8bbe\u8ba1\uff0c\u8fd9\u4e2a\u4e1c\u897f\u5f15\u5165\u4e86\u4e00\u4e2a\u53eb<strong>__DEVEL__sane_behavior<\/strong>\u7684\u7279\u6027\uff08\u8fd9\u4e2a\u540d\u5b57\u5f88\u660e\u663e\u610f\u5473\u76ee\u524d\u8fd8\u5728\u5f00\u53d1\u8bd5\u9a8c\u9636\u6bb5\uff09\uff0c\u5b83\u53ef\u4ee5\u628a\u6240\u6709\u5b50\u7cfb\u7edf\u90fd\u6302\u8f7d\u5230\u6839\u5c42\u7ea7\u4e0b\uff0c\u53ea\u6709\u53f6\u5b50\u8282\u70b9\u53ef\u4ee5\u5b58\u5728tasks\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u53ea\u8fdb\u884c\u8d44\u6e90\u63a7\u5236\u3002<\/p>\n<p>\u6211\u4eecmount\u4e00\u4e0b\u770b\u770b\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">$ sudo mount -t cgroup -o __DEVEL__sane_behavior cgroup .\/cgroup\r\n\r\n$ ls .\/cgroup\r\ncgroup.controllers  cgroup.procs  cgroup.sane_behavior  cgroup.subtree_control \r\n\r\n$ cat .\/cgroup\/cgroup.controllers\r\ncpuset cpu cpuacct memory devices freezer net_cls blkio perf_event net_prio hugetlb<\/pre>\n<p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u56db\u4e2a\u6587\u4ef6\uff0c\u7136\u540e\uff0c\u4f60\u5728\u8fd9\u91ccmkdir\u4e00\u4e2a\u5b50\u76ee\u5f55\uff0c\u91cc\u9762\u4e5f\u4f1a\u6709\u8fd9\u56db\u4e2a\u6587\u4ef6\u3002<strong>\u4e0a\u7ea7\u7684cgroup.subtree_control\u63a7\u5236\u4e0b\u7ea7\u7684cgroup.controllers\u3002<\/strong><\/p>\n<p>\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u5047\u8bbe\u6211\u4eec\u6709\u4ee5\u4e0b\u7684\u76ee\u5f55\u7ed3\u6784\uff0cb\u4ee3\u8868blkio\uff0cm\u4ee3\u7801memory\uff0c\u5176\u4e2d\uff0cA\u662froot\uff0c\u5305\u62ec\u6240\u6709\u7684\u5b50\u7cfb\u7edf\uff08\uff09\u3002<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">\r\n# A(b,m) - B(b,m) - C (b)\r\n#               \\ - D (b) - E\r\n\r\n# \u4e0b\u9762\u7684\u547d\u4ee4\u4e2d\uff0c +\u8868\u793aenable\uff0c -\u8868\u793adisable\r\n\r\n# \u5728B\u4e0a\u7684enable blkio\r\n# echo +blkio &gt; A\/cgroup.subtree_control\r\n\r\n# \u5728C\u548cD\u4e0aenable blkio \r\n# echo +blkio &gt; A\/B\/cgroup.subtree_control\r\n\r\n# \u5728B\u4e0aenable memory  \r\n# echo +memory &gt; A\/cgroup.subtree_control<\/pre>\n<p>\u5728\u4e0a\u8ff0\u7684\u7ed3\u6784\u4e2d\uff0c<\/p>\n<ul>\n<li>cgroup\u53ea\u6709\u4e0a\u7ebf\u63a7\u5236\u4e0b\u7ea7\uff0c\u65e0\u6cd5\u4f20\u9012\u5230\u4e0b\u4e0b\u7ea7\u3002\u6240\u4ee5\uff0cC\u548cD\u4e2d\u6ca1\u6709memory\u7684\u9650\u5236\uff0cE\u4e2d\u6ca1\u6709blkio\u548cmemory\u7684\u9650\u5236\u3002\u800c\u672c\u5c42\u7684cgroup.controllers\u6587\u4ef6\u662f\u4e2a\u53ea\u8bfb\u7684\uff0c\u5176\u4e2d\u7684\u5185\u5bb9\u5c31\u770b\u4e0a\u7ea7\u7684subtree_control\u91cc\u6709\u4ec0\u4e48\u4e86\u3002<\/li>\n<li><strong>\u4efb\u4f55\u88ab\u914d\u7f6e\u8fc7subtree_control\u7684\u76ee\u5f55\u90fd\u4e0d\u80fd\u7ed1\u5b9a\u8fdb\u7a0b\uff0c\u6839\u7ed3\u70b9\u9664\u5916<\/strong>\u3002\u6240\u4ee5\uff0cA,C,D,E\u53ef\u4ee5\u7ed1\u4e0a\u8fdb\u7a0b\uff0c\u4f46\u662fB\u4e0d\u884c\u3002<\/li>\n<\/ul>\n<p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c<strong>\u8fd9\u79cd\u65b9\u5f0f\u5e72\u51c0\u7684\u533a\u5206\u5f00\u4e86\u4e24\u4e2a\u4e8b\uff0c\u4e00\u4e2a\u662f\u8fdb\u7a0b\u7684\u5206\u7ec4\uff0c\u4e00\u4e2a\u662f\u5bf9\u5206\u7ec4\u7684\u8d44\u6e90\u63a7\u5236<\/strong>\uff08\u4ee5\u524d\u8fd9\u4e24\u4e2a\u4e8b\u5b8c\u5168\u6df7\u5728\u4e00\u8d77\uff09\uff0c\u5728\u76ee\u5f55\u7ee7\u627f\u4e0a\u589e\u52a0\u4e86\u4e9b\u9650\u5236\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e00\u4e9b\u6a21\u68f1\u4e24\u53ef\u7684\u60c5\u51b5\u3002<\/p>\n<p>\u5f53\u7136\uff0c\u8fd9\u4e2a\u4e8b\u8fd8\u5728\u6f14\u5316\u4e2d\uff0ccgroup\u7684\u8fd9\u4e9b\u95ee\u9898\u8fd9\u4e2a\u4e8b\u76ee\u524d\u7531cgroup\u7684\u5410\u69fd\u4ebaTejun Heo\u548c\u534e\u4e3a\u7684Li Zefan\u540c\u5b66\u8d1f\u8d23\u89e3\u51b3\u4e2d\u3002\u603b\u4e4b\uff0c\u8fd9\u662f\u4e00\u4e2a\u7cfb\u7edf\u7ba1\u7406\u4e0a\u7684\u95ee\u9898\uff0c\u800c\u4e14\u6539\u53d8\u4f1a\u5f71\u54cd\u5f88\u591a\u4e1c\u897f\uff0c\u4f46\u4e00\u65e6\u65b9\u6848\u786e\u5b9a\uff0c\u8001\u7684cgroup\u65b9\u5f0f\u5c06\u4e00\u53bb\u4e0d\u590d\u8fd4\u3002<\/p>\n<h4><span class=\"ez-toc-section\" id=\"%E5%8F%82%E8%80%83\"><\/span>\u53c2\u8003<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<ul>\n<li><a href=\"https:\/\/www.kernel.org\/doc\/Documentation\/cgroups\/\" target=\"_blank\">Linux Kernel Cgroup Documents<\/a><\/li>\n<li><a href=\"https:\/\/access.redhat.com\/documentation\/zh-CN\/Red_Hat_Enterprise_Linux\/6\/html-single\/Resource_Management_Guide\/index.html\" target=\"_blank\">Reahat Resource Management Guide<\/a><\/li>\n<li><a href=\"https:\/\/lwn.net\/Articles\/484251\/\" target=\"_blank\">Fixing control groups<\/a><\/li>\n<li><a href=\"http:\/\/lwn.net\/Articles\/601840\/\" target=\"_blank\">The unified control group hierarchy in 3.16<\/a><\/li>\n<li><a href=\"http:\/\/events.linuxfoundation.org\/sites\/events\/files\/slides\/2014-KLF.pdf\" target=\"_blank\">Cgroup v2(PDF)<\/a><\/li>\n<\/ul>\n<p>\uff08\u5168\u6587\u5b8c\uff09<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>\u524d\u9762\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86Linux Namespace\uff0c\u4f46\u662fNamespace\u89e3\u51b3\u7684\u95ee\u9898\u4e3b\u8981\u662f\u73af\u5883\u9694\u79bb\u7684\u95ee\u9898\uff0c\u8fd9\u53ea\u662f\u865a\u62df\u5316\u4e2d\u6700\u6700\u57fa\u7840\u7684\u4e00\u6b65\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u89e3\u51b3\u5bf9\u8ba1\u7b97\u673a\u8d44\u6e90\u4f7f&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/17049.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[20,18,10],"tags":[784,781,37],"series":[],"aioseo_notices":[],"views":124767,"post_thumbnail_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","content_first_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","post_medium_image_300":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","post_thumbnail_image_624":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","post_frist_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","post_medium_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","post_large_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","post_full_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","post_all_images":[{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2015\/04\/filter.png","id":"image0"}],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":87,"category_name":"Unix\/Linux","post_date":"2015-04-17","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[{"ID":"22320","post_title":"eBPF \u4ecb\u7ecd"}],"pageviews":124768,"pageviews_wl":96980,"ratings_average":4,"ratings_total":287,"ratings_users":67,"next_post_id":17061,"next_post_title":"Docker\u57fa\u7840\u6280\u672f\uff1aAUFS","previous_post_id":17010,"previous_post_title":"Docker\u57fa\u7840\u6280\u672f\uff1aLinux Namespace\uff08\u4e0a\uff09"}