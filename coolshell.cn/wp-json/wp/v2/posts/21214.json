{"id":21214,"date":"2020-12-26T16:57:48","date_gmt":"2020-12-26T08:57:48","guid":{"rendered":"https:\/\/coolshell.cn\/?p=21214"},"modified":"2020-12-28T10:57:06","modified_gmt":"2020-12-28T02:57:06","slug":"go%e7%bc%96%e7%a8%8b%e6%a8%a1%e5%bc%8f%ef%bc%9a%e5%a7%94%e6%89%98%e5%92%8c%e5%8f%8d%e8%bd%ac%e6%8e%a7%e5%88%b6","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/21214.html","title":{"rendered":"Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u59d4\u6258\u548c\u53cd\u8f6c\u63a7\u5236"},"content":{"rendered":"<figure id=\"attachment_21256\" aria-describedby=\"caption-attachment-21256\" style=\"width: 300px\" class=\"wp-caption alignright\"><img decoding=\"async\" loading=\"lazy\" class=\"wp-image-21256 size-medium\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png\" alt=\"\" width=\"300\" height=\"298\" srcset=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png 300w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-1024x1017.png 1024w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-150x150.png 150w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-768x762.png 768w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-1536x1525.png 1536w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-2048x2033.png 2048w, https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-272x270.png 272w\" sizes=\"(max-width: 300px) 100vw, 300px\" \/><figcaption id=\"caption-attachment-21256\" class=\"wp-caption-text\">\u56fe\u7247\u6765\u6e90\uff1a<a href=\"https:\/\/gophersource.com\/\" target=\"_blank\" rel=\"noopener\">GopherSource<\/a><\/figcaption><\/figure>\n<p>\u53cd\u8f6c\u63a7\u5236<a title=\"IoC - Inversion of Control\" href=\"https:\/\/en.wikipedia.org\/wiki\/Inversion_of_control\" target=\"_blank\" rel=\"noopener\">IoC &#8211; Inversion of Control<\/a> \u662f\u4e00\u79cd\u8f6f\u4ef6\u8bbe\u8ba1\u7684\u65b9\u6cd5\uff0c\u5176\u4e3b\u8981\u7684\u601d\u60f3\u662f\u628a\u63a7\u5236\u903b\u8f91\u4e0e\u4e1a\u52a1\u903b\u8f91\u5206\u4eab\uff0c\u4e0d\u8981\u5728\u4e1a\u52a1\u903b\u8f91\u91cc\u5199\u63a7\u5236\u903b\u8f91\uff0c\u8fd9\u6837\u4f1a\u8ba9\u63a7\u5236\u903b\u8f91\u4f9d\u8d56\u4e8e\u4e1a\u52a1\u903b\u8f91\uff0c\u800c\u662f\u53cd\u8fc7\u6765\uff0c\u8ba9\u4e1a\u52a1\u903b\u8f91\u4f9d\u8d56\u63a7\u5236\u903b\u8f91\u3002\u5728\u300a<a href=\"https:\/\/coolshell.cn\/articles\/9949.html\" target=\"_blank\" rel=\"noopener\">IoC\/DIP\u5176\u5b9e\u662f\u4e00\u79cd\u7ba1\u7406\u601d\u60f3<\/a>\u300b\u4e2d\u7684\u90a3\u4e2a\u5f00\u5173\u548c\u7535\u706f\u7684\u793a\u4f8b\u4e00\u6837\uff0c\u5f00\u5173\u662f\u63a7\u5236\u903b\u8f91\uff0c\u7535\u5668\u662f\u4e1a\u52a1\u903b\u8f91\uff0c\u4e0d\u8981\u5728\u7535\u5668\u4e2d\u5b9e\u73b0\u5f00\u5173\uff0c\u800c\u662f\u628a\u5f00\u5173\u62bd\u8c61\u6210\u4e00\u79cd\u534f\u8bae\uff0c\u8ba9\u7535\u5668\u90fd\u4f9d\u8d56\u4e4b\u3002\u8fd9\u6837\u7684\u7f16\u7a0b\u65b9\u5f0f\u53ef\u4ee5\u6709\u6548\u7684\u964d\u4f4e\u7a0b\u5e8f\u590d\u6742\u5ea6\uff0c\u5e76\u63d0\u5347\u4ee3\u7801\u91cd\u7528\u3002<\/p>\n<section class=\"post-series\"><h3 class=\"post-series-title\">\u672c\u6587\u662f\u5168\u7cfb\u5217\u4e2d\u7b2c4 \/ 10\u7bc7\uff1a<a href=\"https:\/\/coolshell.cn\/articles\/series\/go%e7%bc%96%e7%a8%8b%e6%a8%a1%e5%bc%8f\">Go\u7f16\u7a0b\u6a21\u5f0f<\/a><\/h3><ul class=\"post-series-list\"><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21128.html\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u5207\u7247\uff0c\u63a5\u53e3\uff0c\u65f6\u95f4\u548c\u6027\u80fd<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21140.html\">Go \u7f16\u7a0b\u6a21\u5f0f\uff1a\u9519\u8bef\u5904\u7406<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21146.html\">Go \u7f16\u7a0b\u6a21\u5f0f\uff1aFunctional Options<\/a><\/span><\/li><li class=\"post-series-item-current post-series-item\"><span class=\"post-series-item-title\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u59d4\u6258\u548c\u53cd\u8f6c\u63a7\u5236<\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21164.html\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1aMap-Reduce<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21179.html\">Go \u7f16\u7a0b\u6a21\u5f0f\uff1aGo Generation<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/17929.html\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1a\u4fee\u9970\u5668<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21228.html\">Go\u7f16\u7a0b\u6a21\u5f0f\uff1aPipeline<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21263.html\">Go \u7f16\u7a0b\u6a21\u5f0f\uff1ak8s Visitor \u6a21\u5f0f<\/a><\/span><\/li><li class=\"post-series-item\"><span class=\"post-series-item-title\"><a href=\"https:\/\/coolshell.cn\/articles\/21615.html\">Go\u7f16\u7a0b\u6a21\u5f0f \uff1a \u6cdb\u578b\u7f16\u7a0b<\/a><\/span><\/li><\/ul><nav class=\"post-series-nav\"><span class=\"post-series-nav-prev\">&laquo; <a href=\"https:\/\/coolshell.cn\/articles\/21146.html\" rel=\"prev\" title=\"Go \u7f16\u7a0b\u6a21\u5f0f\uff1aFunctional Options\">\u4e0a\u4e00\u7bc7\u6587\u7ae0<\/a><\/span><span class=\"post-series-nav-next\"><a href=\"https:\/\/coolshell.cn\/articles\/21164.html\" rel=\"next\" title=\"Go\u7f16\u7a0b\u6a21\u5f0f\uff1aMap-Reduce\">\u4e0b\u4e00\u7bc7\u6587\u7ae0<\/a> &raquo;<\/span><\/nav><\/section>\n<p>\u9762\u5411\u5bf9\u8c61\u7684\u8bbe\u8ba1\u6a21\u5f0f\u8fd9\u91cc\u4e0d\u63d0\u4e86\uff0c\u6211\u4eec\u6765\u770b\u770bGo\u8bed\u8a00\u4f7f\u7528Embed\u7ed3\u6784\u7684\u4e00\u4e2a\u793a\u4f8b\u3002<\/p>\n<p><!--more--><\/p>\n<div id=\"ez-toc-container\" class=\"ez-toc-v2_0_48 counter-hierarchy ez-toc-counter ez-toc-grey ez-toc-container-direction\">\n<div class=\"ez-toc-title-container\">\n<p class=\"ez-toc-title\">\u76ee\u5f55<\/p>\n<span class=\"ez-toc-title-toggle\"><\/span><\/div>\n<nav><ul class='ez-toc-list ez-toc-list-level-1 ' ><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-1\" href=\"https:\/\/coolshell.cn\/articles\/21214.html\/#%E5%B5%8C%E5%85%A5%E5%92%8C%E5%A7%94%E6%89%98\" title=\"\u5d4c\u5165\u548c\u59d4\u6258\">\u5d4c\u5165\u548c\u59d4\u6258<\/a><ul class='ez-toc-list-level-5'><li class='ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-2\" href=\"https:\/\/coolshell.cn\/articles\/21214.html\/#%E7%BB%93%E6%9E%84%E4%BD%93%E5%B5%8C%E5%85%A5\" title=\"\u7ed3\u6784\u4f53\u5d4c\u5165\">\u7ed3\u6784\u4f53\u5d4c\u5165<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-3\" href=\"https:\/\/coolshell.cn\/articles\/21214.html\/#%E6%96%B9%E6%B3%95%E9%87%8D%E5%86%99\" title=\"\u65b9\u6cd5\u91cd\u5199\">\u65b9\u6cd5\u91cd\u5199<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-4\" href=\"https:\/\/coolshell.cn\/articles\/21214.html\/#%E5%B5%8C%E5%85%A5%E7%BB%93%E6%9E%84%E5%A4%9A%E6%80%81\" title=\"\u5d4c\u5165\u7ed3\u6784\u591a\u6001\">\u5d4c\u5165\u7ed3\u6784\u591a\u6001<\/a><\/li><\/ul><\/li><li class='ez-toc-page-1 ez-toc-heading-level-4'><a class=\"ez-toc-link ez-toc-heading-5\" href=\"https:\/\/coolshell.cn\/articles\/21214.html\/#%E5%8F%8D%E8%BD%AC%E6%8E%A7%E5%88%B6\" title=\"\u53cd\u8f6c\u63a7\u5236\">\u53cd\u8f6c\u63a7\u5236<\/a><ul class='ez-toc-list-level-5'><li class='ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-6\" href=\"https:\/\/coolshell.cn\/articles\/21214.html\/#%E5%AE%9E%E7%8E%B0Undo%E5%8A%9F%E8%83%BD\" title=\"\u5b9e\u73b0Undo\u529f\u80fd\">\u5b9e\u73b0Undo\u529f\u80fd<\/a><\/li><li class='ez-toc-page-1 ez-toc-heading-level-5'><a class=\"ez-toc-link ez-toc-heading-7\" href=\"https:\/\/coolshell.cn\/articles\/21214.html\/#%E5%8F%8D%E8%BD%AC%E4%BE%9D%E8%B5%96\" title=\"\u53cd\u8f6c\u4f9d\u8d56\">\u53cd\u8f6c\u4f9d\u8d56<\/a><\/li><\/ul><\/li><\/ul><\/nav><\/div>\n<h4><span class=\"ez-toc-section\" id=\"%E5%B5%8C%E5%85%A5%E5%92%8C%E5%A7%94%E6%89%98\"><\/span>\u5d4c\u5165\u548c\u59d4\u6258<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<h5><span class=\"ez-toc-section\" id=\"%E7%BB%93%E6%9E%84%E4%BD%93%E5%B5%8C%E5%85%A5\"><\/span>\u7ed3\u6784\u4f53\u5d4c\u5165<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u5728Go\u8bed\u8a00\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u628a\u4e00\u4e2a\u7ed3\u6784\u4f53\u7ed9\u5d4c\u5230\u53e6\u4e00\u4e2a\u7ed3\u6784\u4f53\u4e2d\u3002\u5982\u4e0b\u6240\u793a\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">type Widget struct {\n    X, Y int\n}\ntype Label struct {\n    Widget\u00a0 \u00a0 \u00a0 \u00a0 \/\/ Embedding (delegation)\n    Text \u00a0 string \/\/ Aggregation\n}<\/pre>\n<p>\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u628a <code>Widget<\/code>\u5d4c\u5165\u5230\u4e86 <code>Label<\/code> \u4e2d\uff0c\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u4f7f\u7528\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">label := Label{Widget{10, 10}, \"State:\"}\n\nlabel.X = 11\nlabel.Y = 12<\/pre>\n<p>\u5982\u679c\u5728 <code>Label<\/code> \u7ed3\u6784\u4f53\u91cc\u51fa\u73b0\u4e86\u91cd\u540d\uff0c\u5c31\u9700\u8981\u89e3\u51b3\u91cd\u540d\uff0c\u4f8b\u5982\uff0c\u5982\u679c \u6210\u5458 <code>X<\/code> \u91cd\u540d\uff0c\u7528 <code>label.X<\/code>\u8868\u660e \u662f\u81ea\u5df1\u7684<code>X<\/code> \uff0c\u7528\u00a0\u00a0<code>label.Wedget.X<\/code> \u8868\u793a\u5d4c\u5165\u8fc7\u6765\u7684\u3002<\/p>\n<p>\u6709\u4e86\u8fd9\u6837\u7684\u5d4c\u5165\uff0c\u5c31\u53ef\u4ee5\u50cfUI\u7ec4\u4ef6\u4e00\u6837\u7684\u5728\u7ed3\u6784\u6784\u7684\u8bbe\u8ba1\u4e0a\u8fdb\u884c\u5c42\u5c42\u5206\u89e3\u3002\u6bd4\u5982\uff0c\u6211\u53ef\u4ee5\u65b0\u51fa\u6765\u4e24\u4e2a\u7ed3\u6784\u4f53 <code>Button<\/code> \u548c <code>ListBox<\/code>\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">type Button struct {\n\u00a0 \u00a0 Label \/\/ Embedding (delegation)\n}\n\ntype ListBox struct {\n\u00a0 \u00a0 Widget\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \/\/ Embedding (delegation)\n\u00a0 \u00a0 Texts\u00a0 []string \/\/ Aggregation\n\u00a0 \u00a0 Index\u00a0 int\u00a0 \u00a0 \u00a0 \/\/ Aggregation\n}<\/pre>\n<h5><span class=\"ez-toc-section\" id=\"%E6%96%B9%E6%B3%95%E9%87%8D%E5%86%99\"><\/span>\u65b9\u6cd5\u91cd\u5199<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u7136\u540e\uff0c\u6211\u4eec\u9700\u8981\u4e24\u4e2a\u63a5\u53e3 <code>Painter<\/code> \u7528\u4e8e\u628a\u7ec4\u4ef6\u753b\u51fa\u6765\uff0c<code>Clicker<\/code> \u7528\u4e8e\u8868\u660e\u70b9\u51fb\u4e8b\u4ef6\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">type Painter interface {\n\u00a0 \u00a0 Paint()\n}\n\u00a0\ntype Clicker interface {\n\u00a0 \u00a0 Click()\n}<\/pre>\n<p>\u5f53\u7136\uff0c<\/p>\n<ul>\n<li>\u5bf9\u4e8e <code>Lable<\/code> \u6765\u8bf4\uff0c\u53ea\u6709 <code>Painter<\/code> \uff0c\u6ca1\u6709<code>Clicker<\/code><\/li>\n<li>\u5bf9\u4e8e <code>Button<\/code> \u548c <code>ListBox<\/code>\u6765\u8bf4\uff0c<code>Painter<\/code>\u00a0\u548c<code>Clicker<\/code>\u90fd\u6709\u3002<\/li>\n<\/ul>\n<p>\u4e0b\u9762\u662f\u4e00\u4e9b\u5b9e\u73b0\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">func (label Label) Paint() {\n  fmt.Printf(\"%p:Label.Paint(%q)\\n\", &amp;label, label.Text)\n}\n\n\/\/\u56e0\u4e3a\u8fd9\u4e2a\u63a5\u53e3\u53ef\u4ee5\u901a\u8fc7 Label \u7684\u5d4c\u5165\u5e26\u5230\u65b0\u7684\u7ed3\u6784\u4f53\uff0c\n\/\/\u6240\u4ee5\uff0c\u53ef\u4ee5\u5728 Button \u4e2d\u53ef\u4ee5\u91cd\u8f7d\u8fd9\u4e2a\u63a5\u53e3\u65b9\u6cd5\u4ee5\nfunc (button Button) Paint() { \/\/ Override\n\u00a0 \u00a0 fmt.Printf(\"Button.Paint(%s)\\n\", button.Text)\n}\nfunc (button Button) Click() {\n\u00a0 \u00a0 fmt.Printf(\"Button.Click(%s)\\n\", button.Text)\n}\n\n\nfunc (listBox ListBox) Paint() {\n\u00a0 \u00a0 fmt.Printf(\"ListBox.Paint(%q)\\n\", listBox.Texts)\n}\nfunc (listBox ListBox) Click() {\n\u00a0 \u00a0 fmt.Printf(\"ListBox.Click(%q)\\n\", listBox.Texts)\n}<\/pre>\n<p>\u8fd9\u91cc\uff0c\u9700\u8981\u91cd\u70b9\u63d0\u793a\u4e00\u4e0b\uff0c<strong><code>Button.Paint()<\/code> \u63a5\u53e3\u53ef\u4ee5\u901a\u8fc7 Label \u7684\u5d4c\u5165\u5e26\u5230\u65b0\u7684\u7ed3\u6784\u4f53\uff0c\u5982\u679c <code>Button.Paint()<\/code> \u4e0d\u5b9e\u73b0\u7684\u8bdd\uff0c\u4f1a\u8c03\u7528 <code>Label.Paint()<\/code> \uff0c\u6240\u4ee5\uff0c\u5728 <code>Button<\/code> \u4e2d\u58f0\u660e <code>Paint()<\/code> \u65b9\u6cd5\uff0c\u76f8\u5f53\u4e8eOverride<\/strong>\u3002<\/p>\n<h5><span class=\"ez-toc-section\" id=\"%E5%B5%8C%E5%85%A5%E7%BB%93%E6%9E%84%E5%A4%9A%E6%80%81\"><\/span>\u5d4c\u5165\u7ed3\u6784\u591a\u6001<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u901a\u8fc7\u4e0b\u9762\u7684\u7a0b\u5e8f\u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4e2a\u591a\u6001\u662f\u600e\u4e48\u6267\u884c\u7684\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">button1 := Button{Label{Widget{10, 70}, \"OK\"}}\nbutton2 := NewButton(50, 70, \"Cancel\")\nlistBox := ListBox{Widget{10, 40},\u00a0\n\u00a0 \u00a0 []string{\"AL\", \"AK\", \"AZ\", \"AR\"}, 0}\n\nfor _, painter := range []Painter{label, listBox, button1, button2} {\n    painter.Paint()\n}\n\u00a0\nfor _, widget := range []interface{}{label, listBox, button1, button2} {\n  widget.(Painter).Paint()\n  if clicker, ok := widget.(Clicker); ok {\n    clicker.Click()\n  }\n  fmt.Println() \/\/ print a empty line \n}<\/pre>\n<p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u63a5\u53e3\u6765\u591a\u6001\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 \u6cdb\u578b\u7684 <code>interface{}<\/code> \u6765\u591a\u6001\uff0c\u4f46\u662f\u9700\u8981\u6709\u4e00\u4e2a\u7c7b\u578b\u8f6c\u6362\u3002<\/p>\n<h4><span class=\"ez-toc-section\" id=\"%E5%8F%8D%E8%BD%AC%E6%8E%A7%E5%88%B6\"><\/span>\u53cd\u8f6c\u63a7\u5236<span class=\"ez-toc-section-end\"><\/span><\/h4>\n<p>\u6211\u4eec\u518d\u6765\u770b\u4e00\u4e2a\u793a\u4f8b\uff0c\u6211\u4eec\u6709\u4e00\u4e2a\u5b58\u653e\u6574\u6570\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5982\u4e0b\u6240\u793a\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">type IntSet struct {\n\u00a0 \u00a0 data map[int]bool\n}\nfunc NewIntSet() IntSet {\n\u00a0 \u00a0 return IntSet{make(map[int]bool)}\n}\nfunc (set *IntSet) Add(x int) {\n\u00a0 \u00a0 set.data[x] = true\n}\nfunc (set *IntSet) Delete(x int) {\n\u00a0 \u00a0 delete(set.data, x)\n}\nfunc (set *IntSet) Contains(x int) bool {\n\u00a0 \u00a0 return set.data[x]\n}<\/pre>\n<p>\u5176\u4e2d\u5b9e\u73b0\u4e86 <code>Add()<\/code> \u3001<code>Delete()<\/code> \u548c <code>Contains()<\/code> \u4e09\u4e2a\u64cd\u4f5c\uff0c\u524d\u4e24\u4e2a\u662f\u5199\u64cd\u4f5c\uff0c\u540e\u4e00\u4e2a\u662f\u8bfb\u64cd\u4f5c\u3002<\/p>\n<h5><span class=\"ez-toc-section\" id=\"%E5%AE%9E%E7%8E%B0Undo%E5%8A%9F%E8%83%BD\"><\/span>\u5b9e\u73b0Undo\u529f\u80fd<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u73b0\u5728\u6211\u4eec\u60f3\u5b9e\u73b0\u4e00\u4e2a Undo \u7684\u529f\u80fd\u3002\u6211\u4eec\u53ef\u4ee5\u628a\u628a <code>IntSet<\/code> \u518d\u5305\u88c5\u4e00\u4e0b\u53d8\u6210 <code>UndoableIntSet<\/code> \u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">type UndoableIntSet struct { \/\/ Poor style\n\u00a0 \u00a0 IntSet\u00a0 \u00a0 \/\/ Embedding (delegation)\n\u00a0 \u00a0 functions []func()\n}\n\u00a0\nfunc NewUndoableIntSet() UndoableIntSet {\n\u00a0 \u00a0 return UndoableIntSet{NewIntSet(), nil}\n}\n\u00a0\n\nfunc (set *UndoableIntSet) Add(x int) { \/\/ Override\n\u00a0 \u00a0 if !set.Contains(x) {\n\u00a0 \u00a0 \u00a0 \u00a0 set.data[x] = true\n\u00a0 \u00a0 \u00a0 \u00a0 set.functions = append(set.functions, func() { set.Delete(x) })\n\u00a0 \u00a0 } else {\n\u00a0 \u00a0 \u00a0 \u00a0 set.functions = append(set.functions, nil)\n\u00a0 \u00a0 }\n}\n\n\nfunc (set *UndoableIntSet) Delete(x int) { \/\/ Override\n\u00a0 \u00a0 if set.Contains(x) {\n\u00a0 \u00a0 \u00a0 \u00a0 delete(set.data, x)\n\u00a0 \u00a0 \u00a0 \u00a0 set.functions = append(set.functions, func() { set.Add(x) })\n\u00a0 \u00a0 } else {\n\u00a0 \u00a0 \u00a0 \u00a0 set.functions = append(set.functions, nil)\n\u00a0 \u00a0 }\n}\n\nfunc (set *UndoableIntSet) Undo() error {\n\u00a0 \u00a0 if len(set.functions) == 0 {\n\u00a0 \u00a0 \u00a0 \u00a0 return errors.New(\"No functions to undo\")\n\u00a0 \u00a0 }\n\u00a0 \u00a0 index := len(set.functions) - 1\n\u00a0 \u00a0 if function := set.functions[index]; function != nil {\n\u00a0 \u00a0 \u00a0 \u00a0 function()\n\u00a0 \u00a0 \u00a0 \u00a0 set.functions[index] = nil \/\/ For garbage collection\n\u00a0 \u00a0 }\n\u00a0 \u00a0 set.functions = set.functions[:index]\n\u00a0 \u00a0 return nil\n}<\/pre>\n<p>\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230<\/p>\n<ul>\n<li>\u6211\u4eec\u5728 <code>UndoableIntSet<\/code> \u4e2d\u5d4c\u5165\u4e86<code>IntSet<\/code> \uff0c\u7136\u540eOverride\u4e86 \u5b83\u7684 <code>Add()<\/code>\u548c <code>Delete()<\/code> \u65b9\u6cd5\u3002<\/li>\n<li><code>Contains()<\/code> \u65b9\u6cd5\u6ca1\u6709Override\uff0c\u6240\u4ee5\uff0c\u4f1a\u88ab\u5e26\u5230 <code>UndoableInSet<\/code> \u4e2d\u6765\u4e86\u3002<\/li>\n<li>\u5728Override\u7684\u00a0<code>Add()<\/code>\u4e2d\uff0c\u8bb0\u5f55 <code>Delete<\/code> \u64cd\u4f5c<\/li>\n<li>\u5728Override\u7684 <code>Delete()<\/code> \u4e2d\uff0c\u8bb0\u5f55 <code>Add<\/code>\u00a0\u64cd\u4f5c<\/li>\n<li>\u5728\u65b0\u52a0\u5165 <code>Undo()<\/code> \u4e2d\u8fdb\u884cUndo\u64cd\u4f5c\u3002<\/li>\n<\/ul>\n<p>\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u4e3a\u5df2\u6709\u7684\u4ee3\u7801\u6269\u5c55\u65b0\u7684\u529f\u80fd\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\uff0c\u8fd9\u6837\uff0c\u53ef\u4ee5\u5728\u91cd\u7528\u539f\u6709\u4ee3\u7801\u529f\u80fd\u548c\u91cd\u65b0\u65b0\u7684\u529f\u80fd\u4e2d\u8fbe\u5230\u4e00\u4e2a\u5e73\u8861\u3002\u4f46\u662f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u6700\u5927\u7684\u95ee\u9898\u662f\uff0cUndo\u64cd\u4f5c\u5176\u5b9e\u662f\u4e00\u79cd\u63a7\u5236\u903b\u8f91\uff0c\u5e76\u4e0d\u662f\u4e1a\u52a1\u903b\u8f91\uff0c\u6240\u4ee5\uff0c\u5728\u590d\u7528 Undo\u8fd9\u4e2a\u529f\u80fd\u4e0a\u662f\u6709\u95ee\u9898\u3002\u56e0\u4e3a\u5176\u4e2d\u52a0\u5165\u4e86\u5927\u91cf\u8ddf <code>IntSet<\/code> \u76f8\u5173\u7684\u4e1a\u52a1\u903b\u8f91\u3002<\/p>\n<h5><span class=\"ez-toc-section\" id=\"%E5%8F%8D%E8%BD%AC%E4%BE%9D%E8%B5%96\"><\/span>\u53cd\u8f6c\u4f9d\u8d56<span class=\"ez-toc-section-end\"><\/span><\/h5>\n<p>\u73b0\u5728\u6211\u4eec\u6765\u770b\u53e6\u4e00\u79cd\u65b9\u6cd5\uff1a<\/p>\n<p>\u6211\u4eec\u5148\u58f0\u660e\u4e00\u79cd\u51fd\u6570\u63a5\u53e3\uff0c\u8868\u73b0\u6211\u4eec\u7684Undo\u63a7\u5236\u53ef\u4ee5\u63a5\u53d7\u7684\u51fd\u6570\u7b7e\u540d\u662f\u4ec0\u4e48\u6837\u7684\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">type Undo []func()<\/pre>\n<p>\u6709\u4e86\u4e0a\u9762\u8fd9\u4e2a\u534f\u8bae\u540e\uff0c\u6211\u4eec\u7684Undo\u63a7\u5236\u903b\u8f91\u5c31\u53ef\u4ee5\u5199\u6210\u5982\u4e0b\uff1a<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\">func (undo *Undo) Add(function func()) {\n  *undo = append(*undo, function)\n}\n\nfunc (undo *Undo) Undo() error {\n  functions := *undo\n  if len(functions) == 0 {\n    return errors.New(\"No functions to undo\")\n  }\n  index := len(functions) - 1\n  if function := functions[index]; function != nil {\n    function()\n    functions[index] = nil \/\/ For garbage collection\n  }\n  *undo = functions[:index]\n  return nil\n}<\/pre>\n<p>\u8fd9\u91cc\u4f60\u4e0d\u5fc5\u89c9\u5f97\u5947\u602a\uff0c <code>Undo<\/code> \u672c\u6765\u5c31\u662f\u4e00\u4e2a\u7c7b\u578b\uff0c\u4e0d\u5fc5\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u662f\u4e00\u4e2a\u51fd\u6570\u6570\u7ec4\u4e5f\u6ca1\u4ec0\u4e48\u95ee\u9898\u3002<\/p>\n<p>\u7136\u540e\uff0c\u6211\u4eec\u5728\u6211\u4eec\u7684IntSet\u91cc\u5d4c\u5165 Undo\uff0c\u7136\u540e\uff0c\u518d\u5728 <code>Add()<\/code> \u548c <code>Delete()<\/code> \u91cc\u4f7f\u7528\u4e0a\u9762\u7684\u65b9\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u529f\u80fd\u3002<\/p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"golang\" data-enlighter-highlight=\"3\">type IntSet struct {\n\u00a0 \u00a0 data map[int]bool\n\u00a0 \u00a0 undo Undo\n}\n\u00a0\nfunc NewIntSet() IntSet {\n\u00a0 \u00a0 return IntSet{data: make(map[int]bool)}\n}\n\nfunc (set *IntSet) Undo() error {\n\u00a0 \u00a0 return set.undo.Undo()\n}\n\u00a0\nfunc (set *IntSet) Contains(x int) bool {\n\u00a0 \u00a0 return set.data[x]\n}\n\nfunc (set *IntSet) Add(x int) {\n\u00a0 \u00a0 if !set.Contains(x) {\n\u00a0 \u00a0 \u00a0 \u00a0 set.data[x] = true\n\u00a0 \u00a0 \u00a0 \u00a0 set.undo.Add(func() { set.Delete(x) })\n\u00a0 \u00a0 } else {\n\u00a0 \u00a0 \u00a0 \u00a0 set.undo.Add(nil)\n\u00a0 \u00a0 }\n}\n\u00a0\nfunc (set *IntSet) Delete(x int) {\n\u00a0 \u00a0 if set.Contains(x) {\n\u00a0 \u00a0 \u00a0 \u00a0 delete(set.data, x)\n\u00a0 \u00a0 \u00a0 \u00a0 set.undo.Add(func() { set.Add(x) })\n\u00a0 \u00a0 } else {\n\u00a0 \u00a0 \u00a0 \u00a0 set.undo.Add(nil)\n\u00a0 \u00a0 }\n}<\/pre>\n<p>\u8fd9\u4e2a\u5c31\u662f\u63a7\u5236\u53cd\u8f6c\uff0c\u4e0d\u518d\u7531 \u63a7\u5236\u903b\u8f91 <code>Undo<\/code> \u6765\u4f9d\u8d56\u4e1a\u52a1\u903b\u8f91 <code>IntSet<\/code>\uff0c\u800c\u662f\u7531\u4e1a\u52a1\u903b\u8f91 <code>IntSet<\/code> \u6765\u4f9d\u8d56 <code>Undo<\/code> \u3002\u5176\u4f9d\u8d56\u7684\u662f\u5176\u5b9e\u662f\u4e00\u4e2a\u534f\u8bae\uff0c\u8fd9\u4e2a\u534f\u8bae\u662f\u4e00\u4e2a\u6ca1\u6709\u53c2\u6570\u7684\u51fd\u6570\u6570\u7ec4\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec Undo \u7684\u4ee3\u7801\u5c31\u53ef\u4ee5\u590d\u7528\u4e86\u3002<\/p>\n<p>\uff08\u5168\u6587\u5b8c\uff09<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>\u53cd\u8f6c\u63a7\u5236IoC &#8211; Inversion of Control \u662f\u4e00\u79cd\u8f6f\u4ef6\u8bbe\u8ba1\u7684\u65b9\u6cd5\uff0c\u5176\u4e3b\u8981\u7684\u601d\u60f3\u662f\u628a\u63a7\u5236\u903b\u8f91\u4e0e\u4e1a\u52a1\u903b\u8f91\u5206\u4eab\uff0c\u4e0d\u8981\u5728\u4e1a\u52a1\u903b\u8f91\u91cc\u5199\u63a7\u5236\u903b&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/21214.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[819,23,3],"tags":[238,237,609],"series":[866],"aioseo_notices":[],"views":44714,"post_thumbnail_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png","content_first_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png","post_medium_image_300":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png","post_thumbnail_image_624":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png","post_frist_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png","post_medium_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png","post_large_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png","post_full_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png","post_all_images":[{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2020\/12\/go.pair_-300x298.png","id":"image0"}],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":15,"category_name":"Go \u8bed\u8a00","post_date":"2020-12-26","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[],"pageviews":44715,"pageviews_wl":23109,"ratings_average":4,"ratings_total":156,"ratings_users":38,"next_post_id":21228,"next_post_title":"Go\u7f16\u7a0b\u6a21\u5f0f\uff1aPipeline","previous_post_id":21179,"previous_post_title":"Go \u7f16\u7a0b\u6a21\u5f0f\uff1aGo Generation"}