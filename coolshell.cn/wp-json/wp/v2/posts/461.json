{"id":461,"date":"2009-04-12T18:19:04","date_gmt":"2009-04-12T10:19:04","guid":{"rendered":"http:\/\/coolshell.cn\/?p=461"},"modified":"2009-04-12T21:59:33","modified_gmt":"2009-04-12T13:59:33","slug":"python%e5%a4%84%e7%90%86%e4%b8%ad%e6%96%87%e7%9a%84%e6%97%b6%e5%80%99%e7%9a%84%e4%b8%80%e4%ba%9b%e5%b0%8f%e6%8a%80%e5%b7%a7","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/461.html","title":{"rendered":"Python\u5904\u7406\u4e2d\u6587\u7684\u65f6\u5019\u7684\u4e00\u4e9b\u5c0f\u6280\u5de7"},"content":{"rendered":"<p>\u76f8\u4fe1\u7b2c\u4e00\u6b21\u5904\u7406\u4e2d\u6587\u7684\u670b\u53cb\u4eec\u53ef\u80fd\u90fd\u4f1a\u5bf9\u4e2d\u6587\u7684encoding \u548c\u7a0b\u5e8f\u7684\u62a5\u9519\u5f88\u5934\u75bc\u3002<\/p>\n<p>\u5982\u679c\u4f60\u50cf\u6211\u4e00\u6837\u5e0c\u671b\u80fd\u591f\u628a\u4e8b\u60c5\u5c3d\u5feb\u505a\u597d\u800c\u4e0d\u53bb\u6df1\u7a76\uff0c\u4f60\u53ef\u80fd\u4f1a\u5199\u4e00\u4e9b\u5f02\u5e38\u5904\u7406\u7684\u4ee3\u7801\u628a UnicodeEncodingError\u7cca\u5f04\u8fc7\u53bb\u5148\uff0c\u4f46\u5f53\u4f60\u5f00\u59cb\u6000\u7591\u6709\u591a\u5c11encoding\u51fa\u9519\u7684\u4fe1\u606f\u88ab\u4f60\u4e22\u5f03\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f60\u4f1a\u5f88\u60ca\u5947\u3002\u4e8e\u662f\uff0c\u4f60\u8fd8\u662f\u4f1a\u60f3\u5750\u4e0b\u6765\uff0c\uff08\u6d17\u628a\u8138\uff09\u7136\u540e\u9762\u5bf9\u81ea\u5df1\u5fc5\u987b\u5f04\u61c2\u4ec0\u4e48\u662futf-8\uff0c\u4ec0\u4e48\u662f &#8216;gb2312&#8217;\uff0c \u4ec0\u4e48\u662f &#8216;gbk&#8217; \u548c\u5176\u4e2d\u7684\u732b\u817b\u3002\u6b63\u5982\u6709\u65f6\u5019\u731b\u6495\u5c0f\u4f24\u53e3\u4e0a\u90a6\u8fea\u80f6\u5e03\u7684\u5feb\u611f\u4e00\u6837\uff0c\u6709\u65f6\u5019\u5f53\u4f60\u8ba4\u771f\u9762\u5bf9\u4e00\u4e9b\u4f60\u5e73\u65f6\u4e00\u76f4\u56de\u907f\u7684\u95ee\u9898\u7684\u65f6\u5019\uff08\u5176\u5b9e\u6709\u65f6\u5019\u9700\u8981\u7684\u4e0d\u662f\u52c7\u6c14\uff09\uff0c \u4f60\u53cd\u800c\u4f1a\u89c9\u5f97\u201c\u4e0d\u8fc7\u5982\u6b64\u201d\uff0c\u5e76\u4e14\u80fd\u591f\u4e00\u52b3\u6c38\u9038\u7684\u89e3\u51b3\u95ee\u9898\u3002<\/p>\n<p>\u5173\u4e8ePython\u5904\u7406Unicode\uff0c\u6211\u6240\u80fd\u627e\u5230\u7684\u6700\u8a00\u7b80\u610f\u8d45\u7684\u5165\u95e8\u6559\u7a0b\u662f\uff1a<\/p>\n<h3 class=\"r\"><a class=\"l\" onmousedown=\"return rwt(this,'','','','1','AFQjCNG2KDSlBO51sqZvt1KQ8D2jgaNeSA','&amp;sig2=HRW3IVb7NrhpeTbrPLRDLg')\" href=\"http:\/\/farmdev.com\/talks\/unicode\/\"><em><em>Unicode<\/em> In <em>Python<\/em>, Completely Demystified <\/em>\uff08\u63ed\u79d8Python Unicode\uff09<\/p>\n<p><\/a><\/h3>\n<p>\u7b80\u8981\u7f57\u5217\u4e00\u4e0b\u6700\u91cd\u8981\u6700\u5b9e\u7528\u7684\u70b9\uff1a<\/p>\n<p><!--more--><\/p>\n<p>Solution<\/p>\n<ol>\n<li><strong>Decode early <\/strong>\uff08\u5c3d\u65e9decode, \u5c06\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u8f6c\u5316\u6210 unicode \u518d\u8fdb\u884c\u4e0b\u4e00\u6b65\u5904\u7406)<\/li>\n<li><strong>Unicode everywhere <\/strong>(\u7a0b\u5e8f\u5185\u90e8\u5904\u7406\u90fd\u7528unicode)<\/li>\n<li><strong>Encode late <\/strong>(\u6700\u540eencode\u56de\u6240\u9700\u7684encoding, \u4f8b\u5982\u628a\u6700\u7ec8\u7ed3\u679c\u5199\u8fdb\u7ed3\u679c\u6587\u4ef6)<\/li>\n<\/ol>\n<p><strong>1. Decode early<\/strong><\/p>\n<blockquote><p>Decode to &lt;type &#8216;unicode&#8217;&gt; ASAP<\/p>\n<p>&gt;&gt;&gt; def to_unicode_or_bust(<\/p>\n<p>&#8230;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 obj, encoding=&#8217;utf-8&#8242;):<\/p>\n<p>&#8230;\u00a0\u00a0\u00a0\u00a0 if isinstance(obj, basestring):<\/p>\n<p>&#8230;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 if not isinstance(obj, unicode):<\/p>\n<p>&#8230;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 obj = unicode(obj, encoding)<\/p>\n<p>&#8230;\u00a0\u00a0\u00a0\u00a0 return obj<\/p>\n<p>&#8230;<\/p>\n<p>&gt;&gt;&gt;<\/p>\n<p>detects if object is a string and if so converts to unicode, if not already.<\/p><\/blockquote>\n<p><strong>2. Unicode everywhere<\/strong><\/p>\n<blockquote><p>&gt;&gt;&gt; to_unicode_or_bust(ivan_uni)<\/p>\n<p>u&#8217;Ivan Krsti\\u0107&#8242;<\/p>\n<p>&gt;&gt;&gt; to_unicode_or_bust(ivan_utf8)<\/p>\n<p>u&#8217;Ivan Krsti\\u0107&#8242;<\/p>\n<p>&gt;&gt;&gt; to_unicode_or_bust(1234)<\/p>\n<p>1234<\/p><\/blockquote>\n<p><strong>3. Encode late<\/strong><\/p>\n<blockquote><p>Encode to &lt;type &#8216;str&#8217;&gt; when you write to disk or print<\/p>\n<p>&gt;&gt;&gt; f = open(&#8216;\/tmp\/ivan_out.txt&#8217;,&#8217;w&#8217;)<\/p>\n<p>&gt;&gt;&gt; f.write(ivan_uni.encode(&#8216;utf-8&#8217;))<\/p>\n<p>&gt;&gt;&gt; f.close()<\/p><\/blockquote>\n<p>\u6211\u4ee5\u524d\u4e00\u76f4\u89c9\u5f97unicode\u76f8\u5173\u7684\u5904\u7406\u90fd\u662f\u5f88 dirty \u7684\u5de5\u4f5c\uff0c\u4e00\u822c\u90fd\u4f1a\u4e00\u8fb9\u5c1d\u8bd5\uff0c\u4e00\u8fb9\u7528\u5f02\u5e38\u5904\u7406\u53bb\u8865\u4e01\uff0c\u770b\u5b8c\u4ee5\u4e0a\u8fd9\u4e2a\u6559\u7a0b\u4ee5\u540e\u8c41\u7136\u5f00\u6717\u3002<\/p>\n<p>\u795d\u5927\u5bb6\u4e5f\u80fd\u65e9\u65e5\u7406\u6e05\u5904\u7406\u4e2d\u6587\u7684\u65f6\u5019\u7684\u5934\u7eea\uff0c\u5766\u7136\u76f4\u9762\u201c\u795e\u79d8\u201d\u7684unicode<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>\u76f8\u4fe1\u7b2c\u4e00\u6b21\u5904\u7406\u4e2d\u6587\u7684\u670b\u53cb\u4eec\u53ef\u80fd\u90fd\u4f1a\u5bf9\u4e2d\u6587\u7684encoding \u548c\u7a0b\u5e8f\u7684\u62a5\u9519\u5f88\u5934\u75bc\u3002 \u5982\u679c\u4f60\u50cf\u6211\u4e00\u6837\u5e0c\u671b\u80fd\u591f\u628a\u4e8b\u60c5\u5c3d\u5feb\u505a\u597d\u800c\u4e0d\u53bb\u6df1\u7a76\uff0c\u4f60\u53ef\u80fd\u4f1a\u5199\u4e00\u4e9b\u5f02\u5e38\u5904\u7406\u7684\u4ee3\u7801\u628a&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/461.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[33,3],"tags":[791],"series":[],"aioseo_notices":[],"views":12660,"post_thumbnail_image":"","content_first_image":"","post_medium_image_300":"","post_thumbnail_image_624":"","post_frist_image":"","post_medium_image":"","post_large_image":"","post_full_image":"","post_all_images":[],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":7,"category_name":"Python","post_date":"2009-04-12","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[],"pageviews":12661,"pageviews_wl":4292,"ratings_average":3,"ratings_total":37,"ratings_users":11,"next_post_id":511,"next_post_title":"\u672a\u6765\u4e94\u5e74\u7a0b\u5e8f\u5458\u9700\u8981\u638c\u63e1\u768410\u9879\u6280\u80fd","previous_post_id":444,"previous_post_title":"Python\u811a\u672c\u5982\u4f55\u5bf9\u6587\u4ef6\u901a\u914d\u7b26\u5339\u914d"}