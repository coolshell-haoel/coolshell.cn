{"id":5035,"date":"2011-07-21T12:39:11","date_gmt":"2011-07-21T04:39:11","guid":{"rendered":"http:\/\/coolshell.cn\/?p=5035"},"modified":"2011-07-20T23:27:19","modified_gmt":"2011-07-20T15:27:19","slug":"%e9%9d%a2%e5%90%91%e5%af%b9%e8%b1%a1%e7%9a%84shell%e8%84%9a%e6%9c%ac","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/5035.html","title":{"rendered":"\u9762\u5411\u5bf9\u8c61\u7684Shell\u811a\u672c"},"content":{"rendered":"<p>\u8fd8\u8bb0\u5f97\u4ee5\u524d\u90a3\u4e2a\u7528<a title=\"\u68c0\u67e5\u7d20\u6570\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\" href=\"https:\/\/coolshell.cn\/articles\/2704.html\" target=\"_blank\">\u7b97\u7d20\u6570\u7684\u6b63\u5219\u8868\u8fbe\u5f0f<\/a>\u5417\uff1f\u7f16\u7a0b\u8fd9\u4e2a\u4e16\u754c\u592a\u6709\u8da3\u4e86\uff0c\u603b\u662f\u80fd\u770b\u5230\u4e00\u4e9b\u5373\u522b\u51fa\u5fc3\u88c1\u7684\u4e1c\u897f\u3002\u4f60\u6709\u6ca1\u6709\u60f3\u8fc7\u5728\u5199Shell\u811a\u672c\u7684\u65f6\u5019\u53ef\u4ee5\u628a\u4f60\u7684\u53d8\u91cf\u548c\u51fd\u6570\u653e\u5230\u4e00\u4e2a\u7c7b\u4e2d\uff1f\u4e0d\u8981\u4ee5\u4e3a\u8fd9\u4e0d\u53ef\u80fd\uff0c\u8fd9\u4e0d\uff0c\u6211\u5728<a href=\"http:\/\/lab.madscience.nl\/oo.sh.txt\" target=\"_blank\">\u7f51\u4e0a<\/a>\u53c8\u770b\u5230\u4e86\u4e00\u4e2a\u628aShell\u811a\u672c\u6574\u6210\u9762\u5411\u5bf9\u8c61\u7684\u4e1c\u897f\u3002Shell\u672c\u6765\u662f\u4e0d\u652f\u6301\u7684\uff0c\u9700\u8981\u81ea\u5df1\u505a\u70b9\u4e1c\u897f\uff0c\u80fd\u641e\u51fa\u8fd9\u4e2a\u4e8b\u4e8b\u7684\u4eba\u771f\u7684\u662fhacker\u554a\u3002<\/p>\n<p>\u5f53\u7136\uff0c\u8fd9\u91cc\u5e76\u4e0d\u662f\u771f\u6b63\u7684\u9762\u5411\u5bf9\u8c61\uff0c\u56e0\u4e3a\u5176\u53ea\u662f\u5c01\u88c5\u7f62\u4e86\uff0c\u8fd8\u6ca1\u6709\u652f\u6301\u7ee7\u627f\u548c\u591a\u6001\u3002\u6700\u53d8\u6001\u7684\u662f\u4ed6\u5c45\u7136\u8fd8\u652f\u6301typeid\uff0c\u9760\uff01<\/p>\n<p>\u4e0b\u9762\u8ba9\u6211\u4eec\u770b\u770b\u4ed6\u662f\u600e\u4e48\u6765\u505a\u7684\u3002\u4e0b\u9762\u7684\u811a\u672c\u53ef\u80fd\u4f1a\u6709\u70b9\u8d39\u89e3\u3002\u672c\u60f3\u89e3\u91ca\u4e00\u4e0b\uff0c\u540e\u6765\u60f3\u60f3\uff0c\u8fd8\u662f\u5927\u5bb6\u81ea\u5df1\u4e13\u7814\u4e00\u4e0b\u5427\uff0c\u5176\u5b9e\u770b\u61c2\u4e5f\u4e0d\u96be\uff0c\u7ed9\u5927\u5bb6\u63d0\u51e0\u4e2a\u70b9\u5427\u3002<\/p>\n<ol>\n<li>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4e0b\u9762\u7684\u8fd9\u4e2a\u811a\u672c\u5b9a\u4e49\u4e86class, \u00a0func, var, new \u7b49\u51fd\u6570\uff0c\u5176\u5b9e\u8fd9\u4e9b\u5c31\u662f\u6240\u8c13\u7684\u5173\u952e\u5b57\u3002<\/li>\n<li>class\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4e3b\u8981\u662f\u8bb0\u5f55\u7c7b\u540d\u3002<\/li>\n<li>func\u548cvar\u5b9e\u9645\u4e0a\u662f\u628a\u6210\u5458\u51fd\u6570\u540d\u548c\u6210\u5458\u53d8\u91cf\u8bb0\u6210\u6709\u76f8\u540c\u524d\u7f00\u7684\u5404\u79cd\u53d8\u91cf\u3002<\/li>\n<li>new\u65b9\u6cd5\u4e3b\u8981\u662f\u8bb0\u5f55\u5b9e\u4f8b\u3002\u5927\u5bb6\u91cd\u70b9\u770b\u770bnew\u51fd\u6570\u91cc\u7684\u90a3\u4e2afor\u5faa\u73af\uff0c\u6700\u6838\u5fc3\u7684\u5c31\u5728\u90a3\u91cc\u4e86\u3002<\/li>\n<\/ol>\n<div>\u811a\u672c\u5982\u4e0b\u6240\u793a\uff1a<\/div>\n<div><!--more--><\/div>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">#!\/bin\/bash\r\n\r\n# -------------------------------------------------------------------\r\n# OO support functions\r\n# Kludged by Pim van Riezen &lt;pi@madscience.nl&gt;\r\n# -------------------------------------------------------------------\r\nDEFCLASS=&quot;&quot;\r\nCLASS=&quot;&quot;\r\nTHIS=0\r\n\r\nclass() {\r\n  DEFCLASS=&quot;$1&quot;\r\n  eval CLASS_${DEFCLASS}_VARS=&quot;&quot;\r\n  eval CLASS_${DEFCLASS}_FUNCTIONS=&quot;&quot;\r\n}\r\n\r\nstatic() {\r\n  return 0\r\n}\r\n\r\nfunc() {\r\n  local varname=&quot;CLASS_${DEFCLASS}_FUNCTIONS&quot;\r\n  eval &quot;$varname=\\&quot;\\${$varname}$1 \\&quot;&quot;\r\n}\r\n\r\nvar() {\r\n  local varname=&quot;CLASS_${DEFCLASS}_VARS&quot;\r\n  eval $varname=&quot;\\&quot;\\${$varname}$1 \\&quot;&quot;\r\n}\r\n\r\nloadvar() {\r\n  eval &quot;varlist=\\&quot;\\$CLASS_${CLASS}_VARS\\&quot;&quot;\r\n  for var in $varlist; do\r\n    eval &quot;$var=\\&quot;\\$INSTANCE_${THIS}_$var\\&quot;&quot;\r\n  done\r\n}\r\n\r\nloadfunc() {\r\n  eval &quot;funclist=\\&quot;\\$CLASS_${CLASS}_FUNCTIONS\\&quot;&quot;\r\n  for func in $funclist; do\r\n    eval &quot;${func}() { ${CLASS}::${func} \\&quot;\\$*\\&quot;; return \\$?; }&quot;\r\n  done\r\n}\r\n\r\nsavevar() {\r\n  eval &quot;varlist=\\&quot;\\$CLASS_${CLASS}_VARS\\&quot;&quot;\r\n  for var in $varlist; do\r\n    eval &quot;INSTANCE_${THIS}_$var=\\&quot;\\$$var\\&quot;&quot;\r\n  done\r\n}\r\n\r\ntypeof() {\r\n  eval echo \\$TYPEOF_$1\r\n}\r\n\r\nnew() {\r\n  local\r\n  local cvar=&quot;$2&quot;\r\n  shift\r\n  shift\r\n  local id=$(uuidgen | tr A-F a-f | sed -e &quot;s\/-\/\/g&quot;)\r\n  eval TYPEOF_${id}=$class\r\n  eval $cvar=$id\r\n  local funclist\r\n  eval &quot;funclist=\\&quot;\\$CLASS_${class}_FUNCTIONS\\&quot;&quot;\r\n  for func in $funclist; do\r\n    eval &quot;${cvar}.${func}() {\r\n      local t=\\$THIS; THIS=$id; local c=\\$CLASS; CLASS=$class; loadvar;\r\n      loadfunc; ${class}::${func} \\&quot;\\$*\\&quot;; rt=\\$?; savevar; CLASS=\\$c;\r\n      THIS=\\$t; return $rt;\r\n    }&quot;\r\n\r\n  done\r\n  eval &quot;${cvar}.${class} \\&quot;\\$*\\&quot; || true&quot;\r\n}<\/pre>\n<p>\u4e0b\u9762\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u770b\u4f8b\u7a0b\u5427\u3002<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\"># -------------------------------------------------------------------\r\n# Example code\r\n# -------------------------------------------------------------------\r\n\r\n# class definition\r\nclass Storpel\r\n  func Storpel\r\n  func setName\r\n  func setQuality\r\n  func print\r\n  var name\r\n  var quality\r\n\r\n# class implementation\r\nStorpel::Storpel() {\r\n  setName &quot;$1&quot;\r\n  setQuality &quot;$2&quot;\r\n  if [ -z &quot;$name&quot; ]; then setName &quot;Generic&quot;; fi\r\n  if [ -z &quot;$quality&quot; ]; then setQuality &quot;Normal&quot;; fi\r\n}\r\n\r\nStorpel::setName() { name=&quot;$1&quot;; }\r\nStorpel::setQuality() { quality=&quot;$1&quot;; }\r\nStorpel::print() { echo &quot;$name ($quality)&quot;; }\r\n\r\n# usage\r\nnew Storpel one &quot;Storpilator 1000&quot; Medium\r\nnew Storpel two\r\nnew Storpel three\r\n\r\ntwo.setName &quot;Storpilator 2000&quot;\r\ntwo.setQuality &quot;Strong&quot;\r\n\r\none.print\r\ntwo.print\r\nthree.print\r\n\r\necho &quot;&quot;\r\n\r\necho &quot;one: $one ($(typeof $one))&quot;\r\necho &quot;two: $two ($(typeof $two))&quot;\r\necho &quot;three: $three ($(typeof $two))&quot;<\/pre>\n<p>&nbsp;<\/p>\n<p>\uff08\u5168\u6587\u5b8c\uff09<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>\u8fd8\u8bb0\u5f97\u4ee5\u524d\u90a3\u4e2a\u7528\u7b97\u7d20\u6570\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5417\uff1f\u7f16\u7a0b\u8fd9\u4e2a\u4e16\u754c\u592a\u6709\u8da3\u4e86\uff0c\u603b\u662f\u80fd\u770b\u5230\u4e00\u4e9b\u5373\u522b\u51fa\u5fc3\u88c1\u7684\u4e1c\u897f\u3002\u4f60\u6709\u6ca1\u6709\u60f3\u8fc7\u5728\u5199Shell\u811a\u672c\u7684\u65f6\u5019\u53ef\u4ee5\u628a\u4f60\u7684\u53d8\u91cf\u548c\u51fd\u6570\u653e\u5230\u4e00\u4e2a\u7c7b\u4e2d&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/5035.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[20,10,52],"tags":[245,555],"series":[],"aioseo_notices":[],"views":29427,"post_thumbnail_image":"","content_first_image":"","post_medium_image_300":"","post_thumbnail_image_624":"","post_frist_image":"","post_medium_image":"","post_large_image":"","post_full_image":"","post_all_images":[],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":17,"category_name":"Unix\/Linux","post_date":"2011-07-21","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[],"pageviews":29428,"pageviews_wl":11987,"ratings_average":3,"ratings_total":50,"ratings_users":15,"next_post_id":5075,"next_post_title":"\u4f60\u786e\u4fe1\u4f60\u4e86\u89e3\u65f6\u95f4\u5417\uff1f","previous_post_id":5044,"previous_post_title":"\u4e3a\u4ec0\u4e48Scrum\u4e0d\u884c\uff1f"}