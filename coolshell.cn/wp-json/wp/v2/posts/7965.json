{"id":7965,"date":"2012-08-01T08:20:46","date_gmt":"2012-08-01T00:20:46","guid":{"rendered":"http:\/\/coolshell.cn\/?p=7965"},"modified":"2018-08-29T23:02:26","modified_gmt":"2018-08-29T15:02:26","slug":"%e4%b8%80%e4%b8%aafork%e7%9a%84%e9%9d%a2%e8%af%95%e9%a2%98","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/7965.html","title":{"rendered":"\u4e00\u4e2afork\u7684\u9762\u8bd5\u9898"},"content":{"rendered":"<p>\u524d\u4e24\u5929\u6709\u4eba\u95ee\u4e86\u4e2a\u5173\u4e8eUnix\u7684fork()\u7cfb\u7edf\u8c03\u7528\u7684\u9762\u8bd5\u9898\uff0c\u8fd9\u4e2a\u9898\u6b63\u597d\u662f\u6211\u5927\u7ea6\u5341\u5e74\u524d\u627e\u5de5\u4f5c\u65f6\u67d0\u516c\u53f8\u95ee\u6211\u7684\u4e00\u4e2a\u9898\uff0c\u6211\u89c9\u5f97\u6bd4\u8f83\u6709\u8da3\uff0c\u5199\u7bc7\u6587\u7ae0\u4e0e\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u3002\u8fd9\u4e2a\u9898\u662f\u8fd9\u6837\u7684\uff1a<\/p>\n<p><strong>\u9898\u76ee\uff1a\u8bf7\u95ee\u4e0b\u9762\u7684\u7a0b\u5e8f\u4e00\u5171\u8f93\u51fa\u591a\u5c11\u4e2a\u201c-\u201d\uff1f<\/strong><\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\r\n#include &lt;stdio.h&gt;\r\n#include &lt;sys\/types.h&gt;\r\n#include &lt;unistd.h&gt;\r\n\r\nint main(void)\r\n{\r\n   int i;\r\n   for(i=0; i&lt;2; i++){\r\n      fork();\r\n      printf(&quot;-&quot;);\r\n   }\r\n\r\n   wait(NULL);\r\n   wait(NULL);\r\n\r\n   return 0;\r\n}\r\n<\/pre>\n<p>\u5982\u679c\u4f60\u5bf9fork()\u7684\u673a\u5236\u6bd4\u8f83\u719f\u6089\u7684\u8bdd\uff0c\u8fd9\u4e2a\u9898\u5e76\u4e0d\u96be\uff0c\u8f93\u51fa\u5e94\u8be5\u662f6\u4e2a\u201c-\u201d\uff0c\u4f46\u662f\uff0c\u5b9e\u9645\u4e0a\u8fd9\u4e2a\u7a0b\u5e8f\u4f1a\u5f88tricky\u5730\u8f93\u51fa8\u4e2a\u201c-\u201d\u3002<\/p>\n<p>\u8981\u8bb2\u6e05\u8fd9\u4e2a\u9898\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u77e5\u9053fork()\u7cfb\u7edf\u8c03\u7528\u7684\u7279\u6027\uff0c<\/p>\n<p><!--more--><\/p>\n<ul>\n<li>fork()\u7cfb\u7edf\u8c03\u7528\u662fUnix\u4e0b\u4ee5\u81ea\u8eab\u8fdb\u7a0b\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u4e00\u6b21\u8c03\u7528\uff0c\u4e24\u6b21\u8fd4\u56de\uff0c\u5982\u679c\u8fd4\u56de\u662f0\uff0c\u5219\u662f\u5b50\u8fdb\u7a0b\uff0c\u5982\u679c\u8fd4\u56de\u503c&gt;0\uff0c\u5219\u662f\u7236\u8fdb\u7a0b\uff08\u8fd4\u56de\u503c\u662f\u5b50\u8fdb\u7a0b\u7684pid\uff09\uff0c\u8fd9\u662f\u4f17\u4e3a\u5468\u77e5\u7684\u3002<\/li>\n<\/ul>\n<ul>\n<li>\u8fd8\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u4e1c\u897f\u662f\uff0c\u5728fork()\u7684\u8c03\u7528\u5904\uff0c\u6574\u4e2a\u7236\u8fdb\u7a0b\u7a7a\u95f4\u4f1a\u539f\u6a21\u539f\u6837\u5730\u590d\u5236\u5230\u5b50\u8fdb\u7a0b\u4e2d\uff0c\u5305\u62ec\u6307\u4ee4\uff0c\u53d8\u91cf\u503c\uff0c\u7a0b\u5e8f\u8c03\u7528\u6808\uff0c\u73af\u5883\u53d8\u91cf\uff0c\u7f13\u51b2\u533a\uff0c\u7b49\u7b49\u3002<\/li>\n<\/ul>\n<p>\u6240\u4ee5\uff0c\u4e0a\u9762\u7684\u90a3\u4e2a\u7a0b\u5e8f\u4e3a\u4ec0\u4e48\u4f1a\u8f93\u51658\u4e2a\u201c-\u201d\uff0c\u8fd9\u662f\u56e0\u4e3aprintf(&#8220;-&#8220;);\u8bed\u53e5\u6709buffer\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u4e0a\u8ff0\u7a0b\u5e8f\uff0cprintf(&#8220;-&#8220;);\u628a\u201c-\u201d\u653e\u5230\u4e86\u7f13\u5b58\u4e2d\uff0c\u5e76\u6ca1\u6709\u771f\u6b63\u7684\u8f93\u51fa\uff08\u53c2\u770b\u300a<a title=\"C\u8bed\u8a00\u7684\u8c1c\u9898\" href=\"https:\/\/coolshell.cn\/articles\/945.html\" target=\"_blank\">C\u8bed\u8a00\u7684\u8ff7\u9898<\/a>\u300b\u4e2d\u7684\u7b2c\u4e00\u9898\uff09\uff0c<strong>\u5728fork\u7684\u65f6\u5019\uff0c\u7f13\u5b58\u88ab\u590d\u5236\u5230\u4e86\u5b50\u8fdb\u7a0b\u7a7a\u95f4<\/strong>\uff0c\u6240\u4ee5\uff0c\u5c31\u591a\u4e86\u4e24\u4e2a\uff0c\u5c31\u6210\u4e868\u4e2a\uff0c\u800c\u4e0d\u662f6\u4e2a\u3002<\/p>\n<p>\u53e6\u5916\uff0c\u591a\u8bf4\u4e00\u4e0b\uff0c\u6211\u4eec\u77e5\u9053\uff0cUnix\u4e0b\u7684\u8bbe\u5907\u6709\u201c<a href=\"http:\/\/en.wikipedia.org\/wiki\/Device_file#Block_devices\" target=\"_blank\">\u5757\u8bbe\u5907<\/a>\u201d\u548c\u201c<a href=\"http:\/\/en.wikipedia.org\/wiki\/Device_file#Character_devices\" target=\"_blank\">\u5b57\u7b26\u8bbe\u5907<\/a>\u201d\u7684\u6982\u5ff5\uff0c\u6240\u8c13\u5757\u8bbe\u5907\uff0c\u5c31\u662f\u4ee5\u4e00\u5757\u4e00\u5757\u7684\u6570\u636e\u5b58\u53d6\u7684\u8bbe\u5907\uff0c\u5b57\u7b26\u8bbe\u5907\u662f\u4e00\u6b21\u5b58\u53d6\u4e00\u4e2a\u5b57\u7b26\u7684\u8bbe\u5907\u3002\u78c1\u76d8\u3001\u5185\u5b58\u90fd\u662f\u5757\u8bbe\u5907\uff0c\u5b57\u7b26\u8bbe\u5907\u5982\u952e\u76d8\u548c\u4e32\u53e3\u3002<strong>\u5757\u8bbe\u5907\u4e00\u822c\u90fd\u6709\u7f13\u5b58\uff0c\u800c\u5b57\u7b26\u8bbe\u5907\u4e00\u822c\u90fd\u6ca1\u6709\u7f13\u5b58<\/strong>\u3002<\/p>\n<p>\u5bf9\u4e8e\u4e0a\u9762\u7684\u95ee\u9898\uff0c\u6211\u4eec\u5982\u679c\u4fee\u6539\u4e00\u4e0b\u4e0a\u9762\u7684printf\u7684\u90a3\u6761\u8bed\u53e5\u4e3a\uff1a<\/p>\n<p><code data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">printf(&quot;-\\n&quot;);<\/code><\/p>\n<p>\u6216\u662f<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\"> printf(&quot;-&quot;);\r\nfflush(stdout);<\/pre>\n<p>\u5c31\u6ca1\u6709\u95ee\u9898\u4e86\uff08\u5c31\u662f6\u4e2a\u201c-\u201d\u4e86\uff09\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u9047\u5230\u201c\\n\u201d\uff0c\u6216\u662fEOF\uff0c\u6216\u662f\u7f13\u4e2d\u533a\u6ee1\uff0c\u6216\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\u5173\u95ed\uff0c\u6216\u662f\u4e3b\u52a8flush\uff0c\u6216\u662f\u7a0b\u5e8f\u9000\u51fa\uff0c\u5c31\u4f1a\u628a\u6570\u636e\u5237\u51fa\u7f13\u51b2\u533a\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6807\u51c6\u8f93\u51fa\u662f\u884c\u7f13\u51b2\uff0c\u6240\u4ee5\u9047\u5230\u201c\\n\u201d\u7684\u65f6\u5019\u4f1a\u5237\u51fa\u7f13\u51b2\u533a\uff0c\u4f46\u5bf9\u4e8e\u78c1\u76d8\u8fd9\u4e2a\u5757\u8bbe\u5907\u6765\u8bf4\uff0c\u201c\\n\u201d\u5e76\u4e0d\u4f1a\u5f15\u8d77\u7f13\u51b2\u533a\u5237\u51fa\u7684\u52a8\u4f5c\uff0c\u90a3\u662f\u5168\u7f13\u51b2\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528setvbuf\u6765\u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u6216\u662f\u7528fflush\u5237\u7f13\u5b58\u3002<\/p>\n<p>\u6211\u4f30\u8ba1\u6709\u4e9b\u670b\u53cb\u53ef\u80fd\u5bf9\u4e8efork()\u8fd8\u4e0d\u662f\u5f88\u4e86\u89e3\uff0c\u90a3\u4e48\u6211\u4eec\u628a\u4e0a\u9762\u7684\u7a0b\u5e8f\u6539\u6210\u4e0b\u9762\u8fd9\u6837\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\r\n#include &lt;stdio.h&gt;\r\n#include &lt;sys\/types.h&gt;\r\n#include &lt;unistd.h&gt;\r\nint main(void)\r\n{\r\n   int i;\r\n   for(i=0; i&lt;2; i++){\r\n      fork();\r\n      \/\/\u6ce8\u610f\uff1a\u4e0b\u9762\u7684printf\u6709\u201c\\n\u201d\r\n      printf(&quot;ppid=%d, pid=%d, i=%d \\n&quot;, getppid(), getpid(), i);\r\n   }\r\n   sleep(10); \/\/\u8ba9\u8fdb\u7a0b\u505c\u7559\u5341\u79d2\uff0c\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u7528pstree\u67e5\u770b\u4e00\u4e0b\u8fdb\u7a0b\u6811\r\n   return 0;\r\n}\r\n<\/pre>\n<p>\u4e8e\u662f\uff0c\u4e0a\u9762\u8fd9\u6bb5\u7a0b\u5e8f\u4f1a\u8f93\u51fa\u4e0b\u9762\u7684\u7ed3\u679c\uff0c\uff08\u6ce8\uff1a\u7f16\u8bd1\u51fa\u7684\u53ef\u6267\u884c\u7684\u7a0b\u5e8f\u540d\u4e3afork\uff09<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">ppid=8858, pid=8518, i=0\r\nppid=8858, pid=8518, i=1\r\nppid=8518, pid=8519, i=0\r\nppid=8518, pid=8519, i=1\r\nppid=8518, pid=8520, i=1\r\nppid=8519, pid=8521, i=1\r\n\r\n$ pstree -p | grep fork\r\n|-bash(8858)-+-fork(8518)-+-fork(8519)---fork(8521)\r\n|            |            `-fork(8520)<\/pre>\n<p>\u9762\u5bf9\u8fd9\u6837\u7684\u56fe\u4f60\u53ef\u80fd\u8fd8\u662f\u770b\u4e0d\u61c2\uff0c\u6ca1\u4e8b\uff0c\u6211\u597d\u4e8b\u505a\u5230\u5e95\uff0c\u753b\u4e2a\u56fe\u7ed9\u4f60\u770b\u770b\uff1a<\/p>\n<p><img decoding=\"async\" loading=\"lazy\" class=\"aligncenter size-full wp-image-7968\" title=\"fork \u7a0b\u5e8f\u8c03\u7528\u56fe\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg\" alt=\"\" width=\"620\" height=\"407\" srcset=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg 620w, https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg-300x197.jpg 300w, https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg-411x270.jpg 411w\" sizes=\"(max-width: 620px) 100vw, 620px\" \/><\/p>\n<p>\u6ce8\u610f\uff1a\u4e0a\u56fe\u4e2d\u7684\u6211\u7528\u4e86\u51e0\u4e2a\u8272\u5f69\uff0c\u76f8\u540c\u989c\u8272\u7684\u662f\u540c\u4e00\u4e2a\u8fdb\u7a0b\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u7684pstree\u7684\u56fe\u793a\u5c31\u53ef\u4ee5\u6210\u4e3a\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50\uff1a\uff08\u4e0b\u56fe\u4e2d\u7684\u989c\u8272\u4e0e\u4e0a\u56fe\u5bf9\u5e94\uff09<\/p>\n<p><img decoding=\"async\" loading=\"lazy\" class=\"aligncenter size-full wp-image-7969\" title=\"fork\u8fdb\u7a0b\u6811\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork02.jpg\" alt=\"\" width=\"437\" height=\"97\" srcset=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork02.jpg 437w, https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork02-300x66.jpg 300w\" sizes=\"(max-width: 437px) 100vw, 437px\" \/><\/p>\n<p>\u8fd9\u6837\uff0c\u5bf9\u4e8eprintf(&#8220;-&#8220;);\u8fd9\u4e2a\u8bed\u53e5\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f88\u6e05\u695a\u7684\u77e5\u9053\uff0c\u54ea\u4e2a\u5b50\u8fdb\u7a0b\u590d\u5236\u4e86\u7236\u8fdb\u7a0b\u6807\u51c6\u8f93\u51fa\u7f13\u4e2d\u533a\u91cc\u7684\u7684\u5185\u5bb9\uff0c\u800c\u5bfc\u81f4\u4e86\u591a\u6b21\u8f93\u51fa\u4e86\u3002\uff08\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5c31\u662f\u6211\u9634\u5f71\u5e76\u53cc\u8fb9\u6846\u4e86\u90a3\u4e24\u4e2a\u5b50\u8fdb\u7a0b\uff09<\/p>\n<p><img decoding=\"async\" loading=\"lazy\" class=\"aligncenter size-full wp-image-7970\" title=\"fork\u7a0b\u5e8f\u6267\u884c\u56fe\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork03.jpg\" alt=\"\" width=\"626\" height=\"415\" srcset=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork03.jpg 626w, https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork03-300x198.jpg 300w\" sizes=\"(max-width: 626px) 100vw, 626px\" \/><\/p>\n<p>\u73b0\u5728\u4f60\u660e\u767d\u4e86\u5427\u3002\uff08\u53e6\uff0c\u5bf9\u4e8e\u56fe\u4e2d\u7684\u6211\u672c\u4eba\u62d9\u52a3\u7684\u914d\u8272\uff0c\u8bf7\u89c1\u8c05!\uff09<\/p>\n<p>\uff08\u5168\u6587\u5b8c\uff09<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>\u524d\u4e24\u5929\u6709\u4eba\u95ee\u4e86\u4e2a\u5173\u4e8eUnix\u7684fork()\u7cfb\u7edf\u8c03\u7528\u7684\u9762\u8bd5\u9898\uff0c\u8fd9\u4e2a\u9898\u6b63\u597d\u662f\u6211\u5927\u7ea6\u5341\u5e74\u524d\u627e\u5de5\u4f5c\u65f6\u67d0\u516c\u53f8\u95ee\u6211\u7684\u4e00\u4e2a\u9898\uff0c\u6211\u89c9\u5f97\u6bd4\u8f83\u6709\u8da3\uff0c\u5199\u7bc7\u6587\u7ae0\u4e0e\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u3002\u8fd9\u4e2a\u9898\u662f&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/7965.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[5,20,18,3,271],"tags":[59,26,514,21,164],"series":[],"aioseo_notices":[],"views":170615,"post_thumbnail_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg","content_first_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg","post_medium_image_300":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg","post_thumbnail_image_624":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg","post_frist_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg","post_medium_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg","post_large_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg","post_full_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg","post_all_images":[{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork01jpg.jpg","id":"image0"},{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork02.jpg","id":"image1"},{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2012\/07\/fork03.jpg","id":"image2"}],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":223,"category_name":"C\/C++\u8bed\u8a00","post_date":"2012-08-01","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[],"pageviews":170616,"pageviews_wl":47908,"ratings_average":4,"ratings_total":322,"ratings_users":68,"next_post_id":7992,"next_post_title":"C++\u7684\u5751\u771f\u7684\u591a\u5417\uff1f","previous_post_id":7886,"previous_post_title":"\u4ee3\u7801\u6267\u884c\u7684\u6548\u7387"}