{"id":9543,"date":"2013-04-29T16:17:40","date_gmt":"2013-04-29T08:17:40","guid":{"rendered":"http:\/\/coolshell.cn\/?p=9543"},"modified":"2013-05-10T05:01:30","modified_gmt":"2013-05-09T21:01:30","slug":"c%e7%9a%84%e6%95%b0%e7%bb%84%e4%b8%8d%e6%94%af%e6%8c%81%e5%a4%9a%e6%80%81","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/9543.html","title":{"rendered":"\u201cC++\u7684\u6570\u7ec4\u4e0d\u652f\u6301\u591a\u6001\u201d\uff1f"},"content":{"rendered":"<p>\u5148\u662f\u5728\u5fae\u535a\u4e0a\u770b\u5230\u4e86\u4e2a<a href=\"http:\/\/weibo.com\/1876004965\/zueproucp\" target=\"_blank\">\u5fae\u535a<\/a>\u548c\u4e91\u98ce\u7684\u8bc4\u8bba\uff0c\u7136\u540e\u6211\u56de\u4e86\u201c\u697c\u4e3b\u5bf9C\u7684\u5185\u5b58\u7ba1\u7406\u4e0d\u4e86\u89e3\u201d\u3002<\/p>\n<p><a href=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg\"><img decoding=\"async\" loading=\"lazy\" class=\"aligncenter size-full wp-image-9544\" alt=\"\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg\" width=\"580\" height=\"211\" srcset=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg 580w, https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo-300x109.jpg 300w\" sizes=\"(max-width: 580px) 100vw, 580px\" \/><\/a><\/p>\n<p>\u540e\u6765\u5f15\u53d1\u4e86\u5f88\u591a\u4eba\u7684\u8ba8\u8bba\uff0c\u5927\u91cf\u7684\u4eba\u53c8\u501f\u673a\u6765\u9ed1C++\uff0c\u6bd4\u5982\uff1a<\/p>\n<blockquote><p>\/\/<a href=\"http:\/\/weibo.com\/n\/Baidu-ThursdayWang\">@Baidu-ThursdayWang<\/a>:\u8fd9\u4e0d\u5c31c++\u5f31\u7206\u4e86\u7684\u5730\u65b9\u5417\uff0c\u9700\u8981\u8bb0\u5fc6\u592a\u591a\u4e1c\u897f<\/p>\n<p>\/\/<a href=\"http:\/\/weibo.com\/n\/%E7%BC%96%E7%A8%8B%E6%B5%AA%E5%AD%90%E5%BC%A0%E5%8F%91%E8%B4%A2\">@\u7f16\u7a0b\u6d6a\u5b50\u5f20\u53d1\u8d22<\/a>:\u8fd9\u4e2a\u8ddfC\u5173\u7cfb\u771f\u4e0d\u5927\u3002\u4e0d\u8fc7\u6211\u5f97\u9a8c\u8bc1\u4e00\u4e0b\uff0c\u611f\u89c9\u771f\u7684\u4e0d\u5e94\u8be5\u662f\u8fd9\u6837\u7684\u3002\u5982\u679c\u57fa\u7c7b\u7684\u6790\u6784\u8fd9\u79cd\u60c5\u51b5\u4e0d\u80fd \u8c03\u7528\uff0c\u5c31\u592a\u5f31\u4e86\u3002<\/p>\n<p>\/\/<a href=\"http:\/\/weibo.com\/1401324585\" target=\"_blank\">@\u7a0b\u5e8f\u5143<\/a>\uff1a\u73b0\u5728\u770b\u6765\uff0c\u5f53\u521d\u7531\u4e8e\u6bc5\u529b\u4e0d\u591f\u800c\u6ca1\u6709\u6df1\u5165\u7ea0\u7f20c++\u8bed\u8a00\u7279\u6027\u7684\u5404\u79cd\u7284\u89d2\u65ee\u65ef\u7684\u5751\u7239\u7ec6\u679d\u672b\u8282\uff0c\u5b9e\u662f\u5e78\u4e8b\u3002\u4e3a\u73b0\u5728\u8fd8\u6c89\u6d78\u4e8e\u8fd9\u4e9b\u8be1\u5f02\u7279\u6027\u5e76\u4e50\u6b64\u4e0d\u75b2\u7684\u540c\u5fd7\u4eec\u611f\u5230\u5fe7\u4f24\u3002<\/p><\/blockquote>\n<p>\u7136\u540e\uff0c\u4e5f\u51fa\u73b0\u4e86\u4e00\u4e9b\u4e71\u4e03\u516b\u7cdf\u7684\u7406\u89e3\uff1a<\/p>\n<p><!--more--><\/p>\n<blockquote><p>\/\/<a href=\"http:\/\/weibo.com\/n\/BA5BO\">@BA5BO<\/a>: \u6570\u7ec4\u662f\u57fa\u4e8e\u62f7\u8d1d\u7684\uff0c\u800c\u591a\u6001\u662f\u57fa\u4e8e\u6307\u9488\u7684\uff0c\u6d3e\u751f\u7c7b\u8d4b\u503c\u7ed9\u57fa\u7c7b\u6570\u7ec4\u53ea\u662f\u62f7\u8d1d\u590d\u5236\u4e86\u4e00\u4e2a\u57fa\u7c7b\u65b0\u5bf9\u8c61\uff0c\u5f53\u7136\u4e0d\u9700\u8981\u6d3e\u751f\u7c7b\u6790\u6784\u51fd\u6570<\/p>\n<p>\/\/<a href=\"http:\/\/weibo.com\/n\/%E7%BC%96%E7%A8%8B%E6%B5%AA%E5%AD%90%E5%BC%A0%E5%8F%91%E8%B4%A2\">@\u7f16\u7a0b\u6d6a\u5b50\u5f20\u53d1\u8d22<\/a>:\u6211\u7a81\u7136\u7406\u89e3\u662f\u600e\u4e48\u56de\u4e8b\u4e86\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6570\u7ec4\u4e2d\u5404\u5143\u7d20\u90fd\u662f\u7b49\u957f\u7ed3\u6784\u4f53\uff0c\u7c7b\u578b\u5fc5\u987b\u4e00\u81f4\uff0c\u7684\u786e\u6ca1\u6cd5\u591a\u6001\u3002\u8fd9\u8ddfC#\u548cjava\u4e0d\u540c\u3002\u540e\u4e24\u8005\u5bf9\u4e8e\u5f15\u7528\u7c7b\u578b\u5b58\u653e\u7684\u662f\u5bf9\u8c61\u6307\u9488\u3002<\/p><\/blockquote>\n<p>\u7b49\u7b49\uff0c\u770b\u6765\u6211\u5fc5\u9700\u8981\u5199\u4e00\u7bc7\u535a\u5ba2\u4ee5\u6b63\u89c6\u542c\u4e86\u3002<\/p>\n<p>\u56e0\u4e3a\u6ca1\u6709\u770b\u5230\u4e0a\u4e0b\u6587\uff0c\u6211\u5c31\u731c\u6d4b\u8ba8\u8bba\u7684\u53ef\u80fd\u4f1a\u662f\u4e0b\u9762\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e4b\u4e00\uff1a<\/p>\n<p style=\"padding-left: 30px;\">1) \u4e00\u4e2aBase*[]\u7684\u6307\u9488\u6570\u7ec4\u4e2d\uff0c\u5b58\u653e\u4e86\u4e00\u5806\u6d3e\u751f\u7c7b\u7684\u6307\u9488\uff0c\u8fd9\u6837\uff0c\u4f60delete [] pBase; \u53ea\u662f\u628a\u6307\u9488\u6570\u7ec4\u7ed9\u5220\u9664\u4e86\uff0c\u5e76\u6ca1\u6709\u5220\u9664\u6307\u9488\u6240\u6307\u5411\u7684\u5bf9\u8c61\u3002\u8fd9\u4e2a\u662f\u6700\u57fa\u7840\u7684C\u7684\u95ee\u9898\u3002\u4f60\u5148\u5f97for\u8fd9\u4e2a\u6307\u9488\u6570\u7ec4\uff0c\u628a\u6570\u636e\u91cc\u7684\u5bf9\u8c61\u90fddelete\u6389\uff0c\u7136\u540e\u518d\u5220\u9664\u6570\u7ec4\u3002\u5f88\u660e\u663e\uff0c\u8fd9\u548cC++\u6ca1\u6709\u4ec0\u4e48\u5173\u7cfb\u3002<\/p>\n<p style=\"padding-left: 30px;\">2\uff09\u7b2c\u4e8c\u79cd\u53ef\u80fd\u662f\uff1aBase *pBase = new Derived[n] \u8fd9\u6837\u7684\u60c5\u51b5\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cdelete[] pBase \u660e\u663e\u4e0d\u4f1a\u8c03\u7528\u865a\u6790\u6784\u51fd\u6570\uff08\u5f53\u7136\uff0c\u8fd9\u5e76\u4e0d\u4e00\u5b9a\uff0c\u6211\u540e\u9762\u4f1a\u8bf4\uff09 \uff0c\u8fd9\u5c31\u662f\u4e0a\u9762\u4e91\u98ce\u56de\u7684\u5fae\u535a\u3002\u5bf9\u6b64\uff0c\u6211\u89c9\u5f97\u5982\u679c\u662f\u8fd9\u4e2a\u6837\u5b50\uff0c\u8fd9\u4e2a\u7a0b\u5e8f\u5458<strong>\u5b8c\u5168\u6ca1\u6709\u641e\u61c2C\u8bed\u8a00\u4e2d\u7684\u6307\u9488\u548c\u6570\u7ec4\u662f\u600e\u4e48\u4e00\u56de\u4e8b<\/strong>\uff0c\u4e5f\u6ca1\u6709\u641e\u6e05\u695a\uff0c \u4ec0\u4e48\u662f\u5bf9\u8c61\uff0c\u4ec0\u4e48\u662f\u5bf9\u8c61\u7684\u6307\u9488\u548c\u5f15\u7528\uff0c\u8fd9\u5b8c\u5168\u5c31\u662fC\u8bed\u8a00\u6ca1\u6709\u5b66\u597d\u3002<\/p>\n<p>\u540e\u6765\uff0c\u5728\u770b\u5230\u4e86\u00a0<a href=\"http:\/\/weibo.com\/n\/GeniusVczh\">@GeniusVczh<\/a>\u00a0\u7684\u539f\u6587 \u300a<a id=\"viewpost1_TitleUrl\" href=\"http:\/\/www.cppblog.com\/vczh\/archive\/2013\/04\/27\/199765.html\">\u5982\u4f55\u8bbe\u8ba1\u4e00\u95e8\u8bed\u8a00\uff08\u4e00\uff09\u2014\u2014\u4ec0\u4e48\u662f\u5751(a)<\/a>\u300b\u6700\u540e\u65f6\uff0c\u624d\u77e5\u9053\u4e86\u8bf4\u7684\u662f\u7b2c\u4e8c\u79cd\u60c5\u51b5\u3002\u4e5f\u5c31\u662f\u4e0b\u9762\u7684\u8fd9\u4e2a\u793a\u4f8b\uff08\u6211\u52a0\u4e86\u865a\u7684\u6790\u6784\u51fd\u6570\u8fd9\u6837\u65b9\u4fbf\u7f16\u8bd1\uff09\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">class Base\r\n{\r\n  public:\r\n    virtual ~B(){ cout &lt;&lt;&quot;B::~B()&quot;&lt;&lt;endl; }\r\n};\r\n\r\nclass Derived : public Base\r\n{\r\n  public:\r\n    virtual ~D() { cout &lt;&lt;&quot;D::D~()&quot;&lt;&lt;endl; }\r\n};\r\n\r\nBase* pBase = new Derived[10];\r\ndelete[] pBase;<\/pre>\n<h4>C\u8bed\u8a00\u8865\u8bfe<\/h4>\n<p>\u6211\u5148\u4e0d\u8bf4\u8fd9\u6bb5C++\u7684\u7a0b\u5e8f\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\u80fd\u6b63\u786e\u8c03\u7528\u6d3e\u751f\u7c7b\u7684\u6790\u6784\u51fd\u6570\uff0c\u6211\u8fd8\u662f\u5148\u6765\u8bf4\u8bf4C\u8bed\u8a00\uff0c\u8fd9\u6837\u6211\u5728\u540e\u9762\u8bf4\u8fd9\u6bb5\u4ee3\u7801\u65f6\u4f60\u5c31\u660e\u767d\u4e86\u3002<\/p>\n<p>\u5bf9\u4e8e\u4e0a\u9762\u7684\uff1a<\/p>\n<p><code data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">Base* pBase = new Derived[10];<\/code><\/p>\n<p>\u8fd9\u4e2a\u8bed\u8a00\u548c\u4e0b\u9762\u7684\u6709\u4ec0\u4e48\u4e0d\u540c\u5417\uff1f<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">Derived d[10];\r\n\r\nBase* pBase = d;<\/pre>\n<p>\u4e00\u4e2a\u662f\u5806\u5185\u5b58\u52a8\u6001\u5206\u914d\uff0c\u4e00\u4e2a\u662f\u6808\u5185\u5b58\u9759\u6001\u5206\u914d\u3002\u53ea\u662f\u5185\u5b58\u7684\u4f4d\u7f6e\u548c\u7c7b\u578b\u4e0d\u4e00\u6837\uff0c\u5728\u8bed\u6cd5\u548c\u4f7f\u7528\u4e0a\u6ca1\u6709\u4ec0\u4e48\u4e0d\u4e00\u6837\u7684\u3002\uff08\u5982\u679c\u4f60\u628aBase \u548c Derived\u60f3\u6210struct\uff0c\u628anew\u60f3\u6210malloc() \uff0c\u4f60\u8fd8\u89c9\u5f97\u8fd9\u548cC++\u6709\u4ec0\u4e48\u5173\u7cfb\u5417\uff1f\uff09<\/p>\n<p><strong>\u90a3\u4e48\uff0c\u4f60\u89c9\u5f97pBase\u8fd9\u4e2a\u6307\u9488\u662f\u6307\u5411\u5bf9\u8c61\u7684\uff0c\u662f\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u8fd8\u662f\u6307\u5411\u4e00\u4e2a\u6570\u7ec4\u7684\uff0c\u662f\u6570\u7ec4\u7684\u5f15\u7528\uff1f<\/strong><\/p>\n<p>\u4e8e\u662f\u4e4e\uff0c\u4f60\u53ef\u4ee5\u60f3\u50cf\u4e00\u4e0b\u4e0b\u9762\u7684\u573a\u666f\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">int *pInt; char* pChar;\r\n\r\npInt = (int*)malloc(10*sizeof(int));\r\n\r\npChar = (char*)pInt;<\/pre>\n<p><strong>\u5bf9\u4e0a\u9762\u7684pInt\u548cpChar\u6307\u9488\u6765\u8bf4\uff0cpInt[3]\u548cpChar[3]\u6240\u6307\u5411\u7684\u5185\u5bb9\u662f\u5426\u4e00\u6837\u5462\uff1f\u5f53\u7136\u4e0d\u4e00\u6837\uff0c\u56e0\u4e3aint\u662f4\u4e2a\u5b57\u8282\uff0cchar\u662f1\u4e2a\u5b57\u8282\uff0c\u6b65\u957f\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u5f53\u7136\u4e0d\u4e00\u6837\u3002<\/strong><\/p>\n<p><strong>\u90a3\u4e48\u518d\u56de\u5230\u90a3\u4e2a\u628aDerived[]\u6570\u7ec4\u7684\u6307\u9488\u8f6c\u6210Base\u7c7b\u578b\u7684\u6307\u9488pBase\uff0c\u90a3\u4e48pBase[3]\u662f\u5426\u4f1a\u6307\u5411\u6b63\u786e\u7684Derrived[3]\u5462\uff1f<\/strong><\/p>\n<p>\u6211\u4eec\u6765\u770b\u4e2a\u7eafC\u8bed\u8a00\u7684\u4f8b\u7a0b\uff0c\u4e0b\u9762\u6709\u4e24\u4e2a\u7ed3\u6784\u4f53\uff0c\u5c31\u50cf\u7ee7\u627f\u4e00\u6837\uff0c\u6211\u8fd8\u522b\u6709\u7528\u5fc3\u5730\u52a0\u4e86\u4e00\u4e2avoid *vptr\uff0c\u597d\u50cf\u865a\u51fd\u6570\u8868\u4e00\u6837\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\r\n    struct A {\r\n        void *vptr;\r\n        int i;\r\n    };\r\n\r\n    struct B{\r\n        void *vptr;\r\n        int i;\r\n        char c;\r\n        int j;\r\n    }b[2] ={\r\n        {(void*)0x01, 100, &#039;a&#039;, -1},\r\n        {(void*)0x02, 200, &#039;A&#039;, -2}\r\n    };\r\n<\/pre>\n<p>\u6ce8\u610f\uff1a\u6211\u7528\u7684\u662fG++\u7f16\u8bd1\u7684\uff0c\u572864bits\u5e73\u53f0\u4e0a\u7f16\u8bd1\u7684\uff0c\u5176\u4e2d\u7684sizeof(void*)\u7684\u503c\u662f8\u3002<\/p>\n<p>\u6211\u4eec\u770b\u4e00\u4e0b\u6808\u4e0a\u5185\u5b58\u5206\u914d\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\r\n    struct A *pa1 = (struct A*)(b);\r\n<\/pre>\n<p>\u7528gdb\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e0b\u9762\u7684\u60c5\u51b5\uff1a(pa1[1]\u7684\u6210\u5458\u7684\u503c\u5b8c\u5168\u4e71\u6389\u4e86)<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\" data-enlighter-highlight=\"6\">(gdb) p b\r\n$7 = {{vptr = 0x1, i = 100, c = 97 &#039;a&#039;, j = -1}, {vptr = 0x2, i = 200, c = 65 &#039;A&#039;, j = -2}}\r\n(gdb) p pa1[0]\r\n$8 = {vptr = 0x1, i = 100}\r\n(gdb) p pa1[1]\r\n$9 = {vptr = 0x7fffffffffff, i = 2}\r\n<\/pre>\n<p>\u6211\u4eec\u518d\u6765\u770b\u4e00\u4e0b\u5806\u4e0a\u7684\u60c5\u51b5\uff1a\uff08\u6211\u4eec\u52a8\u6001\u4e86struct B [2]\uff0c\u7136\u540e\u8f6c\u6210struct A *\uff0c\u7136\u540e\u5bf9\u5176\u6210\u5458\u64cd\u4f5c\uff09<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\r\n    struct A *pa = (struct A*)malloc(2*sizeof(struct B));\r\n    struct B *pb = (struct B*)pa\uff1b\r\n\r\n    pa[0].vptr = (void*) 0x01;\r\n    pa[1].vptr = (void*) 0x02;\r\n\r\n    pa[0].i = 100;\r\n    pa[1].i = 200;\r\n<\/pre>\n<p>\u7528gdb\u6765\u67e5\u770b\u4e00\u4e0b\u53d8\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e0b\u9762\u7684\u60c5\u51b5\uff1a\uff08pa\u6ca1\u95ee\u9898\uff0c\u4f46\u662fpb[1]\u7684\u5185\u5b58\u4e71\u6389\u4e86\uff09<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\" data-enlighter-highlight=\"8\">(gdb) p pa[0]\r\n$1 = {vptr = 0x1, i = 100}\r\n(gdb) p pa[1]\r\n$2 = {vptr = 0x2, i = 200}\r\n(gdb) p pb[0]\r\n$3 = {vptr = 0x1, i = 100, c = 0 &#039;&#092;&#048;00&#039;, j = 2}\r\n(gdb) p pb[1]\r\n$4 = {vptr = 0xc8, i = 0, c = 0 &#039;&#092;&#048;00&#039;, j = 0}\r\n<\/pre>\n<p>\u53ef\u89c1\uff0c\u8fd9\u5b8c\u5168\u5c31\u662fC\u8bed\u8a00\u91cc\u4e71\u8f6c\u578b\u9020\u6210\u4e86\u5185\u5b58\u7684\u6df7\u4e71\uff0c\u8fd9\u548cC++\u4e00\u70b9\u5173\u7cfb\u90fd\u6ca1\u6709\u3002\u800c\u4e14\uff0cC++\u7684\u4efb\u4f55\u4e00\u672c\u4e66\u90fd\u8bf4\u8fc7\uff0c\u7236\u7c7b\u5bf9\u8c61\u548c\u5b50\u7c7b\u5bf9\u8c61\u7684\u8f6c\u578b\u4f1a\u5e26\u6765\u4e25\u91cd\u7684\u5185\u5b58\u95ee\u9898\u3002<\/p>\n<p>\u4f46\u662f\uff0c\u5982\u679c\u572864bits\u5e73\u53f0\u4e0b\uff0c\u5982\u679c\u628a\u6211\u4eec\u7684structB\u6539\u4e00\u4e0b\uff0c\u6539\u6210\u5982\u4e0b\uff08\u628astruct B\u4e2d\u7684int j\u7ed9\u6ce8\u91ca\u6389\uff09\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\r\n    struct A {\r\n        void *vptr;\r\n        int i;\r\n    };\r\n\r\n    struct B{\r\n        void *vptr;\r\n        int i;\r\n        char c;\r\n        \/\/int j; &lt;---\u6ce8\u91ca\u6389int j\r\n    }b[2] ={\r\n        {(void*)0x01, 100, &#039;a&#039;},\r\n        {(void*)0x02, 200, &#039;A&#039;}\r\n    };\r\n<\/pre>\n<p>\u4f60\u5c31\u4f1a\u53d1\u73b0\uff0c\u4e0a\u9762\u7684\u5185\u5b58\u6df7\u4e71\u7684\u95ee\u9898\u90fd\u6ca1\u6709\u4e86\uff0c\u56e0\u4e3astruct A\u548cstruct B\u7684size\u662f\u4e00\u6837\u7684\uff1a<\/p>\n<pre data-enlighter-language=\"shell\" class=\"EnlighterJSRAW\">(gdb) p sizeof(struct A)\r\n$6 = 16\r\n(gdb) p sizeof(struct B)\r\n$7 = 16<\/pre>\n<p>\u6ce8\uff1a\u5982\u679c\u4e0d\u6ce8\u91caint j\uff0c\u90a3\u4e48sizeof(struct B)\u7684\u503c\u662f24\u3002<\/p>\n<p>\u8fd9\u5c31\u662fC\u8bed\u8a00\u4e2d\u7684\u5185\u5b58\u5bf9\u9f50\uff0c\u5185\u5b58\u5bf9\u9f50\u7684\u539f\u56e0\u5c31\u662f\u4e3a\u4e86\u66f4\u5feb\u7684\u5b58\u53d6\u5185\u5b58\uff08\u8be6\u89c1\u300a<a title=\"\u6df1\u5165\u7406\u89e3C\u8bed\u8a00\" href=\"https:\/\/coolshell.cn\/articles\/5761.html\" target=\"_blank\">\u6df1\u5165\u7406\u89e3C\u8bed\u8a00<\/a>\u300b\uff09<\/p>\n<p>\u5982\u679c\u5185\u5b58\u5bf9\u9f50\u4e86\uff0c\u800c\u4e14struct A\u4e2d\u7684\u6210\u5458\u7684\u987a\u5e8f\u5728struct B\u4e2d\u662f\u4e00\u6837\u7684\u800c\u4e14\u5728\u6700\u524d\u9762\u8bdd\uff0c\u90a3\u4e48\u5c31\u6ca1\u6709\u95ee\u9898\u3002<\/p>\n<h4>\u518d\u6765\u770bC++\u7684\u7a0b\u5e8f<\/h4>\n<p>\u5982\u679c\u4f60\u770b\u8fc7\u62115\u5e74\u524d\u5199\u7684\u300a<strong><a href=\"http:\/\/blog.csdn.net\/haoel\/article\/details\/1948051\" target=\"_blank\">C++\u865a\u51fd\u6570\u8868\u89e3\u6790<\/a><\/strong>\u300b\u4ee5\u53ca\u300a<strong>C++\u5185\u5b58\u5bf9\u8c61\u5e03\u5c40 <a href=\"http:\/\/blog.csdn.net\/haoel\/article\/details\/3081328\" target=\"_blank\">\u4e0a\u7bc7<\/a>\u3001<a href=\"http:\/\/blog.csdn.net\/haoel\/article\/details\/3081385\" target=\"_blank\">\u4e0b\u7bc7<\/a><\/strong>\u300b\uff0c\u4f60\u5c31\u77e5\u9053C++\u7684\u6807\u51c6\u4f1a\u628a\u865a\u51fd\u6570\u8868\u7684\u6307\u9488\u653e\u5728\u7c7b\u5b9e\u4f8b\u7684\u6700\u524d\u9762\uff0c\u4f60\u4e5f\u5c31\u77e5\u9053\u4e3a\u4ec0\u4e48\u6211\u522b\u6709\u7528\u5fc3\u5730\u5728struct A\u548cstruct B\u524d\u52a0\u4e86\u4e00\u4e2a void *vptr\u3002C++\u4e4b\u6240\u4ee5\u8981\u52a0\u5728\u6700\u524d\u9762\u5c31\u662f\u4e3a\u4e86\u8f6c\u578b\u540e\uff0c\u4e0d\u4f1a\u627e\u4e0d\u5230\u865a\u8868\u4e86\u3002<\/p>\n<p>\u597d\u4e86\uff0c\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u518d\u6765\u770bC++\uff0c\u770b\u4e0b\u9762\u7684\u4ee3\u7801\uff1a<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">\r\n#include\r\nusing namespace std;\r\n\r\nclass B\r\n{\r\n  int b;\r\n  public:\r\n    virtual ~B(){ cout &lt;&lt;&quot;B::~B()&quot;&lt;&lt;endl; }\r\n};\r\n\r\nclass D: public B\r\n{\r\n  int i;\r\n  public:\r\n    virtual ~D() { cout &lt;&lt;&quot;D::~D()&quot;&lt;&lt;endl; }\r\n};\r\n\r\nint main(void)\r\n{\r\n    cout &lt;&lt; &quot;sizeB:&quot; &lt;&lt; sizeof(B) &lt;&lt; &quot; sizeD:&quot;&lt;&lt; sizeof(D) &lt;&lt;endl;\r\n    B *pb = new D[2];\r\n\r\n    delete [] pb;\r\n\r\n    return 0;\r\n}\r\n<\/pre>\n<p><strong>\u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u6b63\u786e\u6267\u884c\uff0c\u5305\u62ec\u8c03\u7528\u5b50\u7c7b\u7684\u865a\u51fd\u6570\uff01\u56e0\u4e3a\u5185\u5b58\u5bf9\u9f50\u4e86<\/strong>\u3002\u5728\u6211\u768464bits\u7684CentOS\u4e0a\u2014\u2014sizeof(B):16 \uff0csizeof(D):16<\/p>\n<p><strong>\u4f46\u662f\uff0c\u5982\u679c\u4f60\u5728class D\u4e2d\u518d\u52a0\u4e00\u4e2aint\u6210\u5458\u7684\u95ee\u9898\uff0c\u8fd9\u4e2a\u7a0b\u5e8f\u5c31Segmentation fault\u4e86<\/strong>\u3002\u56e0\u4e3a\u2014\u2014 sizeof(B):16 \uff0csizeof(D):24\u3002pb[1]\u7684\u865a\u8868\u627e\u5230\u4e86\u4e00\u4e2a\u9519\u8bef\u7684\u5185\u5b58\u4e0a\uff0c\u5185\u5b58\u4e71\u6389\u4e86\u3002<\/p>\n<p>\u518d\u6ce8\uff1a\u6211\u5728Visual Studio 2010\u4e0a\u505a\u4e86\u4e00\u4e0b\u6d4b\u8bd5\uff0c\u5bf9\u4e8e struct \u6765\u8bf4\uff0c\u5176\u8868\u73b0\u548cgcc\u7684\u662f\u4e00\u6837\u7684\uff0c\u4f46\u5bf9\u4e8eclass\u7684\u4ee3\u7801\u6765\u8bf4\uff0c\u5176\u53ef\u4ee5\u201c\u6b63\u786e\u8c03\u7528\u5230\u865a\u51fd\u6570\u201d\u65e0\u8bba\u7236\u7c7b\u548c\u5b50\u7c7b\u6709\u6ca1\u6709\u4e00\u6837\u7684size\u3002<\/p>\n<p>\u7136\u800c\uff0c\u5728C++\u7684\u6807\u51c6\u4e2d\uff0c\u4e0b\u9762\u8fd9\u6837\u7684\u7528\u6cd5\u662fundefined! \u4f60\u53ef\u4ee5\u770b\u770bStackOverflow\u4e0a\u7684\u76f8\u5173\u95ee\u9898\u8ba8\u8bba\uff1a\u300a<a title=\"Why is it undefined behavior to delete[] an array of derived objects via a base pointer?\" href=\"http:\/\/stackoverflow.com\/questions\/6171814\/why-is-it-undefined-behavior-to-delete-an-array-of-derived-objects-via-a-base\" target=\"_blank\">Why is it undefined behavior to delete[] an array of derived objects via a base pointer?<\/a>\u300b\uff08\u540c\u6837\uff0c\u4f60\u4e5f\u53ef\u4ee5\u770b\u770b\u300aMore Effective C++\u300b\u4e2d\u7684\u6761\u6b3e\u4e09\uff09<\/p>\n<pre data-enlighter-language=\"c\" class=\"EnlighterJSRAW\">Base* pBase = new Derived[10];\r\n\r\ndelete[] pBase;<\/pre>\n<p>\u6240\u4ee5\uff0c\u5fae\u8f6fC++\u7f16\u7a0b\u8bd1\u5668define\u8fd9\u4e2a\u4e8b\u8ba9\u6211\u975e\u5e38\u4e0d\u89e3\uff0c\u5bf9\u5fae\u8f6f\u7684C++\u7f16\u8bd1\u5668\u518d\u5ea6\u5931\u671b\uff0c\u770b\u4f3c\u9ed8\u9ed8\u5730\u628a\u5176\u7f16\u8bd1\u5bf9\u4e86\u5f88\u6f02\u4eae\uff0c\u5b9e\u5219\u8bef\u5bfc\u4e86\u597d\u591a\u4eba\u628a\u8fd9\u79cdundefined\u7684\u4e1c\u897f\u5f53\u6210defined\u6765\u7528\uff0c\u8fd8\u8d5e\u626c\u505a\u5f97\u597d\uff0c\u771f\u662f\u4ee4\u4eba\u65e0\u8bed\u3002<strong>\uff08<\/strong><a href=\"http:\/\/weibo.com\/2087077260\/zup0V7LLM\" target=\"_blank\">\u5c31\u50cf\u5fae\u535a\u4e0a\u7684\u8fd9\u4e2a\u8d34\u4e00\u6837<\/a>\uff0c\u8bf4VC\u591a\u4e48\u725b\uff0c\u8fd8\u8bf4\u8fd9\u662fOO\u7684\u7279\u6027\u3002\u6211\u52d2\u4e2a\u53bb\uff01<strong>\uff09<\/strong><\/p>\n<p style=\"text-align: center;\"><a href=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/hehe.png\"><img decoding=\"async\" loading=\"lazy\" alt=\"\" src=\"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/hehe.png\" width=\"530\" height=\"173\" \/><\/a><\/p>\n<p>\u73b0\u5728\uff0c\u4f60\u7ec8\u4e8e\u77e5\u9053Base* pBase = new Derived[10];\u8fd9\u4e2a\u95ee\u9898\u662fC\u8bed\u8a00\u7684\u8f6c\u578b\u7684\u95ee\u9898\uff0c\u4f60\u4e5f\u5e94\u8be5\u77e5\u9053\u7528\u4e8e\u6570\u7ec4\u7684\u6307\u9488\u662f\u600e\u4e48\u56de\u4e8b\u4e86\u5427\uff1f<strong>\u8fd9\u662f\u4e00\u4e2a\u5f88\u5947\u8469\u7684\u4ee3\u7801\uff01\u8bf7\u4f60\u4e0d\u8981\u50cf\u90a3\u4e9b\u4eba\u4e00\u6837\u5728\u5fae\u535a\u4e0a\u548c\u8fd9\u91cc\u7684\u8bc4\u8bba\u91cc\u9ad8\u547c\u5e76\u548c\u6211\u7406\u8bba\u5230\uff1a\u201c\u5fae\u8f6f\u7684C++\u7f16\u8bd1\u5668\u652f\u6301\u8fd9\u4e2a\u4e8b\uff01\u201d\u3002<\/strong><\/p>\n<p>\u6700\u540e\uff0c\u6211\u8d8a\u6765\u8d8a\u53d1\u73b0\uff0c<span style=\"color: #cc0000; font-size: 14px;\"><strong>\u5f88\u591a\u8bf4C++\u96be\u7528\u7684\u4eba\uff0c\u5176\u5b9e\u662f\u4e0d\u61c2C\u8bed\u8a00<\/strong><\/span>\u3002<\/p>\n<p>\uff08\u5168\u6587\u5b8c\uff09<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>\u5148\u662f\u5728\u5fae\u535a\u4e0a\u770b\u5230\u4e86\u4e2a\u5fae\u535a\u548c\u4e91\u98ce\u7684\u8bc4\u8bba\uff0c\u7136\u540e\u6211\u56de\u4e86\u201c\u697c\u4e3b\u5bf9C\u7684\u5185\u5b58\u7ba1\u7406\u4e0d\u4e86\u89e3\u201d\u3002 \u540e\u6765\u5f15\u53d1\u4e86\u5f88\u591a\u4eba\u7684\u8ba8\u8bba\uff0c\u5927\u91cf\u7684\u4eba\u53c8\u501f\u673a\u6765\u9ed1C++\uff0c\u6bd4\u5982\uff1a \/\/@Baidu-Th&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/9543.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[5],"tags":[59,70,58],"series":[],"aioseo_notices":[],"views":90737,"post_thumbnail_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg","content_first_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg","post_medium_image_300":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg","post_thumbnail_image_624":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg","post_frist_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg","post_medium_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg","post_large_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg","post_full_image":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg","post_all_images":[{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/weibo.jpg","id":"image0"},{"imagesurl":"https:\/\/coolshell.cn\/wp-content\/uploads\/2013\/04\/hehe.png","id":"image1"}],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":180,"category_name":"C\/C++\u8bed\u8a00","post_date":"2013-04-29","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[{"ID":"22298","post_title":"\u804a\u804a\u56e2\u961f\u534f\u540c\u548c\u534f\u540c\u5de5\u5177"}],"pageviews":90738,"pageviews_wl":86239,"ratings_average":4,"ratings_total":221,"ratings_users":52,"next_post_id":9859,"next_post_title":"Alan Cox\uff1a\u5355\u5411\u94fe\u8868\u4e2dprev\u6307\u9488\u7684\u5999\u7528","previous_post_id":9410,"previous_post_title":"Unix\u8003\u53e4\u8bb0\uff1a\u4e00\u4e2a\u201c\u9057\u5931\u201d\u7684shell"}