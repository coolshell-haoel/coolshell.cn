{"id":962,"date":"2009-06-05T00:03:13","date_gmt":"2009-06-04T16:03:13","guid":{"rendered":"http:\/\/coolshell.cn\/?p=962"},"modified":"2009-06-08T00:12:54","modified_gmt":"2009-06-07T16:12:54","slug":"%e3%80%90%e5%8e%9f%e5%88%9b%e3%80%91sql%e6%a0%8f%e7%9b%ae%e6%a0%91%e7%9a%84%e4%bb%a3%e7%a0%81","status":"publish","type":"post","link":"https:\/\/coolshell.cn\/articles\/962.html","title":{"rendered":"\u3010\u539f\u521b\u3011SQL\u680f\u76ee\u6811\u7684\u4ee3\u7801"},"content":{"rendered":"<p>\u672c\u6587\u7531\u7f51\u53cbwhl\u4f9b\u7a3f\uff0c\u7279\u6b64\u611f\u8c22\uff01<br \/>\n\/**<br \/>\n\u00a0 * Desc: \u53d6\u680f\u76ee\u6811 ,\u8fc7\u6ee4\u7528\u6237\u6743\u9650\u548c\u65e0\u6548\u680f\u76ee<br \/>\n\u00a0 * Author: WHL<br \/>\n\u00a0 * Date: 2009-05-31 15:17<br \/>\n\u00a0 *\/<br \/>\n<!--more--><br \/>\n\u00a0<br \/>\n\/** 1. \u53d6\u67d0\u7528\u6237\u6709\u6743\u9650\uff08np_cms_column_security\u8868\u6709\u8bb0\u5f55\u4e14t.action_1 = &#8216;1&#8217;\uff09\u7684\u680f\u76ee\u7684\u6811 **\/<\/p>\n<pre data-enlighter-language=\"sql\" class=\"EnlighterJSRAW\">create or replace view V_NP_CTREE_BS as\r\nselect B.* from (\r\nselect A.*, lag(A.column_id) over(partition by A.column_id order by 0 ) RK\r\n  from (select \/*+choose *\/\r\n         t.*\r\n          from np_cms_column t\r\n         where t.is_active = &#039;1&#039;\r\n        connect by prior t.column_id = t.parent_id\r\n         start with t.column_id in (select t.column_id\r\n                                      from np_cms_column_security t\r\n                                     where t.subject_id = &#039;mazj&#039;\r\n                                          \/*\u8fd9\u91cc\u6dfb\u52a0\u89d2\u8272\u8fc7\u6ee4*\/\r\n                                       and t.action_1 = &#039;1&#039;))A) B\r\n where not exists\r\n (select 0\r\n          from (select distinct d.column_id\r\n                  from np_cms_column d\r\n                connect by prior d.column_id = d.parent_id\r\n                 start with d.column_id in\r\n                    (select t.column_id\r\n                       from np_cms_column_security t\r\n                      where t.subject_id = &#039;mazj&#039;\r\n                           \/* \u8fd9\u91cc\u6dfb\u52a0\u89d2\u8272\u8fc7\u6ee4*\/\r\n                        and t.action_1 = &#039;0&#039;\r\n                           \/* \u6392\u9664\u6709\u6743\u9650\u6811\u4e0b\u7684\u975e\u6388\u6743ID,\u65e2 Action_1=0\u7684*\/\r\n                        and exists\r\n                      (select 0\r\n                               from (select distinct d.column_id\r\n                                       from np_cms_column d\r\n                                     connect by prior d.column_id =\r\n                                                 d.parent_id\r\n                                      start with d.column_id in\r\n                                                 (select t.column_id\r\n                                                    from np_cms_column_security t\r\n                                                   where t.subject_id =\r\n                                                         &#039;mazj&#039;\r\n                                                        \/*\u8fd9\u91cc\u6dfb\u52a0\u89d2\u8272\u8fc7\u6ee4*\/\r\n                                                     and t.action_1 = &#039;1&#039;)) C1\r\n                              where C1.column_id = t.column_id))\r\n                        and d.is_active = &#039;1&#039;) C\r\n         where C.column_id = B.column_id and B.RK is null) and B.RK is null\r\nunion all\r\nselect c.*, 0 RK from np_cms_column c where c.parent_id = 0;\r\n<\/pre>\n<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;<br \/>\n\/** 2.\u5f97\u5230\u680f\u76ee\u7684\u865a\u62df\u7236\u4eb2ID\uff08\u8003\u8651\u5230\u628a\u65ad\u5c42\u7684\u8282\u70b9\u63a5\u8d77\u6765\uff09**\/<\/p>\n<pre data-enlighter-language=\"sql\" class=\"EnlighterJSRAW\">create or replace view V_NP_CTREE_PA as\r\nselect B.*,\r\n       (case B.column_id\r\n         when 1 then 0 else nvl(B.father, 1) end) VFA\r\n  from (select v.*,\r\n               (select vv.column_id\r\n                  from V_NP_CTREE_BS vv\r\n                 where vv.column_id = v.parent_id) FATHER\r\n          from V_NP_CTREE_BS v) B;\r\n<\/pre>\n<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;<br \/>\n\/** 3. \u53d6\u51fa\u95e8\u6237\u9700\u8981\u7684\u680f\u76ee\u6811 **\/<\/p>\n<pre data-enlighter-language=\"sql\" class=\"EnlighterJSRAW\">--create or replace view V_NP_CTREE_RS as\r\nselect\r\n D.*, LPAD(&#039; &#039;, 2 * level - 1) || SYS_CONNECT_BY_PATH(D.COLUMN_NAME, &#039;\/&#039;) &amp;quot;Path&amp;quot;\r\n  from (select c.*\r\n          from V_NP_CTREE_PA c\r\n         order by c.VFA, c.disorder desc, c.column_id desc) D\r\nconnect by prior D.column_id = D.VFA\r\n start with D.column_id = 1;\r\n \r\n<\/pre>\n<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;<br \/>\n\uff08<strong>\u672c\u6587\u7248\u6743\u7531whl\u6240\uff0c\u8f6c\u8f7d\u65f6\u8bf7\u6ce8\u660e\u4f5c\u8005\u548c\u51fa\u5904<\/strong>\uff09<\/p>\n","raw":"","protected":false},"excerpt":{"rendered":"<p>\u672c\u6587\u7531\u7f51\u53cbwhl\u4f9b\u7a3f\uff0c\u7279\u6b64\u611f\u8c22\uff01 \/** \u00a0 * Desc: \u53d6\u680f\u76ee\u6811 ,\u8fc7\u6ee4\u7528\u6237\u6743\u9650\u548c\u65e0\u6548\u680f\u76ee \u00a0 * Author: WHL \u00a0 * Date: 2009-&#8230;<\/p>\n<p class=\"read-more\"><a class=\"btn btn-default\" href=\"https:\/\/coolshell.cn\/articles\/962.html\"> Read More<span class=\"screen-reader-text\">  Read More<\/span><\/a><\/p>\n","protected":false},"author":18,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[105,3],"tags":[102,131,133],"series":[],"aioseo_notices":[],"views":6987,"post_thumbnail_image":"","content_first_image":"","post_medium_image_300":"","post_thumbnail_image_624":"","post_frist_image":"","post_medium_image":"","post_large_image":"","post_full_image":"","post_all_images":[],"videoAdId":"","listAd":"0","listAdId":"","listAdEvery":5,"total_comments":1,"category_name":"\u6570\u636e\u5e93","post_date":"2009-06-05","like_count":"0","praiseWord":"\u9f13\u52b1","excitationAd":"0","rewardedVideoAdId":"","detailAdId":"","detailAd":"0","enterpriseMinapp":"0","audios":[],"postImageUrl":"http:\/\/coolshell.cn\/wp-content\/uploads\/2016\/09\/coolshell-360x200.jpg","avatarurls":[],"related_posts":[],"pageviews":6988,"pageviews_wl":3677,"ratings_average":2,"ratings_total":13,"ratings_users":5,"next_post_id":973,"next_post_title":"\u7f16\u7a0b\u8bed\u8a00\u7684\u8bc4\u6d4b","previous_post_id":945,"previous_post_title":"C\u8bed\u8a00\u7684\u8c1c\u9898"}